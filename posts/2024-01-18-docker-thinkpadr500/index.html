<!doctype html><html lang=mn dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Thinkpad R500-д Almalinux 8 OS + Docker + Nginx proxy manager + SSL certificate + DuckDNS | CaDiL's Blog</title>
<meta name=keywords content><meta name=description content="Nginx Proxy Manager + DuckDNS + Containers"><meta name=author content="CaDiL"><link rel=canonical href=https://cadil.github.io/posts/2024-01-18-docker-thinkpadr500/><link crossorigin=anonymous href=/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z+V9+cO1A=" rel="preload stylesheet" as=style><link rel=icon href=https://cadil.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://cadil.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://cadil.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://cadil.github.io/apple-touch-icon.png><link rel=mask-icon href=https://cadil.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=mn href=https://cadil.github.io/posts/2024-01-18-docker-thinkpadr500/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Thinkpad R500-д Almalinux 8 OS + Docker + Nginx proxy manager + SSL certificate + DuckDNS"><meta property="og:description" content="Nginx Proxy Manager + DuckDNS + Containers"><meta property="og:type" content="article"><meta property="og:url" content="https://cadil.github.io/posts/2024-01-18-docker-thinkpadr500/"><meta property="og:image" content="https://cadil.github.io/static"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-01-18T00:00:00+00:00"><meta property="article:modified_time" content="2024-01-18T00:00:00+00:00"><meta property="og:site_name" content="CaDiL's Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://cadil.github.io/static"><meta name=twitter:title content="Thinkpad R500-д Almalinux 8 OS + Docker + Nginx proxy manager + SSL certificate + DuckDNS"><meta name=twitter:description content="Nginx Proxy Manager + DuckDNS + Containers"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://cadil.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Thinkpad R500-д Almalinux 8 OS + Docker + Nginx proxy manager + SSL certificate + DuckDNS","item":"https://cadil.github.io/posts/2024-01-18-docker-thinkpadr500/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Thinkpad R500-д Almalinux 8 OS + Docker + Nginx proxy manager + SSL certificate + DuckDNS","name":"Thinkpad R500-д Almalinux 8 OS \u002b Docker \u002b Nginx proxy manager \u002b SSL certificate \u002b DuckDNS","description":"Nginx Proxy Manager + DuckDNS + Containers","keywords":[],"articleBody":"OS Almalinux 8.9 minimal ISO суулгасан. Суулгах явцад root-с тусад нь user үүсгэн wheel группд нэмсэн.\n# hostnamectl Icon name: computer-laptop Chassis: laptop Operating System: AlmaLinux 8.9 (Midnight Oncilla) CPE OS Name: cpe:/o:almalinux:almalinux:8::baseos Kernel: Linux 4.18.0-513.9.1.el8_9.x86_64 Architecture: x86-64 # lshw vendor: LENOVO version: ThinkPad R500 cpu: Celeron(R) Dual-Core CPU T3100 @ 1.90GHz ram: 8G DDR2 800MHz Docker \u0026 docker compose Суулгах\nsudo dnf upgrade sudo dnf install yum-utils sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo sudo dnf install docker-ce docker-ce-cli containerd.io docker-compose-plugin # Complete бол сервис асаана sudo systemctl start docker sudo systemctl enable docker # check version docker --version # Docker version 24.0.7, build afdd53b docker-compose --version # Docker Compose version v2.12.2 Compose ажиллахгүй бол энэ аргаар суулгана:\ncurl -L \"https://github.com/docker/compose/releases/download/v2.12.2/docker-compose-$(uname -s)-$(uname -m)\" -o /usr/bin/docker-compose chmod +x /usr/bin/docker-compose Non root user бол docker group үүсгээд sudo үүсгэх боломжтой болгоорой.\n# Add alma user to wheel group sudo usermod -aG wheel alma # Add alma user to docker group sudo usermod -aG docker alma # groups alma wheel docker # id uid=1000(alma) gid=1000(alma) groups=1000(alma),10(wheel),992(docker) Docker compose nginxproxymanager, nextcloud, homeassistant, jellyfin, odoo+postgres, navidrome docker compose бүрдэнэ. Nginx proxy manager дээр HTTPS (Let’s encrypt) авахад бас DuckDNS domain авахад ашиглана. Docker network-оо дундаа ашиглана. 3 port docker -с host руу 80, 81, 443 expose хийсэн.\nversion: '2.2' services: nginxproxymanager: image: 'jc21/nginx-proxy-manager:latest' container_name: nginxproxymanager restart: unless-stopped ports: - '80:80' - '81:81' - '443:443' volumes: - ./nginx/data:/data - ./nginx/letsencrypt:/etc/letsencrypt # default cred: admin@example.com, changeme nextcloud: image: lscr.io/linuxserver/nextcloud:latest container_name: nextcloud environment: - PUID=1000 - PGID=1000 - TZ=Asia/Ulaanbaatar volumes: - ./nextcloud/appdata:/config - ./nextcloud/data:/data restart: unless-stopped homeassistant: image: lscr.io/linuxserver/homeassistant:latest container_name: homeassistant environment: - PUID=1000 - PGID=1000 - TZ=Asia/Ulaanbaatar volumes: - ./hass/config:/config restart: unless-stopped jellyfin: image: lscr.io/linuxserver/jellyfin:latest container_name: jellyfin environment: - PUID=1000 - PGID=1000 - TZ=Asia/Ulaanbaatar volumes: - ./jellyfin/config:/config - ./jellyfin/tvshows:/data/tvshows - ./jellyfin/movies:/data/movies restart: unless-stopped postgresql: image: docker.io/bitnami/postgresql:16 container_name: postgresql environment: - PUID=1000 - PGID=1000 - TZ=Asia/Ulaanbaatar - ALLOW_EMPTY_PASSWORD=yes - POSTGRESQL_USERNAME=bn_odoo - POSTGRESQL_DATABASE=bitnami_odoo volumes: - ./postgresql/postgresql-persistence:/bitnami/postgresql restart: unless-stopped odoo: image: docker.io/bitnami/odoo:17 container_name: odoo environment: - PUID=1000 - PGID=1000 - TZ=Asia/Ulaanbaatar - ALLOW_EMPTY_PASSWORD=yes - ODOO_DATABASE_HOST=postgresql - ODOO_DATABASE_PORT_NUMBER=5432 - ODOO_DATABASE_USER=bn_odoo - ODOO_DATABASE_NAME=bitnami_odoo volumes: - ./odoo/odoo-persistence:/bitnami/odoo depends_on: - postgresql restart: unless-stopped # default cred: user@example.com, bitnami Compose run:\ndocker-compose up -d docker ps:\nCONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 0f35e9aafd25 bitnami/odoo:17 \"/opt/bitnami/script…\" 6 minutes ago Up 6 minutes 3000/tcp, 8069/tcp, 8072/tcp odoo 91faa3c03087 lscr.io/linuxserver/homeassistant:latest \"/init\" 6 minutes ago Up 6 minutes 8123/tcp homeassistant a2aa28911120 lscr.io/linuxserver/nextcloud:latest \"/init\" 6 minutes ago Up 6 minutes 80/tcp, 443/tcp nextcloud 89039950eded bitnami/postgresql:16 \"/opt/bitnami/script…\" 6 minutes ago Up 6 minutes 5432/tcp postgresql a2c89d8405bf jc21/nginx-proxy-manager:latest \"/init\" 6 minutes ago Up 6 minutes 0.0.0.0:80-81-\u003e80-81/tcp, :::80-81-\u003e80-81/tcp, 0.0.0.0:443-\u003e443/tcp, :::443-\u003e443/tcp nginxproxymanager 029423ea3e20 lscr.io/linuxserver/jellyfin:latest \"/init\" 6 minutes ago Up 6 minutes 8096/tcp, 8920/tcp jellyfin Port нээх docker expose хийсэн портуудыг хост талдаа нээнэ.\n# Host port нээх sudo firewall-cmd --zone=public --add-service=http --permanent sudo firewall-cmd --zone=public --add-port 8080/tcp --permanent # reload хийх sudo firewall-cmd --reload # port шалгах sudo firewall-cmd --zone=public --list-ports Host-д persist хийгдсэн volume #pwd /home/alma/docker/compose #ls -la -d * */* -rw-rw-r--. 1 alma alma 2022 Jan 18 00:59 docker-compose.yml drwxr-xr-x. 3 root root 20 Jan 6 01:49 hass drwxr-xr-x. 8 alma alma 4096 Jan 18 01:21 hass/config drwxr-xr-x. 5 root root 49 Jan 6 01:49 jellyfin drwxr-xr-x. 6 alma alma 179 Jan 16 09:28 jellyfin/config drwxr-xr-x. 2 alma alma 4096 Jan 14 07:43 jellyfin/movies drwxr-xr-x. 4 alma alma 54 Jan 14 07:43 jellyfin/tvshows drwxr-xr-x. 4 root root 33 Jan 6 01:49 nextcloud drwxr-xr-x. 7 alma alma 95 Jan 6 02:30 nextcloud/appdata drwxrwx---. 5 alma alma 158 Jan 18 06:30 nextcloud/data drwxr-xr-x. 4 root root 37 Jan 6 01:49 nginx drwxr-xr-x. 7 root root 137 Jan 18 06:02 nginx/data drwxr-xr-x. 8 root root 104 Jan 18 06:02 nginx/letsencrypt drwxr-xr-x. 3 root root 30 Jan 17 23:28 odoo drwxrwxr-x. 5 systemd-coredump root 44 Jan 18 01:01 odoo/odoo-persistence drwxr-xr-x. 3 root root 36 Jan 18 00:54 postgresql drwxr-xr-x. 3 1001 1001 18 Jan 18 00:58 postgresql/postgresql-persistence drwxr-xr-x. 4 root root 31 Mar 2 15:02 navidrome drwxr-xr-x. 3 root root 87 Mar 2 15:02 navidrome/data drwxr-xr-x. 2 root root 6 Mar 2 15:02 navidrome/music non-root container-н хувьд permission алдаа заавал, жишээ нь postgresql:\nsudo chown -R 1001:1001 postgresql/postgresql-persistence Permission denied хийж байвал:\n# jellyfin sudo chown -R alma:alma movies sudo chmod -R 755 movies #tvshows Nginx proxy manager http://server-ip:81 хандан default creds-р (admin@example.com pass: changeme) нэвтэрнэ. Дараа нь DuckDNS бүртгүүлээд sub domain (жишээ нь hosono.duckdns.org г.м) авна. Current IP хэсэгт host-н IP (192.168.1.200 г.м) save хийнэ дээд хэсэгт token -copy хийнэ.\nNginx proxy manager -\u003e SSL Certificate -\u003e Add Let’s Encrypt Certificate -\u003e Let’s Encrypt орон Domain Names хэсэгт DuckDNS авсан domain-аа (*.hosono.duckdns.org болон hosono.duckdns.org) оруулна. Email хэсэгт мэдэгдэл авах мэйл хаягаа оруулна. Use a DNS Challenge -г enable хийгээд DuckDNS сонгоод dns_duckdns_token=өмнө copy хийсэн token-oo энд paste хийнэ. Propagation Seconds хэсэгт 120 гэж бичээд save. Алдаа заавал дахин save хийнэ.\nProxy entry hosono.duckdns.org -г http://nginxproxymanager:81 jellyfin.hosono.duckdns.org -г http://jellyfin:8096 гэх мэтээр Certificate тохируулахад Proxy host-ууд бүртгэнэ.\nDomain Names хэсэгт бүртгэж буй sub domain-аа бичин, Scheme хэсэгт http https -с сонгоно. container талаас 443 default хийгдээгүй л бол ихэхндээ http -г сонгоно. Forward Hostname / IP хэсэгт container name эсхүл 127.0.0.1 байж болно.\nSSL хэсэгт SSL Certificate -д бүртгэсэн DuckDNS -с сонгоод Force SSL, HTTP/2 Support гэдгийг сонгоод хадаглах юм. Энэ мэтээр subdomain -уудаа бүртгэнэ.\nSOURCE DESTINATION SSL ACCESS STATUS home.hosono.duckdns.org http://homeassistant:8123 Let’s Encrypt Public Online hosono.duckdns.org http://nginxproxymanager:81 Let’s Encrypt Public Online jellyfin.hosono.duckdns.org http://jellyfin:8096 Let’s Encrypt Public Online nextcloud.hosono.duckdns.org https://nextcloud:443 Let’s Encrypt Public Online odoo.hosono.duckdns.org http://odoo:8069 Let’s Encrypt Public Online HA http://homeassistant:8123 хувьд Proxy бүртгэх дээ Websockets Supports гэдгийг чагтлан өгнө. Дараа нь npm ажиллаж байгаа IP хаягийн мэдээллийг аван HASS дотор configuration.yml -г trusted_proxy хэсэгт npm нэмэн оруулна\ndocker inspect nginxproxymanager ... \"IPAddress\": \"172.23.0.2\" ... # /home/user/docker/compose/hass/config vi configuration.yaml ... http: use_x_forwarded_for: true trusted_proxies: - 172.23.0.0/24 # - 172.23.0.5 ... configuration.yaml save хийгээд homeassistant restart хийнэ:\ndocker restart homeassistant Watchtower Гараар container-ууд update хийнэ. /Docker-compose дотор байнга ажилладаг байхаар тохируулж бас болно/\ndocker run -v /var/run/docker.sock:/var/run/docker.sock containrrr/watchtower --run-once Bookmarks https://youtu.be/qlcVx-k-02E https://notthebe.ee/blog/easy-ssl-in-homelab-dns01/ https://github.com/bitnami/containers/tree/main/bitnami/odoo#configuration https://linux.how2shout.com/how-to-open-or-close-ports-in-almalinux-8-or-rocky-firewall/ https://techoverflow.net/2020/01/28/how-to-fix-bitnami-mariadb-mkdir-cannot-create-directory-bitnami-mariadb-permission-denied/ https://github.com/containrrr/watchtower/discussions/901 https://containrrr.dev/watchtower/ https://github.com/navidrome/navidrome ","wordCount":"991","inLanguage":"mn","datePublished":"2024-01-18T00:00:00Z","dateModified":"2024-01-18T00:00:00Z","author":{"@type":"Person","name":"CaDiL"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://cadil.github.io/posts/2024-01-18-docker-thinkpadr500/"},"publisher":{"@type":"Organization","name":"CaDiL's Blog","logo":{"@type":"ImageObject","url":"https://cadil.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://cadil.github.io/ accesskey=h title="CaDiL's Blog (Alt + H)">CaDiL's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://cadil.github.io/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://cadil.github.io/bookmark/ title=Bookmark><span>Bookmark</span></a></li><li><a href=https://cadil.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://cadil.github.io/using/ title=Using><span>Using</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://cadil.github.io/>Нүүр</a>&nbsp;»&nbsp;<a href=https://cadil.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Thinkpad R500-д Almalinux 8 OS + Docker + Nginx proxy manager + SSL certificate + DuckDNS</h1><div class=post-description>Nginx Proxy Manager + DuckDNS + Containers</div><div class=post-meta><span title='2024-01-18 00:00:00 +0000 UTC'>нэгдүгээр сар 18, 2024</span>&nbsp;·&nbsp;5 МИН&nbsp;·&nbsp;CaDiL</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Агуулга</span></summary><div class=inner><ul><ul><li><a href=#os aria-label=OS>OS</a></li><li><a href=#docker--docker-compose aria-label="Docker & docker compose">Docker & docker compose</a></li><li><a href=#docker-compose aria-label="Docker compose">Docker compose</a></li><li><a href=#port-%d0%bd%d1%8d%d1%8d%d1%85 aria-label="Port нээх">Port нээх</a></li></ul><li><a href=#host-%d0%b4-persist-%d1%85%d0%b8%d0%b9%d0%b3%d0%b4%d1%81%d1%8d%d0%bd-volume aria-label="Host-д persist хийгдсэн volume">Host-д persist хийгдсэн volume</a></li><li><a href=#nginx-proxy-manager aria-label="Nginx proxy manager">Nginx proxy manager</a><ul><li><a href=#proxy-entry aria-label="Proxy entry">Proxy entry</a><ul><li><a href=#ha aria-label=HA>HA</a></li></ul></li></ul></li><li><a href=#watchtower aria-label=Watchtower>Watchtower</a></li><li><a href=#bookmarks aria-label=Bookmarks>Bookmarks</a></li></ul></div></details></div><div class=post-content><h4 id=os>OS<a hidden class=anchor aria-hidden=true href=#os>#</a></h4><p>Almalinux 8.9 minimal <a href=https://mirrors.almalinux.org/isos/x86_64/8.9.html>ISO</a> суулгасан. Суулгах явцад root-с тусад нь user үүсгэн wheel группд нэмсэн.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># hostnamectl</span>
</span></span><span style=display:flex><span>         Icon name: computer-laptop
</span></span><span style=display:flex><span>           Chassis: laptop
</span></span><span style=display:flex><span>  Operating System: AlmaLinux 8.9 <span style=color:#f92672>(</span>Midnight Oncilla<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>       CPE OS Name: cpe:/o:almalinux:almalinux:8::baseos
</span></span><span style=display:flex><span>            Kernel: Linux 4.18.0-513.9.1.el8_9.x86_64
</span></span><span style=display:flex><span>      Architecture: x86-64
</span></span><span style=display:flex><span><span style=color:#75715e># lshw</span>
</span></span><span style=display:flex><span>    vendor: LENOVO
</span></span><span style=display:flex><span>    version: ThinkPad R500
</span></span><span style=display:flex><span>    cpu: Celeron<span style=color:#f92672>(</span>R<span style=color:#f92672>)</span> Dual-Core CPU T3100 @ 1.90GHz
</span></span><span style=display:flex><span>    ram: 8G DDR2 800MHz
</span></span></code></pre></div><h4 id=docker--docker-compose>Docker & docker compose<a hidden class=anchor aria-hidden=true href=#docker--docker-compose>#</a></h4><p>Суулгах</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo dnf upgrade
</span></span><span style=display:flex><span>sudo dnf install yum-utils
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sudo dnf install docker-ce docker-ce-cli containerd.io docker-compose-plugin
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Complete бол сервис асаана</span>
</span></span><span style=display:flex><span>sudo systemctl start docker
</span></span><span style=display:flex><span>sudo systemctl enable docker
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># check version</span>
</span></span><span style=display:flex><span>docker --version
</span></span><span style=display:flex><span><span style=color:#75715e># Docker version 24.0.7, build afdd53b</span>
</span></span><span style=display:flex><span>docker-compose --version
</span></span><span style=display:flex><span><span style=color:#75715e># Docker Compose version v2.12.2</span>
</span></span></code></pre></div><p>Compose ажиллахгүй бол энэ аргаар суулгана:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -L <span style=color:#e6db74>&#34;https://github.com/docker/compose/releases/download/v2.12.2/docker-compose-</span><span style=color:#66d9ef>$(</span>uname -s<span style=color:#66d9ef>)</span><span style=color:#e6db74>-</span><span style=color:#66d9ef>$(</span>uname -m<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span> -o /usr/bin/docker-compose
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>chmod +x /usr/bin/docker-compose
</span></span></code></pre></div><p>Non root user бол docker group үүсгээд sudo үүсгэх боломжтой болгоорой.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Add alma user to wheel group</span>
</span></span><span style=display:flex><span>sudo usermod -aG wheel alma
</span></span><span style=display:flex><span><span style=color:#75715e># Add alma user to docker group</span>
</span></span><span style=display:flex><span>sudo usermod -aG docker alma
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># groups</span>
</span></span><span style=display:flex><span>alma wheel docker
</span></span><span style=display:flex><span><span style=color:#75715e># id</span>
</span></span><span style=display:flex><span>uid<span style=color:#f92672>=</span>1000<span style=color:#f92672>(</span>alma<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span>1000<span style=color:#f92672>(</span>alma<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span>1000<span style=color:#f92672>(</span>alma<span style=color:#f92672>)</span>,10<span style=color:#f92672>(</span>wheel<span style=color:#f92672>)</span>,992<span style=color:#f92672>(</span>docker<span style=color:#f92672>)</span>
</span></span></code></pre></div><h4 id=docker-compose>Docker compose<a hidden class=anchor aria-hidden=true href=#docker-compose>#</a></h4><p><a href=https://nginxproxymanager.com/>nginxproxymanager</a>, <a href=https://nextcloud.com/>nextcloud</a>, <a href=https://www.home-assistant.io/>homeassistant</a>, <a href=https://jellyfin.org/>jellyfin</a>, <a href=https://github.com/bitnami/containers/blob/main/bitnami/odoo/docker-compose.yml>odoo+postgres</a>, <a href=https://www.navidrome.org/>navidrome</a> docker compose бүрдэнэ. Nginx proxy manager дээр HTTPS (Let&rsquo;s encrypt) авахад бас <a href=https://www.duckdns.org/>DuckDNS</a> domain авахад ашиглана. Docker network-оо дундаа ашиглана. 3 port docker -с host руу 80, 81, 443 expose хийсэн.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>version</span>: <span style=color:#e6db74>&#39;2.2&#39;</span> 
</span></span><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>nginxproxymanager</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#e6db74>&#39;jc21/nginx-proxy-manager:latest&#39;</span> 
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>nginxproxymanager</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>unless-stopped </span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#39;80:80&#39;</span>
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#39;81:81&#39;</span>
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#39;443:443&#39;</span> 
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./nginx/data:/data</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./nginx/letsencrypt:/etc/letsencrypt</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># default cred: admin@example.com, changeme</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>nextcloud</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>lscr.io/linuxserver/nextcloud:latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>nextcloud</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>PUID=1000</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>PGID=1000</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>TZ=Asia/Ulaanbaatar</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./nextcloud/appdata:/config </span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./nextcloud/data:/data</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>unless-stopped </span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>homeassistant</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>lscr.io/linuxserver/homeassistant:latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>homeassistant </span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>PUID=1000</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>PGID=1000</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>TZ=Asia/Ulaanbaatar</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./hass/config:/config </span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>unless-stopped</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>jellyfin</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>lscr.io/linuxserver/jellyfin:latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>jellyfin </span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>PUID=1000</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>PGID=1000</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>TZ=Asia/Ulaanbaatar</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./jellyfin/config:/config</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./jellyfin/tvshows:/data/tvshows</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./jellyfin/movies:/data/movies </span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>unless-stopped</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>  <span style=color:#f92672>postgresql</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>docker.io/bitnami/postgresql:16</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>postgresql</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>PUID=1000</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>PGID=1000</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>TZ=Asia/Ulaanbaatar</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>ALLOW_EMPTY_PASSWORD=yes</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>POSTGRESQL_USERNAME=bn_odoo</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>POSTGRESQL_DATABASE=bitnami_odoo</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./postgresql/postgresql-persistence:/bitnami/postgresql</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>unless-stopped</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>odoo</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>docker.io/bitnami/odoo:17</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>odoo</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>PUID=1000</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>PGID=1000</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>TZ=Asia/Ulaanbaatar</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>ALLOW_EMPTY_PASSWORD=yes</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>ODOO_DATABASE_HOST=postgresql</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>ODOO_DATABASE_PORT_NUMBER=5432</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>ODOO_DATABASE_USER=bn_odoo</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>ODOO_DATABASE_NAME=bitnami_odoo</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./odoo/odoo-persistence:/bitnami/odoo</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>depends_on</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>postgresql</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>unless-stopped</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># default cred: user@example.com, bitnami</span>
</span></span></code></pre></div><p>Compose run:</p><pre tabindex=0><code>docker-compose up -d
</code></pre><p><code>docker ps</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>CONTAINER ID   IMAGE                                      COMMAND                  CREATED         STATUS                   PORTS                                                                                  NAMES
</span></span><span style=display:flex><span>0f35e9aafd25   bitnami/odoo:17                            <span style=color:#e6db74>&#34;/opt/bitnami/script…&#34;</span>   <span style=color:#ae81ff>6</span> minutes ago   Up <span style=color:#ae81ff>6</span> minutes             3000/tcp, 8069/tcp, 8072/tcp                                                           odoo
</span></span><span style=display:flex><span>91faa3c03087   lscr.io/linuxserver/homeassistant:latest   <span style=color:#e6db74>&#34;/init&#34;</span>                  <span style=color:#ae81ff>6</span> minutes ago   Up <span style=color:#ae81ff>6</span> minutes             8123/tcp                                                                               homeassistant
</span></span><span style=display:flex><span>a2aa28911120   lscr.io/linuxserver/nextcloud:latest       <span style=color:#e6db74>&#34;/init&#34;</span>                  <span style=color:#ae81ff>6</span> minutes ago   Up <span style=color:#ae81ff>6</span> minutes             80/tcp, 443/tcp                                                                        nextcloud
</span></span><span style=display:flex><span>89039950eded   bitnami/postgresql:16                      <span style=color:#e6db74>&#34;/opt/bitnami/script…&#34;</span>   <span style=color:#ae81ff>6</span> minutes ago   Up <span style=color:#ae81ff>6</span> minutes             5432/tcp                                                                               postgresql
</span></span><span style=display:flex><span>a2c89d8405bf   jc21/nginx-proxy-manager:latest            <span style=color:#e6db74>&#34;/init&#34;</span>                  <span style=color:#ae81ff>6</span> minutes ago   Up <span style=color:#ae81ff>6</span> minutes             0.0.0.0:80-81-&gt;80-81/tcp, :::80-81-&gt;80-81/tcp, 0.0.0.0:443-&gt;443/tcp, :::443-&gt;443/tcp   nginxproxymanager
</span></span><span style=display:flex><span>029423ea3e20   lscr.io/linuxserver/jellyfin:latest        <span style=color:#e6db74>&#34;/init&#34;</span>                  <span style=color:#ae81ff>6</span> minutes ago   Up <span style=color:#ae81ff>6</span> minutes             8096/tcp, 8920/tcp                                                                     jellyfin
</span></span></code></pre></div><h4 id=port-нээх>Port нээх<a hidden class=anchor aria-hidden=true href=#port-нээх>#</a></h4><p>docker expose хийсэн портуудыг хост талдаа нээнэ.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Host port нээх</span>
</span></span><span style=display:flex><span>sudo firewall-cmd --zone<span style=color:#f92672>=</span>public --add-service<span style=color:#f92672>=</span>http --permanent
</span></span><span style=display:flex><span>sudo firewall-cmd --zone<span style=color:#f92672>=</span>public --add-port 8080/tcp --permanent
</span></span><span style=display:flex><span><span style=color:#75715e># reload хийх</span>
</span></span><span style=display:flex><span>sudo firewall-cmd --reload
</span></span><span style=display:flex><span><span style=color:#75715e># port шалгах</span>
</span></span><span style=display:flex><span>sudo firewall-cmd --zone<span style=color:#f92672>=</span>public --list-ports
</span></span></code></pre></div><h3 id=host-д-persist-хийгдсэн-volume>Host-д persist хийгдсэн volume<a hidden class=anchor aria-hidden=true href=#host-д-persist-хийгдсэн-volume>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#pwd</span>
</span></span><span style=display:flex><span>/home/alma/docker/compose
</span></span><span style=display:flex><span><span style=color:#75715e>#ls -la -d * */*</span>
</span></span><span style=display:flex><span>-rw-rw-r--. <span style=color:#ae81ff>1</span> alma             alma <span style=color:#ae81ff>2022</span> Jan <span style=color:#ae81ff>18</span> 00:59 docker-compose.yml
</span></span><span style=display:flex><span>drwxr-xr-x. <span style=color:#ae81ff>3</span> root             root   <span style=color:#ae81ff>20</span> Jan  <span style=color:#ae81ff>6</span> 01:49 hass
</span></span><span style=display:flex><span>drwxr-xr-x. <span style=color:#ae81ff>8</span> alma             alma <span style=color:#ae81ff>4096</span> Jan <span style=color:#ae81ff>18</span> 01:21 hass/config
</span></span><span style=display:flex><span>drwxr-xr-x. <span style=color:#ae81ff>5</span> root             root   <span style=color:#ae81ff>49</span> Jan  <span style=color:#ae81ff>6</span> 01:49 jellyfin
</span></span><span style=display:flex><span>drwxr-xr-x. <span style=color:#ae81ff>6</span> alma             alma  <span style=color:#ae81ff>179</span> Jan <span style=color:#ae81ff>16</span> 09:28 jellyfin/config
</span></span><span style=display:flex><span>drwxr-xr-x. <span style=color:#ae81ff>2</span> alma             alma <span style=color:#ae81ff>4096</span> Jan <span style=color:#ae81ff>14</span> 07:43 jellyfin/movies
</span></span><span style=display:flex><span>drwxr-xr-x. <span style=color:#ae81ff>4</span> alma             alma   <span style=color:#ae81ff>54</span> Jan <span style=color:#ae81ff>14</span> 07:43 jellyfin/tvshows
</span></span><span style=display:flex><span>drwxr-xr-x. <span style=color:#ae81ff>4</span> root             root   <span style=color:#ae81ff>33</span> Jan  <span style=color:#ae81ff>6</span> 01:49 nextcloud
</span></span><span style=display:flex><span>drwxr-xr-x. <span style=color:#ae81ff>7</span> alma             alma   <span style=color:#ae81ff>95</span> Jan  <span style=color:#ae81ff>6</span> 02:30 nextcloud/appdata
</span></span><span style=display:flex><span>drwxrwx---. <span style=color:#ae81ff>5</span> alma             alma  <span style=color:#ae81ff>158</span> Jan <span style=color:#ae81ff>18</span> 06:30 nextcloud/data
</span></span><span style=display:flex><span>drwxr-xr-x. <span style=color:#ae81ff>4</span> root             root   <span style=color:#ae81ff>37</span> Jan  <span style=color:#ae81ff>6</span> 01:49 nginx
</span></span><span style=display:flex><span>drwxr-xr-x. <span style=color:#ae81ff>7</span> root             root  <span style=color:#ae81ff>137</span> Jan <span style=color:#ae81ff>18</span> 06:02 nginx/data
</span></span><span style=display:flex><span>drwxr-xr-x. <span style=color:#ae81ff>8</span> root             root  <span style=color:#ae81ff>104</span> Jan <span style=color:#ae81ff>18</span> 06:02 nginx/letsencrypt
</span></span><span style=display:flex><span>drwxr-xr-x. <span style=color:#ae81ff>3</span> root             root   <span style=color:#ae81ff>30</span> Jan <span style=color:#ae81ff>17</span> 23:28 odoo
</span></span><span style=display:flex><span>drwxrwxr-x. <span style=color:#ae81ff>5</span> systemd-coredump root   <span style=color:#ae81ff>44</span> Jan <span style=color:#ae81ff>18</span> 01:01 odoo/odoo-persistence
</span></span><span style=display:flex><span>drwxr-xr-x. <span style=color:#ae81ff>3</span> root             root   <span style=color:#ae81ff>36</span> Jan <span style=color:#ae81ff>18</span> 00:54 postgresql
</span></span><span style=display:flex><span>drwxr-xr-x. <span style=color:#ae81ff>3</span>             <span style=color:#ae81ff>1001</span> <span style=color:#ae81ff>1001</span>   <span style=color:#ae81ff>18</span> Jan <span style=color:#ae81ff>18</span> 00:58 postgresql/postgresql-persistence
</span></span><span style=display:flex><span>drwxr-xr-x. <span style=color:#ae81ff>4</span> root             root   <span style=color:#ae81ff>31</span> Mar  <span style=color:#ae81ff>2</span> 15:02 navidrome
</span></span><span style=display:flex><span>drwxr-xr-x. <span style=color:#ae81ff>3</span> root             root   <span style=color:#ae81ff>87</span> Mar  <span style=color:#ae81ff>2</span> 15:02 navidrome/data
</span></span><span style=display:flex><span>drwxr-xr-x. <span style=color:#ae81ff>2</span> root             root    <span style=color:#ae81ff>6</span> Mar  <span style=color:#ae81ff>2</span> 15:02 navidrome/music
</span></span></code></pre></div><p>non-root container-н хувьд permission алдаа заавал, жишээ нь postgresql:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo chown -R 1001:1001 postgresql/postgresql-persistence
</span></span></code></pre></div><p>Permission denied хийж байвал:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># jellyfin</span>
</span></span><span style=display:flex><span>sudo chown -R alma:alma movies
</span></span><span style=display:flex><span>sudo chmod -R <span style=color:#ae81ff>755</span> movies <span style=color:#75715e>#tvshows</span>
</span></span></code></pre></div><h3 id=nginx-proxy-manager>Nginx proxy manager<a hidden class=anchor aria-hidden=true href=#nginx-proxy-manager>#</a></h3><p><code>http://server-ip:81</code> хандан default creds-р (<code>admin@example.com</code> pass: <code>changeme</code>) нэвтэрнэ. Дараа нь <a href=https://duckdns.org/>DuckDNS</a> бүртгүүлээд sub domain (жишээ нь <code>hosono</code>.duckdns.org г.м) авна. <code>Current IP</code> хэсэгт host-н IP (192.168.1.200 г.м) save хийнэ дээд хэсэгт <code>token</code> -copy хийнэ.</p><p>Nginx proxy manager -> SSL Certificate -> Add Let&rsquo;s Encrypt Certificate -> Let&rsquo;s Encrypt орон Domain Names хэсэгт DuckDNS авсан domain-аа (<code>*.hosono.duckdns.org</code> болон <code>hosono.duckdns.org</code>) оруулна. Email хэсэгт мэдэгдэл авах мэйл хаягаа оруулна. Use a DNS Challenge -г enable хийгээд <code>DuckDNS</code> сонгоод <code>dns_duckdns_token=өмнө copy хийсэн token-oo энд paste хийнэ</code>. Propagation Seconds хэсэгт <code>120</code> гэж бичээд save. Алдаа заавал дахин save хийнэ.</p><h4 id=proxy-entry>Proxy entry<a hidden class=anchor aria-hidden=true href=#proxy-entry>#</a></h4><p><code>hosono.duckdns.org</code> -г <code>http://nginxproxymanager:81</code>
<code>jellyfin.hosono.duckdns.org</code> -г <code>http://jellyfin:8096</code> гэх мэтээр Certificate тохируулахад Proxy host-ууд бүртгэнэ.</p><p>Domain Names хэсэгт бүртгэж буй sub domain-аа бичин, Scheme хэсэгт <code>http</code> <code>https</code> -с сонгоно. container талаас 443 default хийгдээгүй л бол ихэхндээ <code>http</code> -г сонгоно. Forward Hostname / IP хэсэгт container name эсхүл 127.0.0.1 байж болно.</p><p>SSL хэсэгт SSL Certificate -д бүртгэсэн DuckDNS -с сонгоод Force SSL, HTTP/2 Support гэдгийг сонгоод хадаглах юм. Энэ мэтээр subdomain -уудаа бүртгэнэ.</p><table><thead><tr><th>SOURCE</th><th>DESTINATION</th><th>SSL</th><th>ACCESS</th><th>STATUS</th></tr></thead><tbody><tr><td>home.hosono.duckdns.org</td><td>http://homeassistant:8123</td><td>Let&rsquo;s Encrypt</td><td>Public</td><td>Online</td></tr><tr><td>hosono.duckdns.org</td><td>http://nginxproxymanager:81</td><td>Let&rsquo;s Encrypt</td><td>Public</td><td>Online</td></tr><tr><td>jellyfin.hosono.duckdns.org</td><td>http://jellyfin:8096</td><td>Let&rsquo;s Encrypt</td><td>Public</td><td>Online</td></tr><tr><td>nextcloud.hosono.duckdns.org</td><td>https://nextcloud:443</td><td>Let&rsquo;s Encrypt</td><td>Public</td><td>Online</td></tr><tr><td>odoo.hosono.duckdns.org</td><td>http://odoo:8069</td><td>Let&rsquo;s Encrypt</td><td>Public</td><td>Online</td></tr></tbody></table><h5 id=ha>HA<a hidden class=anchor aria-hidden=true href=#ha>#</a></h5><p>http://homeassistant:8123 хувьд Proxy бүртгэх дээ Websockets Supports гэдгийг чагтлан өгнө. Дараа нь npm ажиллаж байгаа IP хаягийн мэдээллийг аван HASS дотор configuration.yml -г trusted_proxy хэсэгт npm нэмэн оруулна</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker inspect nginxproxymanager
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;IPAddress&#34;</span>: <span style=color:#e6db74>&#34;172.23.0.2&#34;</span>
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># /home/user/docker/compose/hass/config</span>
</span></span><span style=display:flex><span>vi configuration.yaml
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>http:
</span></span><span style=display:flex><span>  use_x_forwarded_for: true
</span></span><span style=display:flex><span>  trusted_proxies:
</span></span><span style=display:flex><span>    - 172.23.0.0/24
</span></span><span style=display:flex><span>  <span style=color:#75715e># - 172.23.0.5</span>
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>configuration.yaml save хийгээд homeassistant restart хийнэ:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker restart homeassistant
</span></span></code></pre></div><h3 id=watchtower>Watchtower<a hidden class=anchor aria-hidden=true href=#watchtower>#</a></h3><p>Гараар container-ууд update хийнэ.
/Docker-compose дотор байнга ажилладаг байхаар тохируулж бас болно/</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker run -v /var/run/docker.sock:/var/run/docker.sock containrrr/watchtower --run-once
</span></span></code></pre></div><h3 id=bookmarks>Bookmarks<a hidden class=anchor aria-hidden=true href=#bookmarks>#</a></h3><ul><li><a href=https://youtu.be/qlcVx-k-02E>https://youtu.be/qlcVx-k-02E</a></li><li><a href=https://notthebe.ee/blog/easy-ssl-in-homelab-dns01/>https://notthebe.ee/blog/easy-ssl-in-homelab-dns01/</a></li><li><a href=https://github.com/bitnami/containers/tree/main/bitnami/odoo#configuration>https://github.com/bitnami/containers/tree/main/bitnami/odoo#configuration</a></li><li><a href=https://linux.how2shout.com/how-to-open-or-close-ports-in-almalinux-8-or-rocky-firewall/>https://linux.how2shout.com/how-to-open-or-close-ports-in-almalinux-8-or-rocky-firewall/</a></li><li><a href=https://techoverflow.net/2020/01/28/how-to-fix-bitnami-mariadb-mkdir-cannot-create-directory-bitnami-mariadb-permission-denied/>https://techoverflow.net/2020/01/28/how-to-fix-bitnami-mariadb-mkdir-cannot-create-directory-bitnami-mariadb-permission-denied/</a></li><li><a href=https://github.com/containrrr/watchtower/discussions/901>https://github.com/containrrr/watchtower/discussions/901</a></li><li><a href=https://containrrr.dev/watchtower/>https://containrrr.dev/watchtower/</a></li><li><a href=https://github.com/navidrome/navidrome>https://github.com/navidrome/navidrome</a></li></ul></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://cadil.github.io/>CaDiL's Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="хуулах";function s(){t.innerHTML="хуулсан!",setTimeout(()=>{t.innerHTML="хуулах"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>