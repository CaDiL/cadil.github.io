<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>GKE on CaDiL&#39;s Blog</title>
    <link>https://cadil.github.io/tags/gke/</link>
    <description>Recent content in GKE on CaDiL&#39;s Blog</description>
    <image>
      <title>CaDiL&#39;s Blog</title>
      <url>https://cadil.github.io/static</url>
      <link>https://cadil.github.io/static</link>
    </image>
    <generator>Hugo -- gohugo.io</generator>
    <language>mn</language>
    <lastBuildDate>Thu, 14 Jan 2021 00:00:00 +0000</lastBuildDate>
    <atom:link href="https://cadil.github.io/tags/gke/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>GKE дээр Odoo-г суулгах</title>
      <link>https://cadil.github.io/posts/2021-01-14-gke-kubernetes/</link>
      <pubDate>Thu, 14 Jan 2021 00:00:00 +0000</pubDate>
      <guid>https://cadil.github.io/posts/2021-01-14-gke-kubernetes/</guid>
      <description>GKE дээр Odoo-г суулгах</description>
      <content:encoded><![CDATA[<h2 id="gke-дээр-helm-күбернетес-ашиглан-жишээ-апплкейшн-суулгаж-тохируулах">GKE дээр Helm, Күбернетес ашиглан жишээ апплкейшн суулгаж тохируулах</h2>
<ul>
<li>Google Kubernetes Engine дээр кластер үүсгэх</li>
<li>Helm, Tiller суулгах</li>
<li>TLS Key үүсгэх</li>
<li>Odoo-г суулгах</li>
</ul>
<h3 id="google-kubernetes-engine-дээр-кластер-үүсгэх">Google Kubernetes Engine дээр кластер үүсгэх</h3>
<p><a href="https://cloud.google.com">Google Cloud Platform</a> дээр Google Kubernetes Engine дээр кластер үүсгэх Helm Chart суулгаж TLS, Cert-Manager суулган тохируулж сүүлд нь Odoo-г суулгаж үзнэ.</p>
<ul>
<li><a href="https://cloud.google.com/sdk/docs/install">gcloud суулгах</a></li>
<li><a href="https://kubernetes.io/docs/tasks/tools/install-kubectl/#install-kubectl">kubectl суулгах</a></li>
</ul>
<p><code>gcloud</code> дамжуулан GCP - тэй холбогдоно. Google Cloud Platform - бүртгэл байхгүй бол эхлээд бүртгүүлээрэй.</p>
<p><code>kubectl</code> gcloud суулгасан бол дээр байгаа гарын авлага ашиглахгүй kubectl суулгая гэвэл:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcloud components install kubectl
</span></span></code></pre></div><p>Кластер үүсгэхээсээ ѳмнѳ нэвтрэн орно:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcloud auth application-default login
</span></span></code></pre></div><p>Нэвтрэн орсон бол доорк коммандараар шинэ прожект үүсгэнэ:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcloud projects create <span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span>
</span></span></code></pre></div><p>Эсхүл заавал CLI-ээр үүсгэхгүй гэвэл GCP дээрээс browser дээрээс орон шинэ прожект үүсгэж болно. Терминал дээрээ ѳѳрийн тѳслийг default болгож zone тохиргоо хийх бол:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcloud config set project <span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span> 
</span></span><span style="display:flex;"><span>gcloud config set compute/zone <span style="color:#e6db74">${</span>ZONE<span style="color:#e6db74">}</span>
</span></span></code></pre></div><blockquote>
<p><strong>Zone жигсаалт авах бол</strong>: gcloud compute zones list</p>
</blockquote>
<p>Одоо шинээр үүсгэсэн тѳсѳл дотроо кластер үүсгэе. Google Kubernetes Engine -г идэвхжүүлээгүй бол эхлээд brwoser-ѳѳсѳѳ GCP -г ороод GKE-г enable хийх хийнэ. Kubernetes Engine -г ороод browser дээрээс анх удаа кластер үүсгэж байгаа хичээл болон жишиг кластер тохироог санал болгоно. Тэр аргаар нь үүсгэж болно. Эсхүл доор байгаа командаар үүсгэж болно.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcloud beta container --project <span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span> clusters create <span style="color:#e6db74">&#34;my-first-cluster-1&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --zone <span style="color:#e6db74">&#34;us-central1-c&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --no-enable-basic-auth <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --cluster-version <span style="color:#e6db74">&#34;1.16.15-gke.4901&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --machine-type <span style="color:#e6db74">&#34;e2-medium&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --image-type <span style="color:#e6db74">&#34;COS&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --disk-type <span style="color:#e6db74">&#34;pd-standard&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --disk-size <span style="color:#e6db74">&#34;100&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --scopes <span style="color:#e6db74">&#34;https://www.googleapis.com/auth/devstorage.read_only&#34;</span>,<span style="color:#e6db74">&#34;https://www.googleapis.com/auth/logging.write&#34;</span>,<span style="color:#e6db74">&#34;https://www.googleapis.com/auth/monitoring&#34;</span>,<span style="color:#e6db74">&#34;https://www.googleapis.com/auth/servicecontrol&#34;</span>,<span style="color:#e6db74">&#34;https://www.googleapis.com/auth/service.management.readonly&#34;</span>,<span style="color:#e6db74">&#34;https://www.googleapis.com/auth/trace.append&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --no-enable-cloud-logging <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --no-enable-cloud-monitoring <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --no-enable-ip-alias <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --network <span style="color:#e6db74">&#34;projects/</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span><span style="color:#e6db74">/global/networks/default&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --subnetwork <span style="color:#e6db74">&#34;projects/</span><span style="color:#e6db74">${</span>PROJECT<span style="color:#e6db74">}</span><span style="color:#e6db74">/regions/us-central1/subnetworks/default&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --addons HorizontalPodAutoscaling <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --enable-autoupgrade <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --enable-autorepair <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --enable-autoscaling <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --num-nodes <span style="color:#e6db74">&#34;2&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --min-nodes <span style="color:#e6db74">&#34;2&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --max-nodes <span style="color:#e6db74">&#34;5&#34;</span>
</span></span></code></pre></div><p><code>zones</code>: Кластер үүсгэж байгаа сервверийн байршил.
<code>machine-type</code>: Кластерын үүсгэж байгаа тѳхѳѳрѳмжийн сонголт. Ямар тѳрлийн тѳхѳѳрѳмж сонгхож байгаагаас үнэ болон хэдэн node үүсгэх лимит зэрэгг тодорохйлогдоно. Дэлгэрэнгүй судлах бол: <a href="https://cloud.google.com/compute/docs/machine-types">Machine Types</a>.
<code>addons</code>: Автоматаар буюу ачаалал их болох үед node ѳргѳтгѳл хийх тохиргоо оруулав: <a href="https://cloud.google.com/kubernetes-engine/docs/how-to/horizontal-pod-autoscaling">HorizontalPodAutoscaling</a>.
<code>min-node</code>: Автомат ѳргѳтгѳл хийж байх үед кластерт хамгийн бага байх node.
<code>max-node</code>: Автомат ѳргѳтгѳл хийж байх үед кластерт хамгийн их байх node.</p>
<p>Шинээр үүсгэсэн кластерт role binding тохируулна:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcloud container clusters get-credentials <span style="color:#e6db74">${</span>Кластер нэр<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>kubectl create clusterrolebinding cluster-admin-binding <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --clusterrole cluster-admin <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --user <span style="color:#66d9ef">$(</span>gcloud config get-value account<span style="color:#66d9ef">)</span>
</span></span></code></pre></div><h3 id="helm-суулгах">Helm суулгах</h3>
<p>Helm суулгах:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl https://raw.githubusercontent.com/helm/helm/master/scripts/get | bash
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl create serviceaccount -n kube-system tiller 
</span></span><span style="display:flex;"><span>kubectl create clusterrolebinding tiller-cluster-rule <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --clusterrole<span style="color:#f92672">=</span>cluster-admin --serviceaccount<span style="color:#f92672">=</span>kube-system:tiller
</span></span></code></pre></div><p>to be continued&hellip;</p>
]]></content:encoded>
    </item>
  </channel>
</rss>
